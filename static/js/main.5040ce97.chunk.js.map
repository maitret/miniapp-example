{"version":3,"sources":["redux/helpers/persist.ts","components/Skeletons/index.tsx","lib/api/index.ts","screens/EventScreen/Skeleton/styles.module.css","redux/slices/event.ts","components/PageHeader/styles.module.css","components/StackNavigator/Screen/styles.module.css","components/CityChange/styles.module.css","lib/url-builder.ts","redux/slices/menu.ts","components/EventCard/style.module.css","lib/is-ios.ts","lib/lazy.ts","screens/EventScreen/components/EventsFeed/Skeleton/styles.module.css","components/AuthBox/styles.module.css","components/EventsList/Skeleton/index.tsx","components/StackNavigator/hooks.ts","redux/slices/selections.ts","components/PageHeader/index.tsx","components/StackNavigator/context.ts","components/EventCard/Skeleton/styles.module.css","components/CitySelect/styles.module.css","components/ClearButton/index.tsx","components/EventsList/constants.ts","components/EventCardVertical/Skeleton/styles.module.css","components/Image/styles.module.css","screens/SearchScreen/PopularResult/styles.module.css","components/MenuNavigation/style.module.css","components/Image/index.tsx","components/EventCard/Skeleton/index.tsx","redux/slices/actual-events.ts","redux/slices/rubric-events.ts","redux/slices/selection-events.ts","redux/slices/recommended-events.ts","lib/geolocation.ts","components/BackwardButton/index.tsx","components/BackwardButton/styles.module.css","screens/MainScreen/Skeleton/styles.module.css","components/MenuModal/style.module.css","components/Skeletons/styles.module.css","components/DateFilter/Skeleton/styles.module.css","components/SelectionList/Skeleton/styles.module.css","screens/SelectionScreen/Skeleton/styles.module.css","components/EventsList/style.module.css","components/PriceLabel/styles.module.css","screens/SearchScreen/SearchResult/styles.module.css","screens/SearchScreen/PopularResult/Skeleton/styles.module.css","screens/SearchScreen/styles.module.css","components/MenuGeoLabel/styles.module.css","components/Checkbox/styles.module.css","components/CityModal/styles.module.css","redux/slices/date-filter.ts","lib/date.ts","hooks/useInfiniteScroll.ts","hooks/useVisible.ts","components/EventsList/index.tsx","hooks/usePaginatedList.ts","components/EventCard/index.tsx","components/PriceLabel/index.tsx","components/StackNavigator/Screen/index.tsx","components/StackNavigator/StackNavigator.tsx","components/StackNavigator/index.tsx","components/EventCardMain/Skeleton/index.tsx","components/SelectionList/Skeleton/index.tsx","components/TicketPrice/index.tsx","components/ActionButton/index.tsx","components/EventCardVertical/Skeleton/index.tsx","screens/EventScreen/components/EventsFeed/Skeleton/index.tsx","screens/EventScreen/components/RecommendedEvents/Skeleton/index.tsx","components/ClearButton/styles.module.css","components/EventsList/Skeleton/styles.module.css","components/EventCardMain/Skeleton/styles.module.css","components/TextInput/styles.module.css","screens/SearchScreen/Input/styles.module.css","screens/SearchScreen/SearchResult/Skeleton/styles.module.css","components/ActionButton/styles.module.css","assets/login-avatar.png","assets/login-avatar-2x.png","redux/slices/city.ts","redux/slices/city-list.ts","redux/slices/search.ts","lib/account-manager.ts","redux/slices/user.ts","redux/index.ts","components/DateFilter/Skeleton/index.tsx","screens/MainScreen/Skeleton/index.tsx","screens/MainScreen/index.tsx","screens/EventScreen/Skeleton/index.tsx","screens/EventScreen/index.tsx","screens/SelectionScreen/Skeleton/index.tsx","screens/RubricScreen/index.tsx","screens/SelectionScreen/index.tsx","components/TextInput/index.tsx","screens/SearchScreen/Input/index.tsx","screens/SearchScreen/SearchResult/Skeleton/index.tsx","screens/SearchScreen/SearchResult/index.tsx","hooks/useThrottleLoading.ts","screens/SearchScreen/PopularResult/Skeleton/index.tsx","screens/SearchScreen/PopularResult/index.tsx","screens/SearchScreen/index.tsx","components/MenuNavigation/index.tsx","components/AuthBox/index.tsx","components/MenuGeoLabel/index.tsx","components/MenuModal/index.tsx","components/Checkbox/index.tsx","components/CityChange/index.tsx","components/CitySelect/index.tsx","components/CityModal/index.tsx","hooks/usePrevious.ts","App.tsx","PolyfillApp.tsx","index.tsx"],"names":["createPersistKeyByFilter","filter","JSON","stringify","Object","keys","sort","restoreFilterFromPersistKey","key","parse","stateReconcilerByDate","inboundState","today","Date","setHours","nowTime","getTime","reduce","result","inboundResult","inboundKey","date","keyTime","getPersistConfig","options","storage","createIdbStorage","name","storeName","serialize","deserialize","version","migrate","persistedState","currentVersion","migratedState","_persist","undefined","Promise","resolve","timeout","getTransformUIPersistance","defaultUIState","createTransform","state","Rect","className","width","height","mix","styles","rect","style","Text","size","text","classNames","Boolean","join","MOSCOW","geoid","longitude","latitude","queryParams","params","map","k","encodeKey","encodeURIComponent","Array","isArray","v","toString","request","url","query","signal","response","fetch","process","ok","json","reject","fetchEvent","id","fetchRubricEvents","tag","fetchActualEvents","fetchSelections","fetchCityInfo","citiesWithDistance","fetchCityList","cities","city","distance","getDistanceBetweenPoints","minDistance","Infinity","cityInfo","nearestCity","eventsMenu","fetchSelectionEvents","code","fetchSuggest","fetchRecommendedEvents","module","exports","initialState","data","ui","slice","createSlice","reducers","fetchStart","action","payload","event","schedule","updatedAt","isLoading","isUpdating","fetchSuccess","scheduleInfo","now","fetchError","setEvents","events","forEach","actions","loadEvent","dispatch","getState","err","console","error","persistConfig","transforms","persistReducer","reducer","getMainPageUrl","getEventUrl","getRubricUrl","getSelectionUrl","getSearchUrl","menu","visible","items","activeItem","setItems","setVisible","isIOS","test","navigator","platform","userAgent","maxTouchPoints","window","MSStream","lazyDeferred","importCallback","lazy","all","setTimeout","then","EventsListSkeleton","itemsGap","DEFAULT_ITEMS_GAP","count","card","Card","gridGap","fill","_","index","useBackward","onBackward","useContext","StackNavigatorContext","useMemo","bind","useScreenRef","ref","length","selections","selection","push","title","image","eventPreview","selectionsSelector","persistKey","currentCity","dateFilter","selectionsUISelector","loadSelections","stateReconciler","Logo","to","logo","SuggestIcon","setMods","mods","memo","props","hasMenu","hasLogo","backward","history","useHistory","useDispatch","onSearchClick","useCallback","onMenuClick","setMenuVisible","onClick","createContext","isVisible","createRef","ClearButton","children","cls","clear","Image","color","bgColor","isLoaded","setLoaded","useState","onLoad","src","stubClassNames","stub","containerClassNames","container","srcSet","src2x","alt","backgroundColor","EventCardSkeleton","right","description","actualEventsSelector","actualEvents","actualEventsUISelector","loadActualEvents","prefetchItems","paging","offset","total","hasMoreItems","isLoadingMore","fetchMoreStart","fetchMoreSuccess","fetchMoreError","rubricEventsSelector","rubricEvents","rubricEventsUISelector","loadRubricEvents","limit","loadMoreRubricEvents","extraReducers","builder","addCase","selectionsFetchSuccess","eventsKey","selectionEventsSelector","selectionEvents","selectionEventsUISelector","loadSelectionEvents","loadMoreSelectionEvents","top","concert","cinema","theatre","recommendedEventsSelector","recommendedEvents","recommendedEventsUISelector","loadRecommendedEvents","GEOLOCATIONS_OPTIONS","maximumAge","getCurrentPosition","geolocation","position","coords","deg2rad","deg","Math","PI","lat1","lon1","lat2","lon2","tmp","sin","cos","asin","sqrt","BackwardIcon","Backward","dateToString","period","setDate","format","parseDate","useInfiniteScroll","threshold","loadMore","hasMore","needLoadMore","optionsRef","useRef","useLayoutEffect","current","observer","IntersectionObserver","entry","isIntersecting","observe","disconnect","useVisible","rootMargin","useEffect","EventsListLoadable","loadMoreRef","pageSize","setLimit","wrappedLoadMore","usePaginatedList","list","EventsListItems","skeleton","actualEvent","component","onItemClick","EventsList","type","argument","tickets","ticket","eventListCard","eventListCard2x","preview","annotation","PriceLabel","price","Screen","transitions","screen","hidden","context","Provider","value","location","enter","screenEnter","enterActive","screenEnterActive","exit","screenExit","exitActive","screenExitActive","transitionCallbacks","onEnter","node","previousElementSibling","classList","add","onExit","remove","transitionTimeouts","StackNavigator","screens","maxDepth","stack","setStack","useLocation","iOS","callback","useLocationChange","scrollTo","isBackward","isReplace","match","item","matchPath","pathname","newStackItem","newStack","splice","warn","fallback","goBack","replace","TransitionGroup","CSSTransition","createStackNavigator","scrollRestoration","EventCardMainSkeleton","SelectionListSkeleton","block","currencySymbol","rub","usd","TicketPrice","min","currency","ActionButton","EventCardVerticalSkeleton","EventsFeedSkeleton","feed","RecommendedEventsSkeleton","useGeolocation","isFetchingLocation","setCity","setGeolocation","locationFetchStart","locationFetchSuccess","locationFetchFailed","alert","loadCityInfoByLocation","showError","setMenuItems","loadCityInfo","cityState","toggleGeolocation","isActive","cityList","setLoading","setCityListResult","loadCityList","blacklist","results","groups","popularEvents","search","fetchPopularStart","fetchPopularSuccess","fetchPopularError","searchStart","searchSuccess","group","documents","doc","document","minPrice","object","tags","contentRating","max","userRating","placesTotal","transformSearchDocumentToList","searchError","resetResults","loadPopularEvents","activeRequest","loadSearchResults","abort","AbortController","suggest","toLowerCase","includes","trim","filterGroupsByText","rest","img","require","user","currentUser","setUser","loadUserInfo","userInfo","getCurrentUserInfo","PERSIST_ACTIONS","PERSIST_CONTSTANS","rootReducer","combineReducers","eventReducer","actualEventsReducer","rubricEventsReducer","selectionsReducer","selectionEventsReducer","cityReducer","cityListReducer","searchReducer","menuReducer","dateFilterReducer","recommendedReducer","userReducer","store","configureStore","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","persistor","persistStore","DateFilterSkeleton","MainScreenSkeleton","content","Component","MainScreen","useSelector","PageHeader","EventSkeleton","button","gallery","recommended","EventScreen","SelectionScreenSkeleton","RubricScreen","SelectionScreen","TextInput","forwardRef","input","SuggestInput","inputRef","setValue","onChange","e","target","focus","defaultValue","placeholder","SearchResultSkeleton","SearchResult","isThrottleLoading","time","setThrottleLoading","newTimerId","clearTimeout","useThrottleLoading","EventCard","notFound","PopularResultSkeleton","showTitle","Index","onLinkClick","i","link","SearchScreen","hasQuery","setHasQuery","onInputChange","throttle","onSearchClose","header","BackwardButton","PopularResult","MenuItem","exact","activeClassName","MenuList","AuthBox","username","avatar","MenuGeoLabel","setCityModalVisibleCallback","onCitySelectLabelClickHandle","wrapper","select","MenuModal","wasClosed","setWasClosed","onClose","noop","stopPropagation","Checkbox","label","checkbox","CityChange","openCityModal","onSaveClick","onGeolocationChanged","selectedCity","wrapper_loading","checked","selected","CityOption","onCityClick","onCitySelectHandler","CitySelectContent","CitySelect","onCitySelect","suggestedItems","onSuggestChangeHandler","indexOf","CityModal","isModalVisible","setModalVisible","contentRef","React","previousCity","previousValue","usePrevious","selectCity","wasClosedModalChange","setWasClosedModalChange","wasClosedModalSelect","setWasClosedModalSelect","visibleModalChange","setVisibleModalChange","visibleModalSelect","setVisibleModalSelect","isChecked","saveCity","useClickAway","Navigator","path","App","cityModalVisible","setCityModalVisible","body","overflow","polyfillPromises","PolyfillApp","canRender","setCanRender","ReactDOM","render","loading","getElementById"],"mappings":"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","file":"static/js/main.5040ce97.chunk.js","sourcesContent":["import { PersistConfig, createTransform } from 'redux-persist';\nimport { StateReconciler } from 'redux-persist/es/types';\nimport { parse } from 'date-fns';\n// @ts-ignore\nimport createIdbStorage from '@piotr-cz/redux-persist-idb-storage/src';\n\nexport type Filter = {\n    [key: string]: string | number;\n};\nexport function createPersistKeyByFilter(filter: Filter) {\n    return JSON.stringify(filter, Object.keys(filter).sort());\n}\n\nexport function restoreFilterFromPersistKey<T>(key: keyof T): Filter {\n    return JSON.parse(key as string);\n}\n\ntype State = { [key: string]: Record<string, unknown> };\n\nexport function stateReconcilerByDate<T extends State>(inboundState: T): T {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const nowTime = today.getTime();\n\n    return Object.keys(inboundState)\n        .filter(key => key !== '_persist')\n        .reduce<T>((result, key: keyof T) => {\n            result[key] = Object.keys(inboundState[key]).reduce((inboundResult, inboundKey: keyof T[keyof T]) => {\n                const { date } = restoreFilterFromPersistKey(inboundKey);\n\n                // Если фильтра по дате нет, то данные не зависят от времени\n                if (!date) {\n                    inboundResult[inboundKey] = inboundState[key][inboundKey];\n                    return inboundResult;\n                }\n\n                const keyTime = parse(date).getTime();\n\n                // Оставляем только актуальные данные\n                if (nowTime <= keyTime) {\n                    inboundResult[inboundKey] = inboundState[key][inboundKey];\n                }\n\n                return inboundResult;\n            }, {} as T[keyof T]);\n\n            return result;\n        }, {} as T);\n}\n\ntype PersistOptions<S> = Omit<PersistConfig<S>, 'key' | 'storage'> & {\n    stateReconciler?: StateReconciler<S>;\n};\nexport function getPersistConfig<S>(key: string, options?: PersistOptions<S>): PersistConfig<S> {\n    return {\n        ...options,\n        storage: createIdbStorage({\n            name: 'miniapp-example',\n            storeName: 'redux-persist',\n        }),\n        key,\n        serialize: false,\n        // @ts-ignore\n        deserialize: false,\n        version: 3,\n        migrate: (persistedState, currentVersion) => {\n            // Достаем версию сохраненных в кэше данных.\n            const persistedVersion = persistedState && persistedState._persist.version;\n            // Если версия сохраненных данных совпадает с текущей версией обрабатываемых данных,\n            // оставляем данные неизменными, иначе - сбрасываем данные.\n            const migratedState = persistedVersion === currentVersion ? persistedState : undefined;\n\n            return Promise.resolve(migratedState);\n        },\n        timeout: 10000, // 10 секунд может быть полезно для low-end устройств\n    };\n}\n\nexport function getTransformUIPersistance<T>(defaultUIState: T) {\n    return createTransform((state: State, key) => {\n        if (key === 'ui') {\n            return defaultUIState;\n        }\n\n        return state;\n    });\n}\n","import React from 'react';\n\nimport styles from './styles.module.css';\n\ntype RectProps = {\n    className?: string;\n    width?: number | string;\n    height?: number | string;\n    borderRadius?: number;\n};\n\nexport const Rect: React.FC<RectProps> = ({ className, width, height }) => {\n    return <div className={mix(styles.rect, className)} style={{ width, height }} />;\n};\n\ntype TextProps = {\n    className?: string;\n    width?: number | string;\n    size?: number;\n};\n\nexport const Text: React.FC<TextProps> = ({ className, width, size }) => {\n    return <div className={mix(styles.text, className)} style={{ width, height: size }} />;\n};\n\nfunction mix(...classNames: Array<string | null | undefined>) {\n    return classNames.filter(Boolean).join(' ');\n}\n","import { getDistanceBetweenPoints } from '../geolocation';\nimport {\n    RubricEventsResponse,\n    ActualEventsResponse,\n    EventResponse,\n    SelectionsResponse,\n    SelectionEventsResponse,\n    CityInfoResponse,\n    CityListResponse,\n    SuggestResponse,\n    RecommendedEventsResponse,\n} from './types';\nimport { City } from './fragments/city';\n\nexport const MOSCOW = {\n    name: 'Москва',\n    geoid: 213,\n    longitude: 37.611347,\n    latitude: 55.760241,\n} as const;\n\ntype DateFilter = {\n    date: string;\n    period: number;\n};\n\nexport type GetEventsOptions = {\n    geoid: number;\n    offset?: number;\n    limit?: number;\n} & Partial<DateFilter>;\n\ntype GetCityInfoOptions = {\n    longitude: number;\n    latitude: number;\n};\n\nexport type GetSelectionsOptions = DateFilter & { geoid: number };\n\ntype QueryParams = {\n    [key: string]: string | number | string[] | undefined;\n};\n\nfunction queryParams(params: QueryParams) {\n    return Object.keys(params)\n        .map(k => {\n            const encodeKey = encodeURIComponent(k);\n\n            if (Array.isArray(params[k])) {\n                return (params[k] as string[]).map(v => `${encodeKey}=${encodeURIComponent(v)}`).join('&');\n            }\n\n            return `${encodeKey}=${encodeURIComponent(params[k]!.toString())}`;\n        })\n        .join('&');\n}\n\nasync function request<T extends object>(url: string, query?: QueryParams, signal?: AbortSignal): Promise<T> {\n    const response = await fetch(\n        [process.env.REACT_APP_API_HOST, url, query ? '?' + queryParams(query) : ''].join(''),\n        { signal }\n    );\n\n    if (response.ok) {\n        return response.json();\n    }\n\n    return Promise.reject(response);\n}\n\nexport function fetchEvent(id: string) {\n    return request<EventResponse>(`/api/event/${id}.json`);\n}\n\nexport function fetchRubricEvents(tag: string, options?: GetEventsOptions) {\n    return request<RubricEventsResponse>(`/api/rubric-events/${tag}.json`, options);\n}\n\nexport function fetchActualEvents(options?: GetEventsOptions) {\n    return request<ActualEventsResponse>('/api/actual-events.json', options);\n}\n\nexport function fetchSelections(options?: GetSelectionsOptions) {\n    return request<SelectionsResponse>('/api/selections.json', options);\n}\n\nexport async function fetchCityInfo(options: GetCityInfoOptions): Promise<CityInfoResponse> {\n    const cityList = await fetchCityList();\n\n    const citiesWithDistance = cityList.cities.map(city => {\n        const distance = getDistanceBetweenPoints(options.latitude, options.longitude, city.latitude, city.longitude);\n\n        return {\n            ...city,\n            distance,\n        };\n    });\n\n    let minDistance = Infinity;\n\n    const nearestCity: City = citiesWithDistance.reduce<City>(\n        (nearestCity, city) => {\n            if (city.distance < minDistance) {\n                minDistance = city.distance;\n\n                delete city.distance;\n\n                return city;\n            }\n\n            return nearestCity;\n        },\n        {\n            ...MOSCOW,\n            eventsMenu: [],\n        }\n    );\n\n    return {\n        cityInfo: nearestCity,\n    };\n}\n\nexport function fetchCityList() {\n    return request<CityListResponse>('/api/city-list.json');\n}\n\nexport function fetchSelectionEvents(code: string, options?: GetEventsOptions) {\n    return request<SelectionEventsResponse>(`/api/selection-events/${code}.json`, options);\n}\n\nexport function fetchSuggest(text: string, geoid: number, signal: AbortSignal) {\n    return request<SuggestResponse>('/api/suggest.json', { text, geoid }, signal);\n}\n\nexport function fetchRecommendedEvents(options?: GetEventsOptions) {\n    return request<RecommendedEventsResponse>('/api/recommended-events.json', options);\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"image\":\"styles_image__Xibal\",\"button-wrapper\":\"styles_button-wrapper__1xmRh\",\"button\":\"styles_button__3ugFI\",\"date-1\":\"styles_date-1__1KrEV\",\"date-2\":\"styles_date-2__u1uuX\",\"map\":\"styles_map__1GZMr\",\"place-1\":\"styles_place-1__2BRJQ\",\"place-2\":\"styles_place-2__1cKpq\",\"gallery\":\"styles_gallery__33Vja\",\"gallery-header\":\"styles_gallery-header__2mb0M\",\"gallery-content\":\"styles_gallery-content__3RMTY\",\"gallery-card\":\"styles_gallery-card__1qkm9\",\"description\":\"styles_description__hdSqE\",\"description-line-1\":\"styles_description-line-1__26Xb3\",\"description-line-2\":\"styles_description-line-2__20hRv\",\"description-line-3\":\"styles_description-line-3__1VXVh\",\"description-line-4\":\"styles_description-line-4__2BYM0\",\"description-line-5\":\"styles_description-line-5__3aCps\",\"recommended\":\"styles_recommended__3JCFj\"};","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { fetchEvent } from '../../lib/api';\nimport { EventResponse } from '../../lib/api/types';\nimport { getPersistConfig, getTransformUIPersistance } from '../helpers/persist';\nimport { AppThunk } from '..';\n\nexport type Event = EventResponse['event'];\nexport type ScheduleInfo = EventResponse['scheduleInfo'];\n\nexport type EventPage = {\n    event: Event | null;\n    schedule: ScheduleInfo | null;\n    updatedAt: number;\n};\nexport type EventPageState = {\n    data: { [id: string]: EventPage };\n    ui: { [id: string]: { isLoading: boolean; isUpdating: boolean } };\n};\n\nconst initialState: EventPageState = {\n    data: {},\n    ui: {},\n};\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'event',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ id: string }>) {\n            const { id } = action.payload;\n\n            if (!state.data[id]) {\n                state.data[id] = {\n                    event: null,\n                    schedule: null,\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[id]) {\n                state.ui[id] = {\n                    isLoading: false,\n                    isUpdating: false,\n                };\n            }\n\n            if (!state.data[id].event) {\n                state.ui[id].isLoading = true;\n            } else {\n                state.ui[id].isUpdating = true;\n            }\n        },\n        fetchSuccess(state, action: PayloadAction<{ id: string; event: EventResponse }>) {\n            const { id, event } = action.payload;\n\n            state.data[id].event = event.event;\n            state.data[id].schedule = event.scheduleInfo;\n            state.data[id].updatedAt = Date.now();\n            state.ui[id].isLoading = false;\n            state.ui[id].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ id: string; error: Error }>) {\n            const { id } = action.payload;\n\n            state.ui[id].isLoading = false;\n            state.ui[id].isUpdating = false;\n        },\n        setEvents(state, action: PayloadAction<{ events: EventResponse[] }>) {\n            const { events } = action.payload;\n\n            events.forEach(event => {\n                if (!event) {\n                    return;\n                }\n\n                const { id } = event.event;\n\n                if (!state.data[id]) {\n                    state.data[id] = {\n                        event: null,\n                        schedule: null,\n                        updatedAt: 0,\n                    };\n                }\n                if (!state.ui[id]) {\n                    state.ui[id] = {\n                        isLoading: false,\n                        isUpdating: false,\n                    };\n                }\n\n                state.data[id].event = event.event;\n                state.data[id].schedule = event.scheduleInfo;\n                state.data[id].updatedAt = Date.now();\n            });\n        },\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError, setEvents } = slice.actions;\n\nexport const loadEvent = (id: string): AppThunk => async(dispatch, getState) => {\n    const event = getState().event.data[id];\n\n    if (event && event.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ id }));\n\n    try {\n        const event = await fetchEvent(id);\n        dispatch(fetchSuccess({ id, event }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ id, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<EventPageState>('events', {\n    transforms: [getTransformUIPersistance<EventPageState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"page-header\":\"styles_page-header__3SRj-\",\"page-header_clear\":\"styles_page-header_clear__1-0qG\",\"menu-button\":\"styles_menu-button__27a1S\",\"backward-button\":\"styles_backward-button__1gLVd\",\"burger-menu-icon\":\"styles_burger-menu-icon__30H4q\",\"logo\":\"styles_logo__3HQmN\",\"suggest-button\":\"styles_suggest-button__jwrxc\",\"suggest-icon\":\"styles_suggest-icon__YMWw5\",\"icon-white\":\"styles_icon-white__3C4HZ\",\"icon-black\":\"styles_icon-black__3s7hW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"screen\":\"styles_screen__3Xc2f\",\"hidden\":\"styles_hidden__319gL\",\"screenEnter\":\"styles_screenEnter__1cDTX\",\"screenEnterActive\":\"styles_screenEnterActive__3Aipd\",\"screenExit\":\"styles_screenExit__16_m_\",\"screenExitActive\":\"styles_screenExitActive__9q_ED\",\"offset\":\"styles_offset__3ZkO6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"styles_wrapper__1LBcn\",\"wrapper_loading\":\"styles_wrapper_loading__3wiy0\",\"wrapper-visible_yes\":\"styles_wrapper-visible_yes__1gZE6\",\"slideUp\":\"styles_slideUp__ugjBN\",\"wrapper-visible_no\":\"styles_wrapper-visible_no__3CTrI\",\"slideDown\":\"styles_slideDown__1-rC7\",\"title\":\"styles_title__2H0i0\",\"auto-select-box\":\"styles_auto-select-box__1KSTl\",\"selected\":\"styles_selected__3i7jO\",\"selected-city-label\":\"styles_selected-city-label__107bE\",\"selected-city-name\":\"styles_selected-city-name__3y9wk\",\"button\":\"styles_button__32WSn\"};","type QueryParams = Record<string, string>;\n\nexport function getMainPageUrl() {\n    return '/';\n}\n\nexport function getEventUrl(id: string) {\n    return `/event/${id}`;\n}\n\nexport function getEventGalleryUrl(id: string, query: QueryParams) {\n    const params = query ? `?${new URLSearchParams(query)}` : '';\n\n    return `/event/${id}/gallery${params}`;\n}\n\nexport function getRubricUrl(code: string) {\n    return `/events/${encodeURIComponent(code)}`;\n}\n\nexport function getSelectionUrl(code: string) {\n    return `/selection/${encodeURIComponent(code)}`;\n}\n\nexport function getSearchUrl() {\n    return '/search';\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { getPersistConfig } from '../helpers/persist';\n\nimport { MenuTag } from '../../lib/api/fragments/city';\n\nexport type Menu = {\n    visible: boolean;\n    items: Array<MenuTag>;\n    activeItem: MenuTag['code'];\n};\n\nconst initialState: Menu = {\n    visible: false,\n    items: [],\n    activeItem: '',\n};\n\nconst menu = createSlice({\n    name: 'menu',\n    initialState,\n    reducers: {\n        setItems(state, action: PayloadAction<MenuTag[]>) {\n            state.items = action.payload;\n        },\n        setVisible(state, action: PayloadAction<boolean>) {\n            state.visible = action.payload;\n        },\n    },\n});\n\nexport const { setItems, setVisible } = menu.actions;\n\nconst persistConfig = getPersistConfig<Menu>('menu');\nexport default persistReducer(persistConfig, menu.reducer);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"style_card__2T-VX\",\"title\":\"style_title__RuqCf\",\"annotation\":\"style_annotation__n8doS\",\"image-wrapper\":\"style_image-wrapper__3JJK-\",\"image-overlay\":\"style_image-overlay__29ffx\",\"image\":\"style_image__Lux1b\",\"preview\":\"style_preview__3loTl\"};","export const isIOS = (): boolean =>\n    (/iPad|iPhone|iPod/.test(navigator.platform) ||\n        /iPad|iPhone|iPod/.test(navigator.userAgent) ||\n        (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&\n    !window.MSStream;\n","import { lazy } from 'react';\n\ntype LazyDeferred = typeof lazy;\n\n// Минимальное время перед импортом, чтобы дать отрисоваться скелетону\nconst LAZY_DEFFERED_SLEEP = 50;\n// Минимальное время импорта компонента\nconst LAZY_DEFFERED_DELAY = 500;\n\nexport const lazyDeferred: LazyDeferred = importCallback => {\n    type LazyImportType = ReturnType<typeof importCallback>;\n\n    return lazy(() =>\n        Promise.all<LazyImportType, void>([\n            new Promise<LazyImportType>(resolve => setTimeout(() => resolve(importCallback()), LAZY_DEFFERED_SLEEP)),\n            new Promise<void>(resolve => setTimeout(resolve, LAZY_DEFFERED_DELAY)),\n        ]).then(([module]) => module)\n    );\n};\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"feed\":\"styles_feed__RntQS\",\"title\":\"styles_title__2JRen\",\"events\":\"styles_events___mJxb\",\"item\":\"styles_item__2O9gA\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__2LqZR\",\"avatar\":\"styles_avatar__1qTlr\",\"avatar-image\":\"styles_avatar-image__2x2wh\",\"stub\":\"styles_stub__vgW5R\",\"username\":\"styles_username__MPrq4\"};","import React, { ComponentType } from 'react';\n\nimport { DEFAULT_ITEMS_GAP } from '../constants';\n\nimport styles from './styles.module.css';\n\ntype Props = {\n    count: number;\n    card: ComponentType;\n    itemsGap?: number;\n};\n\nconst EventsListSkeleton: React.FC<Props> = ({ itemsGap = DEFAULT_ITEMS_GAP, count, card: Card }) => (\n    <div className={styles.events} style={{ gridGap: `${itemsGap}px` }}>\n        {Array(count)\n            .fill(0)\n            .map((_, index) => (\n                <Card key={index} />\n            ))}\n    </div>\n);\n\nexport default EventsListSkeleton;\n","import { useContext, useMemo } from 'react';\n\nimport { StackNavigatorContext } from './context';\nimport { BackwardProps } from './StackNavigator';\n\nexport function useBackward(params?: BackwardProps) {\n    const onBackward = useContext(StackNavigatorContext).onBackward;\n\n    return useMemo(() => onBackward.bind(null, params), [onBackward, params]);\n}\n\nexport function useScreenVisible() {\n    return useContext(StackNavigatorContext).isVisible;\n}\n\nexport function useScreenRef() {\n    return useContext(StackNavigatorContext).ref;\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { fetchSelections } from '../../lib/api';\nimport { SelectionsResponse } from '../../lib/api/types';\nimport { EventPreview } from '../../lib/api/fragments/event-preview';\n\nimport {\n    createPersistKeyByFilter,\n    stateReconcilerByDate,\n    getPersistConfig,\n    getTransformUIPersistance,\n} from '../helpers/persist';\nimport { AppThunk, RootReducer } from '../index';\nimport { DateFilter } from './date-filter';\n\nexport type SelectionsState = {\n    data: {\n        [key: string]: {\n            items: Selection[];\n            updatedAt: number;\n        };\n    };\n    ui: {\n        [key: string]: {\n            isLoading: boolean;\n            isUpdating: boolean;\n        };\n    };\n};\n\nexport type Selection = {\n    code: string;\n    title: string;\n    count: number;\n    image: EventPreview['image'];\n};\n\nconst initialState: SelectionsState = {\n    data: {},\n    ui: {},\n};\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'selections',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = {\n                    items: [],\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = {\n                    isLoading: false,\n                    isUpdating: false,\n                };\n            }\n\n            if (!state.data[key].items.length) {\n                state.ui[key].isLoading = true;\n            } else {\n                state.ui[key].isUpdating = true;\n            }\n        },\n        fetchSuccess(state, action: PayloadAction<{ key: string; items: SelectionsResponse['selections'] }>) {\n            const { key, items } = action.payload;\n\n            const selections: Selection[] = [];\n\n            for (const selection of items) {\n                if (!selection) {\n                    continue;\n                }\n\n                selections.push({\n                    code: selection.code,\n                    title: selection.title,\n                    count: selection.count,\n                    image:\n                        selection.events &&\n                        selection.events[0] &&\n                        selection.events[0].eventPreview &&\n                        selection.events[0].eventPreview.image,\n                });\n            }\n\n            state.data[key].items = selections;\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError } = slice.actions;\n\nexport const selectionsSelector = (state: RootReducer) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.selections.data[persistKey];\n};\n\nexport const selectionsUISelector = (state: RootReducer) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.selections.ui[persistKey];\n};\n\nexport const loadSelections = (dateFilter: DateFilter, geoid: number): AppThunk => async(dispatch, getState) => {\n    const key = createPersistKeyByFilter({ geoid, ...dateFilter });\n    const selections = getState().selections.data[key];\n\n    if (selections && selections.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ key: key }));\n\n    try {\n        const data = await fetchSelections({ ...dateFilter, geoid });\n        dispatch(fetchSuccess({ key, items: data.selections }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ key: key, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<SelectionsState>('selections', {\n    stateReconciler: stateReconcilerByDate,\n    transforms: [getTransformUIPersistance<SelectionsState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","import React, { memo, useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useHistory, Link } from 'react-router-dom';\n\nimport { setVisible as setMenuVisible } from '../../redux/slices/menu';\nimport { getMainPageUrl, getSearchUrl } from '../../lib/url-builder';\n\nimport BackwardButton from '../BackwardButton';\nimport ClearButton from '../ClearButton';\n\nimport styles from './styles.module.css';\n\nconst Logo: React.FC = () => (\n    <Link to={getMainPageUrl()} className={styles.logo}>\n        MiniApp Example\n    </Link>\n);\n\ntype IconProps = {\n    fill?: 'white' | 'black';\n};\n\nconst SuggestIcon: React.FC<IconProps> = ({ fill = 'black' }) => {\n    const className = [styles['suggest-icon'], styles[`icon-${fill}`]].join(' ');\n\n    return <span className={className} />;\n};\n\nfunction setMods(className: string, mods?: string) {\n    if (!mods) {\n        return styles[className];\n    }\n\n    return `${styles[className]} ${styles[`${className}_${mods}`]}`;\n}\n\nexport type Props = {\n    hasMenu?: boolean;\n    hasLogo?: boolean;\n    backward?: 'white' | 'black' | '';\n    mods?: 'clear' | '';\n};\n\nconst PageHeader: React.FC<Props> = props => {\n    const { hasMenu, hasLogo, backward, mods } = props;\n\n    const history = useHistory();\n    const dispatch = useDispatch();\n\n    const onSearchClick = useCallback(() => {\n        history.push(getSearchUrl());\n    }, [history]);\n\n    const onMenuClick = useCallback(() => {\n        dispatch(setMenuVisible(true));\n    }, [dispatch]);\n\n    return (\n        <header className={setMods('page-header', mods)}>\n            {Boolean(backward) && <BackwardButton className={styles['backward-button']} fill={backward || 'black'} />}\n            {Boolean(hasMenu) && (\n                <ClearButton className={styles['menu-button']} onClick={onMenuClick}>\n                    <span className={styles['burger-menu-icon']} />\n                </ClearButton>\n            )}\n            {hasLogo && <Logo />}\n            <ClearButton className={styles['suggest-button']} onClick={onSearchClick}>\n                <SuggestIcon fill={mods ? 'white' : 'black'} />\n            </ClearButton>\n        </header>\n    );\n};\n\nexport default memo(PageHeader);\n","import { createRef, createContext, RefObject } from 'react';\n\ntype StackNavigatorContextType = {\n    onBackward: () => void;\n    isVisible: boolean;\n    ref: RefObject<HTMLDivElement>;\n};\n\nexport const StackNavigatorContext = createContext<StackNavigatorContextType>({\n    onBackward: () => {},\n    isVisible: false,\n    ref: createRef(),\n});\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__2krq5\",\"image\":\"styles_image__3rHyi\",\"right\":\"styles_right__3yAG9\",\"title\":\"styles_title__1qP6K\",\"description\":\"styles_description__2Ze_3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"styles_input__ldYiA\",\"wrapper\":\"styles_wrapper__1qFlf\",\"wrapper-visible_yes\":\"styles_wrapper-visible_yes__3Xlii\",\"slideUp\":\"styles_slideUp__2GPyJ\",\"wrapper-visible_no\":\"styles_wrapper-visible_no__2Kq0Z\",\"slideDown\":\"styles_slideDown__3yIqZ\",\"city-list\":\"styles_city-list__2FmDB\",\"city-item\":\"styles_city-item__TNmcc\"};","import React from 'react';\n\nimport styles from './styles.module.css';\n\nexport type Props = {\n    className?: string;\n    onClick: () => void;\n};\nconst ClearButton: React.FC<Props> = ({ className, children, onClick }) => {\n    const cls = [styles.clear, className].filter(Boolean).join(' ');\n    return (\n        <button className={cls} onClick={onClick}>\n            {children}\n        </button>\n    );\n};\n\nexport default ClearButton;\n","export const DEFAULT_ITEMS_GAP = 18;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__eFyRm\",\"image\":\"styles_image__1XdLR\",\"title\":\"styles_title__2aX7M\",\"description\":\"styles_description__hf2zy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__2ZLnU\",\"image\":\"styles_image__1OXdh\",\"stub\":\"styles_stub__2rGlh\",\"stub-hidden\":\"styles_stub-hidden__wNOO_\",\"fadeIn\":\"styles_fadeIn__Wb4n6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"styles_title__1IJnF\",\"events\":\"styles_events__3m_nB\",\"event\":\"styles_event__15ocv\",\"link\":\"styles_link__OwBgq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"list\":\"style_list__1E8sL\",\"item\":\"style_item__2Gtnq\",\"link\":\"style_link__5kR7b\",\"active-item\":\"style_active-item__1n702\"};","import React, { useCallback, useState } from 'react';\n\nimport { MediaImageSize } from '../../lib/api/fragments/image-size';\n\nimport styles from './styles.module.css';\n\nconst emptyImage = 'data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=';\n\nexport type ImageProps = {\n    className?: string;\n    src?: MediaImageSize | null;\n    src2x?: MediaImageSize | null;\n    bgColor?: string | null;\n    alt?: string;\n};\n\nconst Image: React.FC<ImageProps> = props => {\n    const color = props.bgColor || '#555';\n    const [isLoaded, setLoaded] = useState(false);\n\n    const onLoad = useCallback(() => {\n        if (props.src) {\n            setLoaded(true);\n        }\n    }, [setLoaded, props.src]);\n    const stubClassNames = [styles.stub, isLoaded && styles['stub-hidden']].filter(Boolean).join(' ');\n    const containerClassNames = [props.className, styles.container].filter(Boolean).join(' ');\n\n    return (\n        <div className={containerClassNames}>\n            <img\n                className={styles.image}\n                onLoad={onLoad}\n                src={props.src ? props.src.url : emptyImage}\n                srcSet={props.src2x ? `${props.src2x.url} 2x` : undefined}\n                alt={props.alt}\n            />\n            <div className={stubClassNames} style={{ backgroundColor: color }} />\n        </div>\n    );\n};\n\nexport default Image;\n","import React from 'react';\n\nimport { Rect, Text } from '../../Skeletons';\n\nimport styles from './styles.module.css';\n\nconst EventCardSkeleton: React.FC = () => {\n    return (\n        <div className={styles.card}>\n            <Rect className={styles.image} />\n            <div className={styles.right}>\n                <Text className={styles.title} />\n                <Text className={styles.description} />\n            </div>\n        </div>\n    );\n};\n\nexport default EventCardSkeleton;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { ActualEvent } from '../../lib/api/fragments/actual-event';\n\nimport { fetchActualEvents } from '../../lib/api';\nimport {\n    createPersistKeyByFilter,\n    stateReconcilerByDate,\n    getPersistConfig,\n    getTransformUIPersistance,\n} from '../helpers/persist';\nimport { setEvents } from './event';\nimport { DateFilter } from './date-filter';\nimport { AppThunk, RootReducer } from '..';\n\nexport type ActualEventsListState = {\n    data: {\n        [key: string]: {\n            items: Array<ActualEvent | null>;\n            updatedAt: number;\n        };\n    };\n    ui: {\n        [key: string]: {\n            isLoading: boolean;\n            isUpdating: boolean;\n        };\n    };\n};\n\nconst initialState: ActualEventsListState = {\n    data: {},\n    ui: {},\n};\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'actual-events',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = {\n                    items: [],\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = {\n                    isLoading: false,\n                    isUpdating: false,\n                };\n            }\n\n            if (!state.data[key].items.length) {\n                state.ui[key].isLoading = true;\n            } else {\n                state.ui[key].isUpdating = true;\n            }\n        },\n        fetchSuccess(state, action: PayloadAction<{ key: string; items: Array<ActualEvent | null> }>) {\n            const { key, items } = action.payload;\n\n            state.data[key].items = items;\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError } = slice.actions;\n\nexport const actualEventsSelector = (state: RootReducer) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.actualEvents.data[persistKey];\n};\n\nexport const actualEventsUISelector = (state: RootReducer) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.actualEvents.ui[persistKey];\n};\n\nexport const loadActualEvents = (dateFilter: DateFilter, geoid: number): AppThunk => async(dispatch, getState) => {\n    const key = createPersistKeyByFilter({ geoid, ...dateFilter });\n    const events = getState().actualEvents.data[key];\n\n    if (events && events.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ key }));\n\n    try {\n        const { events } = await fetchActualEvents({ ...dateFilter, geoid });\n\n        if (events.prefetchItems) {\n            dispatch(setEvents({ events: events.prefetchItems }));\n            delete events.prefetchItems;\n        }\n\n        dispatch(fetchSuccess({ key, items: events.items }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ key, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<ActualEventsListState>('actual-events', {\n    stateReconciler: stateReconcilerByDate,\n    transforms: [getTransformUIPersistance<ActualEventsListState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { ActualEvents } from '../../lib/api/fragments/actual-events';\n\nimport { fetchRubricEvents } from '../../lib/api';\nimport {\n    createPersistKeyByFilter,\n    stateReconcilerByDate,\n    getPersistConfig,\n    getTransformUIPersistance,\n} from '../helpers/persist';\n\nimport { AppThunk, RootReducer } from '../index';\nimport { setEvents } from './event';\nimport { DateFilter } from './date-filter';\n\nexport type RubricEventsState = {\n    data: {\n        [key: string]: {\n            title: string;\n            events: ActualEvents;\n            hasMoreItems: boolean;\n            updatedAt: number;\n        };\n    };\n    ui: {\n        [key: string]: {\n            isLoading: boolean;\n            isLoadingMore: boolean;\n            isUpdating: boolean;\n        };\n    };\n};\n\nconst initialState: RubricEventsState = {\n    data: {},\n    ui: {},\n};\n\nconst loadMoreLimit = 10;\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'rubric-events',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = {\n                    title: '',\n                    events: {\n                        items: [],\n                        paging: { offset: 0, total: 0 },\n                    },\n                    hasMoreItems: false,\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = {\n                    isLoading: false,\n                    isLoadingMore: false,\n                    isUpdating: false,\n                };\n            }\n\n            if (!state.data[key].events.items.length) {\n                state.ui[key].isLoading = true;\n            } else {\n                state.ui[key].isUpdating = true;\n            }\n        },\n        fetchSuccess(state, action: PayloadAction<{ key: string; events: ActualEvents; title: string }>) {\n            const { key, events, title } = action.payload;\n\n            state.data[key].title = title;\n            state.data[key].events = events;\n            state.data[key].hasMoreItems = Boolean(events.paging.total > events.paging.offset + loadMoreLimit);\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchMoreStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoadingMore = true;\n        },\n        fetchMoreSuccess(state, action: PayloadAction<{ key: string; events: ActualEvents }>) {\n            const { key, events } = action.payload;\n\n            state.data[key].events.items.push(...events.items);\n            state.data[key].events.paging = events.paging;\n            state.data[key].hasMoreItems = Boolean(events.paging.total > events.paging.offset + loadMoreLimit);\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoadingMore = false;\n        },\n        fetchMoreError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoadingMore = false;\n        },\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError, fetchMoreStart, fetchMoreSuccess, fetchMoreError } = slice.actions;\n\nexport const rubricEventsSelector = (code: string) => (state: RootReducer) => {\n    const persistKey = createPersistKeyByFilter({\n        code,\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.rubricEvents.data[persistKey];\n};\n\nexport const rubricEventsUISelector = (code: string) => (state: RootReducer) => {\n    const persistKey = createPersistKeyByFilter({\n        code,\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.rubricEvents.ui[persistKey];\n};\n\nexport const loadRubricEvents = (code: string, dateFilter?: DateFilter): AppThunk => async(dispatch, getState) => {\n    const { geoid } = getState().city.currentCity;\n    const key = createPersistKeyByFilter({ geoid, code, ...dateFilter });\n    const events = getState().rubricEvents.data[key];\n\n    if (events && events.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ key }));\n\n    try {\n        const { title, events } = await fetchRubricEvents(code, {\n            geoid,\n            offset: 0,\n            limit: loadMoreLimit,\n            ...dateFilter,\n        });\n\n        if (events.prefetchItems) {\n            dispatch(setEvents({ events: events.prefetchItems }));\n            delete events.prefetchItems;\n        }\n\n        dispatch(fetchSuccess({ key, title, events }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ key, error: err }));\n    }\n};\n\nexport const loadMoreRubricEvents = (code: string, dateFilter?: DateFilter): AppThunk => async(dispatch, getState) => {\n    const { geoid } = getState().city.currentCity;\n    const key = createPersistKeyByFilter({ geoid, code, ...dateFilter });\n\n    dispatch(fetchMoreStart({ key }));\n\n    try {\n        const { offset } = getState().rubricEvents.data[key].events.paging;\n        const { events } = await fetchRubricEvents(code, {\n            geoid,\n            offset: offset + loadMoreLimit,\n            limit: loadMoreLimit,\n            ...dateFilter,\n        });\n\n        if (events.prefetchItems) {\n            dispatch(setEvents({ events: events.prefetchItems }));\n            delete events.prefetchItems;\n        }\n\n        dispatch(fetchMoreSuccess({ key, events }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchMoreError({ key, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<RubricEventsState>('rubric-events', {\n    stateReconciler: stateReconcilerByDate,\n    transforms: [getTransformUIPersistance<RubricEventsState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { fetchSelectionEvents } from '../../lib/api';\nimport { SelectionsResponse } from '../../lib/api/types';\nimport { ActualEvents } from '../../lib/api/fragments/actual-events';\n\nimport {\n    createPersistKeyByFilter,\n    restoreFilterFromPersistKey,\n    stateReconcilerByDate,\n    getPersistConfig,\n    getTransformUIPersistance,\n} from '../helpers/persist';\n\nimport { AppThunk, RootReducer } from '../index';\nimport { setEvents } from './event';\nimport { DateFilter } from './date-filter';\nimport { fetchSuccess as selectionsFetchSuccess } from './selections';\n\nexport type SelectionEventsState = {\n    data: {\n        [key: string]: {\n            title: string;\n            events: ActualEvents;\n            hasMoreItems: boolean;\n\n            updatedAt: number;\n        };\n    };\n    ui: { [key: string]: { isLoading: boolean; isLoadingMore: boolean; isUpdating: boolean } };\n};\n\nconst initialState: SelectionEventsState = {\n    data: {},\n    ui: {},\n};\n\nconst loadMoreLimit = 10;\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'selection-events',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = {\n                    title: '',\n                    events: {\n                        items: [],\n                        paging: { offset: 0, total: 0 },\n                    },\n                    hasMoreItems: false,\n\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = {\n                    isLoading: false,\n                    isLoadingMore: false,\n                    isUpdating: false,\n                };\n            }\n\n            if (!state.data[key].events.items.length) {\n                state.ui[key].isLoading = true;\n            } else {\n                state.ui[key].isUpdating = true;\n            }\n        },\n        fetchSuccess(state, action: PayloadAction<{ key: string; events: ActualEvents; title: string }>) {\n            const { key, events, title } = action.payload;\n\n            state.data[key].title = title;\n            state.data[key].events = events;\n            state.data[key].hasMoreItems = Boolean(events.paging.total > events.paging.offset + loadMoreLimit);\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchMoreStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = {\n                    title: '',\n                    events: {\n                        items: [],\n                        paging: { offset: 0, total: 0 },\n                    },\n                    hasMoreItems: false,\n\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = {\n                    isLoading: false,\n                    isLoadingMore: false,\n                    isUpdating: false,\n                };\n            }\n\n            state.ui[key].isLoadingMore = true;\n        },\n        fetchMoreSuccess(state, action: PayloadAction<{ key: string; events: ActualEvents }>) {\n            const { key, events } = action.payload;\n\n            state.data[key].events.items.push(...events.items);\n            state.data[key].events.paging = events.paging;\n            state.data[key].hasMoreItems = Boolean(events.paging.total > events.paging.offset + loadMoreLimit);\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoadingMore = false;\n        },\n        fetchMoreError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoadingMore = false;\n        },\n    },\n    extraReducers: builder => {\n        // Предзаполнение списка событий для всех подборок, загруженных на главной странице\n        builder.addCase(\n            selectionsFetchSuccess,\n            (state, action: PayloadAction<{ key: string; items: SelectionsResponse['selections'] }>) => {\n                const { key, items } = action.payload;\n                const filter = restoreFilterFromPersistKey(key);\n\n                for (const selection of items) {\n                    if (!selection) {\n                        continue;\n                    }\n\n                    const eventsKey = createPersistKeyByFilter({ code: selection.code, ...filter });\n                    const events = {\n                        items: selection.events,\n                        paging: { offset: 0, total: selection.count },\n                    };\n\n                    if (!state.data[eventsKey]) {\n                        state.data[eventsKey] = {\n                            title: selection.title,\n                            events,\n                            hasMoreItems: Boolean(selection.count > loadMoreLimit),\n                            // При переходе в подборку нужно обновить заголовок, поэтому считаем что данные не загружены\n                            updatedAt: 0,\n                        };\n                        state.ui[eventsKey] = {\n                            isLoading: false,\n                            isLoadingMore: false,\n                            isUpdating: false,\n                        };\n                    } else {\n                        state.data[eventsKey].events = events;\n                        state.data[eventsKey].hasMoreItems = Boolean(selection.count > loadMoreLimit);\n                        state.data[eventsKey].updatedAt = Date.now();\n                    }\n                }\n            }\n        );\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError, fetchMoreStart, fetchMoreSuccess, fetchMoreError } = slice.actions;\n\nexport const selectionEventsSelector = (code: string) => (state: RootReducer) => {\n    const persistKey = createPersistKeyByFilter({\n        code,\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.selectionEvents.data[persistKey];\n};\n\nexport const selectionEventsUISelector = (code: string) => (state: RootReducer) => {\n    const persistKey = createPersistKeyByFilter({\n        code,\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.selectionEvents.ui[persistKey];\n};\n\nexport const loadSelectionEvents = (code: string, dateFilter?: DateFilter): AppThunk => async(dispatch, getState) => {\n    const { geoid } = getState().city.currentCity;\n    const key = createPersistKeyByFilter({ geoid, code, ...dateFilter });\n    const events = getState().selectionEvents.data[key];\n\n    if (events && events.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ key }));\n\n    try {\n        const { title, events } = await fetchSelectionEvents(code, {\n            geoid,\n            offset: 0,\n            limit: loadMoreLimit,\n            ...dateFilter,\n        });\n\n        if (events.prefetchItems) {\n            dispatch(setEvents({ events: events.prefetchItems }));\n            delete events.prefetchItems;\n        }\n\n        dispatch(fetchSuccess({ key, title, events }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ key, error: err }));\n    }\n};\n\nexport const loadMoreSelectionEvents = (code: string, dateFilter?: DateFilter): AppThunk => async(\n    dispatch,\n    getState\n) => {\n    const { geoid } = getState().city.currentCity;\n    const key = createPersistKeyByFilter({ geoid, code, ...dateFilter });\n\n    dispatch(fetchMoreStart({ key }));\n\n    try {\n        const { offset } = getState().selectionEvents.data[key].events.paging;\n        const { events } = await fetchSelectionEvents(code, {\n            geoid,\n            offset: offset + loadMoreLimit,\n            limit: loadMoreLimit,\n            ...dateFilter,\n        });\n\n        if (events.prefetchItems) {\n            dispatch(setEvents({ events: events.prefetchItems }));\n            delete events.prefetchItems;\n        }\n\n        dispatch(fetchMoreSuccess({ key, events }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchMoreError({ key, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<SelectionEventsState>('selection-events', {\n    stateReconciler: stateReconcilerByDate,\n    transforms: [getTransformUIPersistance<SelectionEventsState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { ActualEvents } from '../../lib/api/fragments/actual-events';\n\nimport { fetchRecommendedEvents } from '../../lib/api';\nimport {\n    createPersistKeyByFilter,\n    stateReconcilerByDate,\n    getPersistConfig,\n    getTransformUIPersistance,\n} from '../helpers/persist';\nimport { setEvents } from './event';\nimport { AppThunk, RootReducer } from '..';\n\nexport type RecommendedEvents = {\n    top?: ActualEvents;\n    concert?: ActualEvents;\n    cinema?: ActualEvents;\n    theatre?: ActualEvents;\n    updatedAt: number;\n};\nexport type RecommendedEventsState = {\n    data: { [key: string]: RecommendedEvents };\n    ui: { [key: string]: { isLoading: boolean; isUpdating: boolean } };\n};\n\nconst initialState: RecommendedEventsState = {\n    data: {},\n    ui: {},\n};\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'recommended-events',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = { updatedAt: 0 };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = { isLoading: false, isUpdating: false };\n            }\n\n            if (!state.data[key].updatedAt) {\n                state.ui[key].isLoading = true;\n            } else {\n                state.ui[key].isUpdating = true;\n            }\n        },\n        fetchSuccess(\n            state,\n            action: PayloadAction<{\n                key: string;\n                data: Pick<RecommendedEvents, 'top' | 'concert' | 'cinema' | 'theatre'>;\n            }>\n        ) {\n            const { key, data } = action.payload;\n\n            state.data[key].top = data.top;\n            state.data[key].concert = data.concert;\n            state.data[key].cinema = data.cinema;\n            state.data[key].theatre = data.theatre;\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError } = slice.actions;\n\nexport const recommendedEventsSelector = (state: RootReducer) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n    });\n\n    return state.recommendedEvents.data[persistKey];\n};\n\nexport const recommendedEventsUISelector = (state: RootReducer) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n    });\n\n    return state.recommendedEvents.ui[persistKey];\n};\n\nexport const loadRecommendedEvents = (): AppThunk => async(dispatch, getState) => {\n    const { geoid } = getState().city.currentCity;\n    const key = createPersistKeyByFilter({ geoid });\n    const events = getState().recommendedEvents.data[key];\n\n    if (events && events.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ key }));\n\n    try {\n        const data = await fetchRecommendedEvents({ geoid });\n\n        dispatch(\n            setEvents({\n                events: [\n                    ...(data.top?.prefetchItems || []),\n                    ...(data.cinema?.prefetchItems || []),\n                    ...(data.concert?.prefetchItems || []),\n                    ...(data.theatre?.prefetchItems || []),\n                ],\n            })\n        );\n\n        if (data.top?.prefetchItems) delete data.top.prefetchItems;\n        if (data.cinema?.prefetchItems) delete data.cinema.prefetchItems;\n        if (data.concert?.prefetchItems) delete data.concert.prefetchItems;\n        if (data.theatre?.prefetchItems) delete data.theatre.prefetchItems;\n\n        dispatch(fetchSuccess({ key, data }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ key, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<RecommendedEventsState>('recommended-events', {\n    stateReconciler: stateReconcilerByDate,\n    transforms: [getTransformUIPersistance<RecommendedEventsState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","const GEOLOCATIONS_OPTIONS = {\n    timeout: 10000,\n    maximumAge: 60 * 60 * 1000,\n};\n\nexport async function getCurrentPosition(): Promise<Coordinates> {\n    return new Promise((resolve, reject) => {\n        const resolveCallback = (position: Position) => resolve(position.coords);\n\n        window.navigator.geolocation.getCurrentPosition(resolveCallback, reject, GEOLOCATIONS_OPTIONS);\n    });\n}\n\nfunction deg2rad(deg: number) {\n    return deg * (Math.PI / 180);\n}\n\n// http://en.wikipedia.org/wiki/Haversine_formula\nexport function getDistanceBetweenPoints(lat1: number, lon1: number, lat2: number, lon2: number): number {\n    const R = 6371; // Радиус земли в КМ\n\n    const tmp =\n        Math.sin(deg2rad(lat2 - lat1) / 2) * Math.sin(deg2rad(lat2 - lat1) / 2) +\n        Math.cos(deg2rad(lat1)) *\n            Math.cos(deg2rad(lat2)) *\n            Math.sin(deg2rad(lon2 - lon1) / 2) *\n            Math.sin(deg2rad(lon2 - lon1) / 2);\n\n    return 2 * R * Math.asin(Math.sqrt(tmp));\n}\n","import React from 'react';\n\nimport Button from '../ClearButton';\nimport { useBackward } from '../StackNavigator/hooks';\n\nimport styles from './styles.module.css';\n\ntype Props = {\n    fill?: 'white' | 'black';\n    className?: string;\n};\n\nconst BackwardIcon: React.FC<Props> = ({ fill = 'white' }) => {\n    const classNames = [styles['backward-icon'], styles[`icon-${fill}`]].join(' ');\n\n    return <span className={classNames} />;\n};\n\nconst Backward: React.FC<Props> = props => {\n    const onClick = useBackward();\n\n    return (\n        <Button className={[styles['backward-button'], props.className].filter(Boolean).join(' ')} onClick={onClick}>\n            <BackwardIcon fill={props.fill} />\n        </Button>\n    );\n};\n\nexport default Backward;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"backward-icon\":\"styles_backward-icon__3EK-Q\",\"icon-white\":\"styles_icon-white__30Xrl\",\"icon-black\":\"styles_icon-black__1FNaZ\",\"backward-button\":\"styles_backward-button__d5kZC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"styles_content__2Cnjx\",\"title\":\"styles_title__XAM43\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"menu-modal\":\"style_menu-modal__34sP4\",\"menu-modal-content\":\"style_menu-modal-content__2MGuN\",\"menu-modal-visible_yes\":\"style_menu-modal-visible_yes__md9xJ\",\"fadeIn\":\"style_fadeIn__1YwV8\",\"slideLeft\":\"style_slideLeft__3cAXG\",\"menu-modal-visible_no\":\"style_menu-modal-visible_no__32zFU\",\"fadeOut\":\"style_fadeOut__3Z8C2\",\"slideRight\":\"style_slideRight__2-BgZ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"loading\":\"styles_loading__l2xXc\",\"rect\":\"styles_rect__39Mf0\",\"text\":\"styles_text__O_35F\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"styles_block__fQZVR\",\"filter\":\"styles_filter__2Vym1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"styles_block__10trK\",\"item\":\"styles_item__2uVU7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"styles_content__3nFVw\",\"title\":\"styles_title__2inpl\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"list\":\"style_list__3pVg_\",\"wrapper\":\"style_wrapper__IWliN\",\"button\":\"style_button__2GIxG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"price\":\"styles_price__1D8ax\",\"left\":\"styles_left__3RisO\",\"right\":\"styles_right__3KXqq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"styles_title__3XLML\",\"notFound\":\"styles_notFound__2R52E\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"styles_title__3xg9O\",\"event\":\"styles_event__3FTWc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"styles_header__2L4R0\",\"content\":\"styles_content__1NmrT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"styles_wrapper__15WSd\",\"select\":\"styles_select__1BaqC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"checkbox\":\"styles_checkbox__3iL51\",\"label\":\"styles_label__3hGrm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"city-modal\":\"styles_city-modal__1AgdR\",\"city-modal-visible_yes\":\"styles_city-modal-visible_yes__3Ub-H\",\"fadeIn\":\"styles_fadeIn__26BAg\",\"city-modal-visible_no\":\"styles_city-modal-visible_no__1NmRJ\",\"fadeOut\":\"styles_fadeOut__1X9f5\"};","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { dateToString } from '../../lib/date';\n\nexport type DateFilter = {\n    date: string;\n    period: number;\n};\n\nconst initialState: DateFilter = {\n    date: dateToString(new Date()).toString(),\n    period: 1,\n};\n\nconst dateFilter = createSlice({\n    name: 'date-filter',\n    initialState,\n    reducers: {\n        setDate(state, action: PayloadAction<{ date: string; period?: number }>) {\n            state.date = action.payload.date;\n            state.period = action.payload.period || 1;\n        },\n    },\n});\n\nexport const { setDate } = dateFilter.actions;\n\nexport default dateFilter.reducer;\n","import { format, parse } from 'date-fns';\n\nexport const dateToString = (date: Date) => format(date, 'YYYY-MM-DD').toString();\nexport const parseDate = (date: string) => parse(date);\n","import { RefObject, useEffect, useMemo } from 'react';\n\nimport { useVisible } from './useVisible';\n\ntype InfiniteScrollOptions = {\n    ref: RefObject<HTMLElement>;\n    isLoading: boolean;\n    hasMore: boolean;\n    loadMore: () => void;\n    threshold?: number;\n};\n\nexport function useInfiniteScroll({ threshold, ref, isLoading, loadMore, hasMore }: InfiniteScrollOptions) {\n    const options = useMemo<IntersectionObserverInit>(() => {\n        return {\n            rootMargin: `0px 0px ${threshold || 0}px 0px`,\n        };\n    }, [threshold]);\n\n    const needLoadMore = useVisible(ref, options) || false;\n\n    useEffect(() => {\n        if (!hasMore) return;\n        if (isLoading) return;\n\n        if (needLoadMore) {\n            loadMore();\n        }\n    }, [needLoadMore, loadMore, hasMore, isLoading]);\n}\n","import { RefObject, useLayoutEffect, useState, useRef } from 'react';\n\nexport function useVisible(ref: RefObject<HTMLElement>, options?: IntersectionObserverInit) {\n    // Пока не навешан обработчик на элемент, мы точно не можем сказать видим он или нет,\n    // поэтому начальное значение undefined\n    const [isVisible, setVisible] = useState<boolean>();\n    const optionsRef = useRef(options);\n\n    useLayoutEffect(() => {\n        if (!ref.current) {\n            return;\n        }\n\n        if (options !== optionsRef.current && process.env.NODE_ENV === 'development') {\n            optionsRef.current = options;\n\n            console.warn(\n                '[useVisible] Изменились опции для IntersectionObserver. Это может приводить к существенному падению производительности при скролле.'\n            );\n        }\n\n        const observer = new IntersectionObserver(([entry]) => {\n            setVisible(entry.isIntersecting);\n        }, options);\n\n        observer.observe(ref.current);\n\n        return () => {\n            observer.disconnect();\n        };\n    }, [ref, options]);\n\n    return isVisible;\n}\n","import React, { ReactElement, useRef } from 'react';\n\nimport { ActualEvent } from '../../lib/api/fragments/actual-event';\nimport { useInfiniteScroll } from '../../hooks/useInfiniteScroll';\nimport { usePaginatedList } from '../../hooks/usePaginatedList';\n\nimport { DEFAULT_ITEMS_GAP } from './constants';\n\nimport styles from './style.module.css';\n\ntype BaseProps = {\n    items: Array<ActualEvent | null>;\n    component: React.FC<{ event: ActualEvent; onClick?: () => void }>;\n    onItemClick?: () => void;\n    itemsGap?: number;\n};\n\ntype StaticProps = BaseProps & {\n    type?: 'static';\n};\n\ntype LoadableProps = BaseProps & {\n    type: 'loadable';\n    pageSize: number;\n    loadMore: () => void;\n    hasMore: boolean;\n    isLoadingMore: boolean;\n    skeleton: ReactElement;\n};\n\ntype Props = StaticProps | LoadableProps;\n\nconst EventsList: React.FC<Props> = props => {\n    const { itemsGap = DEFAULT_ITEMS_GAP } = props;\n\n    if (props.type === 'loadable') {\n        return <EventsListLoadable {...props} />;\n    }\n\n    return (\n        <div className={styles.list} style={{ gridGap: `${itemsGap}px` }}>\n            <EventsListItems {...props} />\n        </div>\n    );\n};\n\nconst EventsListLoadable: React.FC<LoadableProps> = props => {\n    const { itemsGap = DEFAULT_ITEMS_GAP } = props;\n    const loadMoreRef = useRef<HTMLDivElement | null>(null);\n\n    const [events, hasMore, loadMore] = usePaginatedList({\n        items: props.items,\n        hasMore: props.hasMore,\n        loadMore: props.loadMore,\n        pageSize: props.pageSize,\n    });\n\n    useInfiniteScroll({\n        ref: loadMoreRef,\n        isLoading: props.isLoadingMore,\n        hasMore,\n        loadMore,\n        threshold: 200,\n    });\n\n    return (\n        <div className={styles.list} style={{ gridGap: `${itemsGap}px` }}>\n            <EventsListItems {...props} items={events} />\n            {props.isLoadingMore && props.skeleton}\n            <div ref={loadMoreRef} />\n        </div>\n    );\n};\n\nconst EventsListItems: React.FC<BaseProps> = props => {\n    return (\n        <>\n            {props.items.map((actualEvent, index) => {\n                if (!actualEvent) {\n                    return null;\n                }\n\n                return <props.component key={index} event={actualEvent} onClick={props.onItemClick} />;\n            })}\n        </>\n    );\n};\n\nexport default EventsList;\n","import { useCallback, useMemo, useState } from 'react';\n\ntype PaginatedListOptions<T> = {\n    items: T[];\n    hasMore: boolean;\n    loadMore: () => void;\n    pageSize: number;\n};\n\nexport function usePaginatedList<T>(options: PaginatedListOptions<T>): [T[], boolean, () => void] {\n    const { items, hasMore, loadMore, pageSize } = options;\n\n    const [limit, setLimit] = useState(pageSize);\n    const events = useMemo(() => items.slice(0, limit), [items, limit]);\n\n    const wrappedLoadMore = useCallback(() => {\n        if (items.length > limit) {\n            setLimit(limit + pageSize);\n        } else {\n            loadMore();\n        }\n    }, [loadMore, limit, pageSize, items]);\n\n    const wrappedHasMore = hasMore || limit < items.length;\n\n    return [events, wrappedHasMore, wrappedLoadMore];\n}\n","import React, { memo } from 'react';\nimport { Link } from 'react-router-dom';\n\nimport { getEventUrl } from '../../lib/url-builder';\nimport { ActualEvent } from '../../lib/api/fragments/actual-event';\n\nimport Image from '../Image';\nimport PriceLabel from '../PriceLabel';\n\nimport styles from './style.module.css';\n\nexport type Props = {\n    event: ActualEvent;\n    onClick?: () => void;\n};\n\nconst EventCard: React.FC<Props> = props => {\n    const { id, title, argument, image, tickets } = props.event.eventPreview;\n    const ticket = tickets && tickets[0];\n\n    return (\n        <Link to={getEventUrl(id)} className={styles.card} onClick={props.onClick}>\n            <div className={styles['image-wrapper']}>\n                {image && image.eventListCard ? (\n                    <Image\n                        className={styles.image}\n                        alt={title}\n                        src={image.eventListCard}\n                        src2x={image.eventListCard2x}\n                        bgColor={image.bgColor}\n                    />\n                ) : (\n                    <div className={styles.preview} />\n                )}\n                {ticket && <PriceLabel ticket={ticket} position={'left'} />}\n                {image && <div className={styles['image-overlay']} />}\n            </div>\n            <div className={styles.description}>\n                <div className={styles.title}>{title}</div>\n                <div className={styles.annotation}>{argument}</div>\n            </div>\n        </Link>\n    );\n};\n\nexport default memo(EventCard);\n","import React from 'react';\n\nimport { Ticket } from '../../lib/api/fragments/ticket';\nimport TicketPrice from '../TicketPrice';\n\nimport styles from './styles.module.css';\n\ntype Props = {\n    ticket: Ticket;\n    position?: 'left' | 'right';\n};\n\nconst PriceLabel: React.FC<Props> = props => (\n    <div className={[styles.price, styles[props.position || 'left']].join(' ')}>\n        <TicketPrice ticket={props.ticket} />\n    </div>\n);\n\nexport default PriceLabel;\n","import React, { createRef, useMemo } from 'react';\n\nimport { StackNavigatorContext } from '../context';\nimport { Location, Params, ScreenComponent } from '../index';\n\nimport { isIOS } from '../../../lib/is-ios';\nimport styles from './styles.module.css';\n\nexport type ScreenType = {\n    id: string;\n    params: Params;\n    component: ScreenComponent;\n    location: Location;\n};\n\ntype Props = {\n    isVisible: boolean;\n    onBackward: () => void;\n    screen: ScreenType;\n    transitions?: boolean;\n};\n\nconst Screen: React.FC<Props> = ({ isVisible, transitions, screen, onBackward }) => {\n    const className = isIOS() ? '' : [styles.screen, !isVisible && !transitions && styles.hidden].filter(Boolean).join(' ');\n    const ref = createRef<HTMLDivElement>();\n\n    const context = useMemo(() => {\n        return {\n            onBackward,\n            isVisible,\n            ref,\n        };\n    }, [onBackward, isVisible, ref]);\n\n    return (\n        <StackNavigatorContext.Provider value={context}>\n            <div className={className} ref={ref}>\n                <screen.component params={screen.params} location={screen.location} />\n            </div>\n        </StackNavigatorContext.Provider>\n    );\n};\n\nexport default Screen;\n","import React, { useState, useEffect, useCallback } from 'react';\nimport { useLocation, matchPath, useHistory } from 'react-router-dom';\nimport { TransitionGroup, CSSTransition } from 'react-transition-group';\n\nimport { isIOS } from '../../lib/is-ios';\nimport Screen, { ScreenType } from './Screen';\nimport styles from './Screen/styles.module.css';\nimport { Screens, Params, ScreenConfig } from './index';\n\nconst classNames = {\n    enter: styles.screenEnter,\n    enterActive: styles.screenEnterActive,\n    exit: styles.screenExit,\n    exitActive: styles.screenExitActive,\n};\nconst transitionCallbacks = {\n    onEnter: (node: HTMLElement) => {\n        if (node.previousElementSibling) {\n            node.previousElementSibling.classList.add(styles.offset);\n        }\n    },\n\n    onExit: (node: HTMLElement) => {\n        if (node.previousElementSibling) {\n            node.previousElementSibling.classList.remove(styles.offset);\n        }\n    },\n};\nconst transitionTimeouts = {\n    enter: 600, // Сама анимация 300ms + поправка на медленные девайсы\n    exit: 500, // Сама анимация 250ms + поправка на медленные девайсы\n};\n\ntype ScreenStack = Array<ScreenType>;\n\ntype Props = {\n    screens: Screens;\n    maxDepth?: number;\n    transitions?: boolean;\n};\n\nexport type BackwardProps = { fallback?: string };\n\nconst StackNavigator: React.FC<Props> = ({ screens, maxDepth = 10, transitions = false }) => {\n    const [stack, setStack] = useState<ScreenStack>([]);\n    const location = useLocation();\n    const history = useHistory();\n    const iOS = isIOS();\n\n    useLocationChange(() => {\n        if (iOS) {\n            window.scrollTo(0, 0);\n        }\n\n        const isBackward = history.action === 'POP';\n        const isReplace = history.action === 'REPLACE';\n\n        // Если навигация «назад» и в стеке есть отрисованный предыдущий экран, то просто удаляем последний экран\n        if (isBackward && stack.length > 1) {\n            setStack(stack.slice(0, -1));\n            return;\n        }\n\n        let screen: ScreenConfig | null = null;\n        let match: ReturnType<typeof matchPath> = null;\n\n        for (const item of screens) {\n            match = matchPath(location.pathname, item);\n\n            if (match) {\n                screen = item;\n                break;\n            }\n        }\n\n        if (!screen || !match) {\n            console.warn('No screen matched for route', location.pathname);\n            return;\n        }\n\n        const newStackItem: ScreenStack[0] = {\n            id: location.key || Date.now().toString(),\n            component: screen.component,\n            params: match.params as Params,\n            location: { ...location },\n        };\n\n        // Если навигация «назад», то просто заменяем единственный экран в стеке\n        if (isBackward && stack.length === 1) {\n            setStack([newStackItem]);\n            return;\n        }\n\n        // Если делается замена текущего урла, то просто перерисовываем текущий экран\n        if (isReplace) {\n            if (screen.component === stack[stack.length - 1].component) {\n                const newStack = [...stack];\n\n                newStack[stack.length - 1] = {\n                    ...newStack[stack.length - 1],\n                    params: newStackItem.params,\n                    location: newStackItem.location,\n                };\n\n                setStack(newStack);\n            } else {\n                setStack([...stack.slice(0, -1), newStackItem]);\n            }\n            return;\n        }\n\n        // Навигация «вперед», добавляем новый экран в стек\n        const newStack = [...stack, newStackItem];\n\n        // При достижении лимита количенства одновременно отрисованных экранов начинаем удалять старые экраны\n        if (newStack.length > maxDepth) {\n            newStack.splice(0, stack.length - maxDepth + 1);\n        }\n\n        setStack(newStack);\n    });\n\n    const onBackward = useCallback(\n        ({ fallback }: BackwardProps = {}) => {\n            if (iOS) {\n                window.scrollTo(0, 0);\n            }\n\n            if (history.length > 1) {\n                history.goBack();\n            } else if (fallback) {\n                history.replace(fallback);\n            }\n        },\n        [history, iOS]\n    );\n\n    if (transitions && !iOS) {\n        return (\n            <TransitionGroup component={null}>\n                {stack.map((screen, index) => {\n                    return (\n                        <CSSTransition\n                            key={screen.id}\n                            timeout={transitionTimeouts}\n                            classNames={classNames}\n                            enter={stack.length !== 1}\n                            exit={stack.length !== 1}\n                            onEnter={transitionCallbacks.onEnter}\n                            onExit={transitionCallbacks.onExit}\n                        >\n                            <Screen\n                                key={screen.id}\n                                isVisible={index === stack.length - 1}\n                                transitions\n                                onBackward={onBackward}\n                                screen={screen}\n                            />\n                        </CSSTransition>\n                    );\n                })}\n            </TransitionGroup>\n        );\n    }\n\n    if (iOS) {\n        const screen = stack[stack.length - 1];\n\n        return screen ? <Screen isVisible onBackward={onBackward} screen={screen} /> : null;\n    }\n\n    return (\n        <>\n            {stack.map((screen, index) => {\n                return (\n                    <Screen\n                        key={screen.id}\n                        isVisible={index === stack.length - 1}\n                        onBackward={onBackward}\n                        screen={screen}\n                    />\n                );\n            })}\n        </>\n    );\n};\n\n// Хак с useEffect, который вызывается только при изменении Location\n// Позволяет обойти линтинг зависимостией в хуке useEffect\nfunction useLocationChange(callback: () => void) {\n    const location = useLocation();\n\n    useEffect(callback, [location]);\n}\n\nexport default StackNavigator;\n","import React from 'react';\nimport { RouteProps, useLocation } from 'react-router-dom';\n\nimport { isIOS } from '../../lib/is-ios';\nimport StackNavigator from './StackNavigator';\n\nexport { useBackward, useScreenRef, useScreenVisible } from './hooks';\n\nexport type Params = Record<string, string>;\nexport type Location = ReturnType<typeof useLocation>;\n\nexport type ScreenProps = {\n    params: Params;\n    location: Location;\n};\n\nexport type ScreenComponent = React.FC<ScreenProps>;\n\nexport type ScreenConfig = RouteProps & {\n    component: ScreenComponent;\n};\n\nexport type Screens = ScreenConfig[];\nexport type Options = {\n    maxDepth?: number;\n    transitions?: boolean;\n};\n\nexport function createStackNavigator(screens: Screens, options: Options = {}) {\n    if (isIOS() && 'scrollRestoration' in window.history) {\n        window.history.scrollRestoration = 'manual';\n    }\n\n    return () => <StackNavigator screens={screens} maxDepth={options.maxDepth} transitions={options.transitions} />;\n}\n","import React from 'react';\n\nimport { Rect } from '../../Skeletons';\n\nimport styles from './styles.module.css';\n\nconst EventCardMainSkeleton: React.FC = () => {\n    return <Rect className={styles.card} />;\n};\n\nexport default EventCardMainSkeleton;\n","import React from 'react';\n\nimport { Rect } from '../../Skeletons';\n\nimport styles from './styles.module.css';\n\nconst SelectionListSkeleton: React.FC<{ className?: string }> = ({ className }) => {\n    return (\n        <div className={[styles.block, className].filter(Boolean).join(' ')}>\n            {Array(5)\n                .fill(0)\n                .map((_, index) => (\n                    <Rect key={index} className={styles.item} />\n                ))}\n        </div>\n    );\n};\n\nexport default SelectionListSkeleton;\n","import React from 'react';\n\nimport { Currency, Ticket } from '../../lib/api/fragments/ticket';\n\ntype Props = {\n    ticket: Ticket;\n};\n\nconst currencySymbol: { [key in Currency]: string } = {\n    rub: '₽',\n    usd: '$',\n};\n\nconst space = '\\u00A0';\n\nconst TicketPrice: React.FC<Props> = ({ ticket }) => {\n    if (!ticket.price || !ticket.price.min) {\n        return null;\n    }\n\n    const text = ['от', (ticket.price.min || 0) / 100, currencySymbol[ticket.price.currency]].join(space);\n\n    return <>{text}</>;\n};\n\nexport default TicketPrice;\n","import React from 'react';\n\nimport styles from './styles.module.css';\n\nexport type Props = {\n    className?: string;\n    onClick: () => void;\n};\nconst ActionButton: React.FC<Props> = ({ className, children, onClick }) => {\n    const cls = [styles.action, className].filter(Boolean).join(' ');\n    return (\n        <button className={cls} onClick={onClick}>\n            {children}\n        </button>\n    );\n};\n\nexport default ActionButton;\n","import React from 'react';\n\nimport { Rect, Text } from '../../Skeletons';\n\nimport styles from './styles.module.css';\n\nexport const EventCardVerticalSkeleton: React.FC = () => (\n    <div className={styles.card}>\n        <Rect className={styles.image} />\n        <Text className={styles.title} />\n        <Text className={styles.description} />\n    </div>\n);\n","import React from 'react';\n\nimport { Text } from '../../../../../components/Skeletons';\nimport { EventCardVerticalSkeleton } from '../../../../../components/EventCardVertical/Skeleton';\n\nimport styles from './styles.module.css';\n\nexport const EventsFeedSkeleton: React.FC = () => (\n    <div className={styles.feed}>\n        <Text className={styles.title} />\n        <div className={styles.events}>\n            <div className={styles.item}>\n                <EventCardVerticalSkeleton />\n            </div>\n            <div className={styles.item}>\n                <EventCardVerticalSkeleton />\n            </div>\n            <div className={styles.item}>\n                <EventCardVerticalSkeleton />\n            </div>\n        </div>\n    </div>\n);\n","import React from 'react';\n\nimport { EventsFeedSkeleton } from '../../EventsFeed/Skeleton';\n\nconst RecommendedEventsSkeleton: React.FC = () => {\n    return (\n        <>\n            <EventsFeedSkeleton />\n            <EventsFeedSkeleton />\n            <EventsFeedSkeleton />\n            <EventsFeedSkeleton />\n        </>\n    );\n};\n\nexport default RecommendedEventsSkeleton;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"clear\":\"styles_clear__ZHIHN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"events\":\"styles_events__3RaZ8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__1j4tU\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"styles_input__2gjR5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"styles_input__1gPFI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"styles_title__354Bd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"action\":\"styles_action__13iH4\"};","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABECAMAAAAPzWOAAAAAYFBMVEVHcEwAAAD6+voAAAAAAAD19fX4+PgAAAAAAAAAAAD9/f1OTk7X19exsbHe3t4AAADAwMB+fn7MzMzv7+/q6urm5uabm5sAAADo6Oju7u7j4+Pg4ODp6en09PRmZmb///8oaTeDAAAAH3RSTlMAI+UME8nXJh4D8jSFXJMOakF4vK6gTxpYiRIkabgolNJ6sQAAAkRJREFUWMOlmNma2yAMhfGCBV6I14ydTKv3f8u5mHTSxDogWl3j/9OR4CBsDApf1c7RI5yrK28yw9c/3z/D1Tmci0B4cC7aJAqKRKFJp4oiiIiKVDbekSKc/7800snUpI4aSfmgjPjw/16OeGEUjGuSktAyzGu7vivS1bS3zKW1lpmZOSSqW0mIruGXuJ5WvHTaFwqGFfbL32VxCga3dgtheituQsw7g5m5HLAgQcxkVYynIKEzPcvR9B3okFTVVoaU4ymVh49JFVkAhECbxf2+AUg4nyFjjPHiXrVySaSlHm54GWKRtcint9SWhMghNQRa3Mt6KsrIhGdpbYV8dRUZK/BbYGizPhFyMmScB7kkoRMhoKxlTmVFyJVhBDUEHb+sTEBvZJ+FkAlCSA8RvZGZecmBIGcbcyAT6w8gEdqxC5/NwIJEHIJ0czhBhh7MB3iwGU+QCQ48FYJ0yoIQVciUBK/e0EKP7FFIBalx0WlPcfT+GDXU83qWmy6iBut58aX2ShE14Br93vrPy3SAoi/4QieiwDw8rLbFjCI+SC/MI43WWrtMitG6QFfPlp7yfXx2ZOZ2TEEuscHvGr59ycYxDo6gU7+cnbpc5sQI+hTUjSu6cricz0fvPJYPW8PRsEP80fM7WFbE2kUeCObWsCraPvbg0VLYTpHX5O2XksIBPt+MMZuW0gw1fo7urbIwe+xhfFe1yN4Tb/S9TCHKXfHH4Yhqag/l/49P2O3mM+MPyv0QOM1xz/2Zc9sP+0Nq7LHf4NIvJADYmA5mUwwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABECAMAAAAPzWOAAAAAYFBMVEVHcEwAAAD6+voAAAAAAAD19fX4+PgAAAAAAAAAAAD9/f1OTk7X19exsbHe3t4AAADAwMB+fn7MzMzv7+/q6urm5uabm5sAAADo6Oju7u7j4+Pg4ODp6en09PRmZmb///8oaTeDAAAAH3RSTlMAI+UME8nXJh4D8jSFXJMOakF4vK6gTxpYiRIkabgolNJ6sQAAAkRJREFUWMOlmNma2yAMhfGCBV6I14ydTKv3f8u5mHTSxDogWl3j/9OR4CBsDApf1c7RI5yrK28yw9c/3z/D1Tmci0B4cC7aJAqKRKFJp4oiiIiKVDbekSKc/7800snUpI4aSfmgjPjw/16OeGEUjGuSktAyzGu7vivS1bS3zKW1lpmZOSSqW0mIruGXuJ5WvHTaFwqGFfbL32VxCga3dgtheituQsw7g5m5HLAgQcxkVYynIKEzPcvR9B3okFTVVoaU4ymVh49JFVkAhECbxf2+AUg4nyFjjPHiXrVySaSlHm54GWKRtcint9SWhMghNQRa3Mt6KsrIhGdpbYV8dRUZK/BbYGizPhFyMmScB7kkoRMhoKxlTmVFyJVhBDUEHb+sTEBvZJ+FkAlCSA8RvZGZecmBIGcbcyAT6w8gEdqxC5/NwIJEHIJ0czhBhh7MB3iwGU+QCQ48FYJ0yoIQVciUBK/e0EKP7FFIBalx0WlPcfT+GDXU83qWmy6iBut58aX2ShE14Br93vrPy3SAoi/4QieiwDw8rLbFjCI+SC/MI43WWrtMitG6QFfPlp7yfXx2ZOZ2TEEuscHvGr59ycYxDo6gU7+cnbpc5sQI+hTUjSu6cricz0fvPJYPW8PRsEP80fM7WFbE2kUeCObWsCraPvbg0VLYTpHX5O2XksIBPt+MMZuW0gw1fo7urbIwe+xhfFe1yN4Tb/S9TCHKXfHH4Yhqag/l/49P2O3mM+MPyv0QOM1xz/2Zc9sP+0Nq7LHf4NIvJADYmA5mUwwAAAAASUVORK5CYII=\"","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { fetchCityInfo, MOSCOW } from '../../lib/api';\nimport { getCurrentPosition } from '../../lib/geolocation';\nimport { getPersistConfig } from '../helpers/persist';\n\nimport { AppThunk } from '../index';\n\nimport { setItems as setMenuItems } from './menu';\n\nexport type City = {\n    useGeolocation: boolean;\n    isFetchingLocation: boolean;\n    currentCity: {\n        name: string;\n        geoid: number;\n        longitude: number;\n        latitude: number;\n    };\n};\n\nconst initialState: City = {\n    useGeolocation: true,\n    isFetchingLocation: false,\n    currentCity: MOSCOW,\n};\n\nconst city = createSlice({\n    name: 'city',\n    initialState,\n    reducers: {\n        setCity(state, action: PayloadAction<City['currentCity']>) {\n            state.currentCity = action.payload;\n        },\n        setGeolocation(state, action: PayloadAction<boolean>) {\n            state.useGeolocation = action.payload;\n        },\n        locationFetchStart(state) {\n            state.isFetchingLocation = true;\n        },\n        locationFetchSuccess(state) {\n            state.isFetchingLocation = false;\n        },\n        locationFetchFailed(state, action: PayloadAction<boolean>) {\n            state.isFetchingLocation = false;\n            state.useGeolocation = false;\n\n            if (action.payload) {\n                alert('Не удалось получить вашу геолокацию!');\n            }\n        },\n    },\n});\n\nexport const { setCity, setGeolocation, locationFetchStart, locationFetchSuccess, locationFetchFailed } = city.actions;\n\nexport const loadCityInfoByLocation = (showError: boolean): AppThunk => async dispatch => {\n    dispatch(locationFetchStart());\n\n    try {\n        const coords = await getCurrentPosition();\n\n        const options = {\n            longitude: coords.longitude,\n            latitude: coords.latitude,\n        };\n\n        const { cityInfo } = await fetchCityInfo(options);\n\n        dispatch(\n            setCity({\n                name: cityInfo.name,\n                geoid: cityInfo.geoid,\n                longitude: cityInfo.longitude,\n                latitude: cityInfo.latitude,\n            })\n        );\n\n        dispatch(setMenuItems(cityInfo.eventsMenu));\n        dispatch(locationFetchSuccess());\n    } catch (err) {\n        console.error(err);\n        dispatch(locationFetchFailed(showError));\n    }\n};\n\nexport const loadCityInfo = (): AppThunk => async(dispatch, getState) => {\n    const cityState = getState().city;\n\n    try {\n        if (cityState.useGeolocation) {\n            dispatch(loadCityInfoByLocation(false));\n\n            return;\n        }\n\n        const { cityInfo } = await fetchCityInfo({\n            longitude: cityState.currentCity.longitude,\n            latitude: cityState.currentCity.latitude,\n        });\n\n        dispatch(setMenuItems(cityInfo.eventsMenu));\n    } catch (err) {\n        console.error(err);\n    }\n};\n\nexport const toggleGeolocation = (isActive: boolean): AppThunk => async dispatch => {\n    if (isActive) {\n        dispatch(loadCityInfoByLocation(true));\n    }\n\n    dispatch(setGeolocation(isActive));\n};\n\nconst persistConfig = getPersistConfig<City>('city');\nexport default persistReducer(persistConfig, city.reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { fetchCityList } from '../../lib/api';\nimport { getPersistConfig } from '../helpers/persist';\n\nimport { City } from '../../lib/api/fragments/city';\nimport { AppThunk } from '../index';\n\nexport type CityListState = {\n    isLoading: boolean;\n    items: City[];\n};\n\nconst initialState: CityListState = {\n    isLoading: false,\n    items: [],\n};\n\nconst cityList = createSlice({\n    name: 'city-list',\n    initialState,\n    reducers: {\n        setLoading(state, action: PayloadAction<boolean>) {\n            state.isLoading = action.payload;\n        },\n        setCityListResult(state, action: PayloadAction<CityListState['items']>) {\n            state.items = action.payload;\n        },\n    },\n});\n\nexport const { setLoading, setCityListResult } = cityList.actions;\n\nexport const loadCityList = (): AppThunk => async dispatch => {\n    dispatch(setLoading(true));\n\n    try {\n        const { cities } = await fetchCityList();\n        dispatch(setCityListResult(cities));\n    } catch (err) {\n        console.error(err);\n    }\n\n    dispatch(setLoading(false));\n};\n\nconst persistConfig = getPersistConfig<CityListState>('city-list', {\n    blacklist: ['isLoading'],\n});\nexport default persistReducer(persistConfig, cityList.reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer, createTransform } from 'redux-persist';\n\nimport { fetchActualEvents, fetchSuggest } from '../../lib/api';\n\nimport { Document, Groups } from '../../lib/api/fragments/suggest';\nimport { ActualEvent } from '../../lib/api/fragments/actual-event';\nimport { AppThunk } from '../index';\nimport { getPersistConfig, getTransformUIPersistance } from '../helpers/persist';\n\ntype SearchState = {\n    data: {\n        results: {\n            groups: Array<{\n                code: string;\n                title: string | null;\n                events: ActualEvent[];\n            }>;\n        };\n        popularEvents: {\n            events: Array<ActualEvent | null>;\n\n            updatedAt: number;\n        };\n    };\n    ui: {\n        results: { isLoading: boolean };\n        popularEvents: { isLoading: boolean; isUpdating: boolean };\n    };\n};\n\nconst initialState: SearchState = {\n    data: {\n        results: {\n            groups: [],\n        },\n        popularEvents: {\n            events: [],\n            updatedAt: 0,\n        },\n    },\n    ui: {\n        popularEvents: {\n            isLoading: false,\n            isUpdating: false,\n        },\n        results: { isLoading: false },\n    },\n};\n\nconst updateInterval = 900 * 1000;\n\nconst search = createSlice({\n    name: 'search',\n    initialState,\n    reducers: {\n        fetchPopularStart(state) {\n            if (state.data.popularEvents.events.length > 0) {\n                state.ui.popularEvents.isUpdating = true;\n            } else {\n                state.ui.popularEvents.isLoading = true;\n            }\n        },\n        fetchPopularSuccess(state, action: PayloadAction<SearchState['data']['popularEvents']['events']>) {\n            state.data.popularEvents.events = action.payload;\n            state.data.popularEvents.updatedAt = Date.now();\n            state.ui.popularEvents.isLoading = false;\n            state.ui.popularEvents.isUpdating = false;\n        },\n        fetchPopularError(state) {\n            state.ui.popularEvents.isLoading = false;\n            state.ui.popularEvents.isUpdating = false;\n        },\n        searchStart(state) {\n            state.ui.results.isLoading = true;\n            state.data.results.groups = [];\n        },\n        searchSuccess(state, action: PayloadAction<Groups[]>) {\n            state.ui.results.isLoading = false;\n            state.data.results.groups = action.payload.map(group => {\n                return {\n                    code: group.code,\n                    title: group.title,\n                    events: group.documents.map(doc => transformSearchDocumentToList(doc)),\n                };\n            });\n        },\n        searchError(state) {\n            state.ui.results.isLoading = false;\n        },\n        resetResults(state) {\n            if (state.data.results.groups.length > 0) {\n                state.data.results.groups = [];\n            }\n        },\n    },\n});\n\nexport const {\n    fetchPopularStart,\n    fetchPopularSuccess,\n    fetchPopularError,\n    searchStart,\n    searchSuccess,\n    searchError,\n    resetResults,\n} = search.actions;\n\nexport const loadPopularEvents = (): AppThunk => async(dispatch, getState) => {\n    const events = getState().search.data.popularEvents;\n\n    if (events && events.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchPopularStart());\n\n    try {\n        const { geoid } = getState().city.currentCity;\n        const actualEvents = await fetchActualEvents({ limit: 15, geoid });\n        dispatch(fetchPopularSuccess(actualEvents.events.items));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchPopularError());\n    }\n};\n\nlet activeRequest: AbortController | null = null;\n\nfunction filterGroupsByText(text: string, groups: Groups[]) {\n    return groups\n        .map<Groups>(group => ({\n            ...group,\n            documents: group.documents.filter(({ object }) =>\n                object.title.toLowerCase().includes(text.trim().toLowerCase())\n            ),\n        }))\n        .filter(group => group.documents.length);\n}\nexport const loadSearchResults = (text: string): AppThunk => async(dispatch, getState) => {\n    if (activeRequest) {\n        activeRequest.abort();\n    }\n\n    activeRequest = new AbortController();\n\n    // Избегаем лишней перерисовки при наборе запроса\n    if (!getState().search.ui.results.isLoading) {\n        dispatch(searchStart());\n    }\n\n    try {\n        const { geoid } = getState().city.currentCity;\n        const {\n            suggest: { groups },\n        } = await fetchSuggest(text, geoid, activeRequest.signal);\n\n        dispatch(searchSuccess(filterGroupsByText(text, groups)));\n\n        activeRequest = null;\n    } catch (err) {\n        if (err.name === 'AbortError') {\n            return;\n        }\n\n        console.error(err);\n        dispatch(searchError());\n    }\n};\n\nconst persistConfig = getPersistConfig<SearchState>('search', {\n    transforms: [\n        createTransform(\n            (inboundState: SearchState[keyof SearchState], key: keyof SearchState): SearchState[keyof SearchState] => {\n                if (key === 'data') {\n                    const { results, ...rest } = inboundState as SearchState['data'];\n\n                    return { ...rest, results: { groups: [] } };\n                }\n\n                return inboundState;\n            }\n        ),\n        getTransformUIPersistance<SearchState['ui']>(initialState.ui),\n    ],\n});\nexport default persistReducer(persistConfig, search.reducer);\n\nexport function transformSearchDocumentToList(document: Document): ActualEvent {\n    const { id, title, argument, image, type, minPrice } = document.object;\n\n    return {\n        eventPreview: {\n            id,\n            title,\n            argument,\n            image,\n            type,\n            tags: [],\n            contentRating: null,\n            tickets: minPrice ?\n                [\n                    {\n                        id: null,\n                        price: { min: minPrice.value, currency: minPrice.currency, max: null },\n                    },\n                ] :\n                [],\n            userRating: null,\n        },\n        scheduleInfo: {\n            placesTotal: null,\n            preview: null,\n        },\n    };\n}\n","export async function getCurrentUserInfo() {\n    return {\n        name: 'Аноним Анонимов',\n        img: {\n            src: {\n                url: require('../assets/login-avatar.png'),\n                width: 24,\n                height: 24,\n            },\n            src2x: {\n                url: require('../assets/login-avatar-2x.png'),\n                width: 48,\n                height: 48,\n            },\n        },\n    };\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { getCurrentUserInfo } from '../../lib/account-manager';\n\nimport { AppThunk } from '../index';\nimport { MediaImageSize } from '../../lib/api/fragments/image-size';\n\nexport type User = {\n    currentUser: {\n        uid?: string;\n        name?: string;\n        img?: {\n            src?: MediaImageSize;\n            src2x?: MediaImageSize;\n        };\n    };\n};\n\nconst initialState: User = {\n    currentUser: {},\n};\n\nconst user = createSlice({\n    name: 'user',\n    initialState,\n    reducers: {\n        setUser(state, action: PayloadAction<User['currentUser']>) {\n            state.currentUser = action.payload;\n        },\n    },\n});\n\nexport const { setUser } = user.actions;\n\nexport const loadUserInfo = (): AppThunk => async dispatch => {\n    try {\n        const userInfo = await getCurrentUserInfo();\n        dispatch(setUser(userInfo));\n    } catch (err) {\n        console.error(err);\n    }\n};\n\nexport default user.reducer;\n","import { configureStore, Action, getDefaultMiddleware, combineReducers } from '@reduxjs/toolkit';\nimport { ThunkAction } from 'redux-thunk';\nimport { persistStore } from 'redux-persist';\nimport * as PERSIST_CONTSTANS from 'redux-persist/lib/constants';\n\nimport eventReducer from './slices/event';\nimport actualEventsReducer from './slices/actual-events';\nimport rubricEventsReducer from './slices/rubric-events';\nimport selectionsReducer from './slices/selections';\nimport selectionEventsReducer from './slices/selection-events';\nimport cityReducer from './slices/city';\nimport cityListReducer from './slices/city-list';\nimport searchReducer from './slices/search';\nimport menuReducer from './slices/menu';\nimport dateFilterReducer from './slices/date-filter';\nimport recommendedReducer from './slices/recommended-events';\nimport userReducer from './slices/user';\n\nconst PERSIST_ACTIONS = [\n    PERSIST_CONTSTANS.FLUSH,\n    PERSIST_CONTSTANS.REHYDRATE,\n    PERSIST_CONTSTANS.PAUSE,\n    PERSIST_CONTSTANS.PERSIST,\n    PERSIST_CONTSTANS.PURGE,\n    PERSIST_CONTSTANS.REGISTER,\n];\nconst rootReducer = combineReducers({\n    event: eventReducer,\n    actualEvents: actualEventsReducer,\n    rubricEvents: rubricEventsReducer,\n    selections: selectionsReducer,\n    selectionEvents: selectionEventsReducer,\n    city: cityReducer,\n    cityList: cityListReducer,\n    search: searchReducer,\n    menu: menuReducer,\n    dateFilter: dateFilterReducer,\n    recommendedEvents: recommendedReducer,\n    user: userReducer,\n});\nconst store = configureStore({\n    reducer: rootReducer,\n    middleware: getDefaultMiddleware({\n        serializableCheck: {\n            ignoredActions: PERSIST_ACTIONS,\n        },\n    }),\n});\n\nexport type RootReducer = ReturnType<typeof rootReducer>;\nexport type AppThunk = ThunkAction<void, RootReducer, null, Action<string>>;\n\nexport const persistor = persistStore(store);\n\nexport default store;\n","import React from 'react';\n\nimport { Rect } from '../../Skeletons';\n\nimport styles from './styles.module.css';\n\nconst DateFilterSkeleton: React.FC = () => (\n    <div className={styles.block}>\n        {Array(2)\n            .fill(0)\n            .map((_, index) => (\n                <Rect key={index} className={styles.filter} />\n            ))}\n    </div>\n);\n\nexport default DateFilterSkeleton;\n","import React from 'react';\n\nimport { Text } from '../../../components/Skeletons';\nimport DateFilterSkeleton from '../../../components/DateFilter/Skeleton';\nimport EventsListSkeleton from '../../../components/EventsList/Skeleton';\nimport EventCardMainSkeleton from '../../../components/EventCardMain/Skeleton';\nimport SelectionListSkeleton from '../../../components/SelectionList/Skeleton';\n\nimport styles from './styles.module.css';\n\nconst MainScreenSkeleton: React.FC = () => (\n    <div>\n        <DateFilterSkeleton />\n        <div className={styles.content}>\n            <Text className={styles.title} />\n            <EventsListSkeleton itemsGap={8} count={5} card={EventCardMainSkeleton} />\n            <Text className={styles.title} />\n            <SelectionListSkeleton />\n        </div>\n    </div>\n);\n\nexport default MainScreenSkeleton;\n","import React, { useEffect, Suspense } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { lazyDeferred } from '../../lib/lazy';\nimport { RootReducer } from '../../redux';\nimport { loadActualEvents } from '../../redux/slices/actual-events';\nimport { loadSelections } from '../../redux/slices/selections';\n\nimport PageHeader from '../../components/PageHeader';\n\nimport MainScreenSkeleton from './Skeleton';\n\nconst Component = lazyDeferred(() =>\n    import(\n        /* webpackChunkName: \"main-screen\" */\n        './Component'\n    )\n);\n\nconst MainScreen: React.FC = () => {\n    const dispatch = useDispatch();\n    const date = useSelector((state: RootReducer) => state.dateFilter);\n    const { geoid } = useSelector((state: RootReducer) => state.city.currentCity);\n\n    useEffect(() => {\n        dispatch(loadActualEvents(date, geoid));\n        dispatch(loadSelections(date, geoid));\n    }, [dispatch, date, geoid]);\n\n    return (\n        <>\n            <PageHeader hasLogo hasMenu />\n            <Suspense fallback={<MainScreenSkeleton />}>\n                <Component />\n            </Suspense>\n        </>\n    );\n};\n\nexport default MainScreen;\n","import React from 'react';\n\nimport { Rect, Text } from '../../../components/Skeletons';\nimport RecommendedEventsSkeleton from '../components/RecommendedEvents/Skeleton';\n\nimport styles from './styles.module.css';\n\nconst EventSkeleton: React.FC = () => (\n    <div className={styles.container}>\n        <div className={styles.image} />\n\n        <div className={styles['button-wrapper']}>\n            <Rect className={styles.button} />\n        </div>\n\n        <Text className={styles['date-1']} />\n        <Text className={styles['date-2']} />\n\n        <Rect className={styles.map} />\n\n        <Text className={styles['place-1']} />\n        <Text className={styles['place-2']} />\n\n        <div className={styles.gallery}>\n            <Text className={styles['gallery-header']} />\n            <div className={styles['gallery-content']}>\n                <Rect className={styles['gallery-card']} />\n                <Rect className={styles['gallery-card']} />\n                <Rect className={styles['gallery-card']} />\n            </div>\n        </div>\n\n        <div className={styles.description}>\n            {Array(5)\n                .fill(0)\n                .map((_, index) => (\n                    <Text key={index} className={styles[`description-line-${index + 1}`]} />\n                ))}\n        </div>\n\n        <div className={styles.recommended}>\n            <RecommendedEventsSkeleton />\n        </div>\n    </div>\n);\nexport default EventSkeleton;\n","import React, { useEffect, Suspense } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport { lazyDeferred } from '../../lib/lazy';\nimport { loadEvent } from '../../redux/slices/event';\nimport { loadRecommendedEvents } from '../../redux/slices/recommended-events';\n\nimport EventSkeleton from './Skeleton';\n\nconst Component = lazyDeferred(() =>\n    import(\n        /* webpackChunkName: \"event-screen\" */\n        './Component'\n    )\n);\n\nconst EventScreen: React.FC<{ id: string }> = ({ id }) => {\n    const dispatch = useDispatch();\n\n    useEffect(() => {\n        dispatch(loadEvent(id));\n        dispatch(loadRecommendedEvents());\n    }, [dispatch, id]);\n\n    return (\n        <>\n            <Suspense fallback={<EventSkeleton />}>\n                <Component id={id} skeleton={<EventSkeleton />} />\n            </Suspense>\n        </>\n    );\n};\n\nexport default EventScreen;\n","import React from 'react';\n\nimport { Text } from '../../../components/Skeletons';\nimport DateFilterSkeleton from '../../../components/DateFilter/Skeleton';\nimport EventsListSkeleton from '../../../components/EventsList/Skeleton';\nimport EventCardSkeleton from '../../../components/EventCard/Skeleton';\n\nimport styles from './styles.module.css';\n\nconst SelectionScreenSkeleton: React.FC = () => (\n    <div>\n        <DateFilterSkeleton />\n        <div className={styles.content}>\n            <Text className={styles.title} />\n            <EventsListSkeleton count={10} card={EventCardSkeleton} />\n        </div>\n    </div>\n);\n\nexport default SelectionScreenSkeleton;\n","import React, { useEffect, Suspense } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { lazyDeferred } from '../../lib/lazy';\nimport { RootReducer } from '../../redux';\nimport { loadRubricEvents } from '../../redux/slices/rubric-events';\n\nimport PageHeader from '../../components/PageHeader';\nimport SelectionScreenSkeleton from '../SelectionScreen/Skeleton';\n\nconst Component = lazyDeferred(() =>\n    import(\n        /* webpackChunkName: \"rubric-screen\" */\n        './Component'\n    )\n);\n\nconst RubricScreen: React.FC<{ code: string }> = ({ code }) => {\n    const dispatch = useDispatch();\n    const date = useSelector((state: RootReducer) => state.dateFilter);\n\n    useEffect(() => {\n        dispatch(loadRubricEvents(code, date));\n    }, [dispatch, code, date]);\n\n    return (\n        <>\n            <PageHeader hasLogo hasMenu />\n            <Suspense fallback={<SelectionScreenSkeleton />}>\n                <Component code={code} />\n            </Suspense>\n        </>\n    );\n};\n\nexport default RubricScreen;\n","import React, { useEffect, Suspense } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { lazyDeferred } from '../../lib/lazy';\nimport { RootReducer } from '../../redux';\nimport { loadSelectionEvents } from '../../redux/slices/selection-events';\n\nimport PageHeader from '../../components/PageHeader';\n\nimport SelectionScreenSkeleton from './Skeleton';\n\nconst Component = lazyDeferred(() =>\n    import(\n        /* webpackChunkName: \"selection-screen\" */\n        './Component'\n    )\n);\n\nconst SelectionScreen: React.FC<{ code: string }> = ({ code }) => {\n    const dispatch = useDispatch();\n    const date = useSelector((state: RootReducer) => state.dateFilter);\n\n    useEffect(() => {\n        dispatch(loadSelectionEvents(code, date));\n    }, [dispatch, code, date]);\n\n    return (\n        <>\n            <PageHeader hasLogo hasMenu />\n            <Suspense fallback={<SelectionScreenSkeleton />}>\n                <Component code={code} />\n            </Suspense>\n        </>\n    );\n};\n\nexport default SelectionScreen;\n","import React, { forwardRef } from 'react';\n\nimport styles from './styles.module.css';\n\ntype Props = JSX.IntrinsicElements['input'];\nconst TextInput = forwardRef<HTMLInputElement, Props>(({ className, ...props }, ref) => {\n    const cls = [styles.input, className].filter(Boolean).join(' ');\n\n    return <input ref={ref} type=\"text\" className={cls} {...props} />;\n});\n\nexport default TextInput;\n","import React, { ChangeEvent, useCallback, useEffect, useState, useRef } from 'react';\n\nimport TextInput from '../../../components/TextInput';\n\nimport styles from './styles.module.css';\n\nconst SuggestInput: React.FC<{ onChange: (value: string) => void }> = props => {\n    const inputRef = useRef<HTMLInputElement | null>(null);\n    const [value, setValue] = useState('');\n    const onChange = useCallback(\n        (e: ChangeEvent<HTMLInputElement>) => {\n            const { value } = e.target;\n\n            props.onChange(value);\n            setValue(value);\n        },\n        [setValue, props]\n    );\n\n    useEffect(() => {\n        if (inputRef.current) {\n            inputRef.current.focus();\n        }\n    }, [inputRef]);\n\n    return (\n        <TextInput\n            ref={inputRef}\n            className={styles.input}\n            defaultValue={value}\n            placeholder=\"Поиск по событиям\"\n            onChange={onChange}\n        />\n    );\n};\n\nexport default SuggestInput;\n","import React from 'react';\n\nimport { Text } from '../../../../components/Skeletons';\nimport EventsListSkeleton from '../../../../components/EventsList/Skeleton';\nimport EventCardSkeleton from '../../../../components/EventCard/Skeleton';\n\nimport styles from './styles.module.css';\n\nconst SearchResultSkeleton: React.FC = () => (\n    <>\n        {Array(3)\n            .fill(0)\n            .map((_, index) => (\n                <div key={index}>\n                    <Text className={styles.title} />\n\n                    <EventsListSkeleton count={3} card={EventCardSkeleton} />\n                </div>\n            ))}\n    </>\n);\n\nexport default SearchResultSkeleton;\n","import React from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { RootReducer } from '../../../redux';\n\nimport EventsList from '../../../components/EventsList';\nimport EventCard from '../../../components/EventCard';\nimport { useThrottleLoading } from '../../../hooks/useThrottleLoading';\n\nimport SearchResultSkeleton from './Skeleton';\nimport styles from './styles.module.css';\n\ntype Props = {\n    onItemClick: () => void;\n};\n\nconst SKELETON_THROTTLE_MS = 250;\n\nconst SearchResult: React.FC<Props> = ({ onItemClick }) => {\n    const { groups } = useSelector((state: RootReducer) => state.search.data.results);\n    const { isLoading } = useSelector((state: RootReducer) => state.search.ui.results);\n\n    const isThrottleLoading = useThrottleLoading(isLoading, SKELETON_THROTTLE_MS);\n\n    if (isThrottleLoading) {\n        return <SearchResultSkeleton />;\n    }\n\n    if (groups.length === 0 && !isLoading && !isThrottleLoading) {\n        return <div className={styles.notFound}>Ничего не найдено</div>;\n    }\n\n    return (\n        <>\n            {groups.map(({ code, title, events }) => (\n                <section key={code}>\n                    <h2 className={styles.title}>{title}</h2>\n                    <EventsList items={events} component={EventCard} onItemClick={onItemClick} />\n                </section>\n            ))}\n        </>\n    );\n};\n\nexport default SearchResult;\n","import { useEffect, useState } from 'react';\n\nexport function useThrottleLoading(isLoading: boolean, time: number) {\n    const [isThrottleLoading, setThrottleLoading] = useState(false);\n\n    // Задерживаем отрисовку на некоторое время после начала загрузки данных.\n    // Тем самым исключим моргание между заглушкой и рендером основного компонента\n    useEffect(() => {\n        if (isLoading) {\n            const newTimerId = window.setTimeout(() => setThrottleLoading(true), time);\n\n            return () => clearTimeout(newTimerId);\n        }\n\n        setThrottleLoading(false);\n    }, [isLoading, time]);\n\n    return isThrottleLoading;\n}\n","import React from 'react';\n\nimport { Text } from '../../../../components/Skeletons';\n\nimport styles from './styles.module.css';\n\ntype Props = {\n    showTitle?: boolean;\n};\n\nconst PopularResultSkeleton: React.FC<Props> = ({ showTitle }) => (\n    <>\n        {showTitle && <Text className={styles.title} />}\n\n        <div>\n            {Array(15)\n                .fill(0)\n                .map((_, index) => (\n                    <Text className={styles.event} key={index} />\n                ))}\n        </div>\n    </>\n);\n\nexport default PopularResultSkeleton;\n","import React from 'react';\nimport { Link } from 'react-router-dom';\nimport { useSelector } from 'react-redux';\n\nimport { getEventUrl } from '../../../lib/url-builder';\nimport { RootReducer } from '../../../redux';\n\nimport PopularResultSkeleton from './Skeleton';\n\nimport styles from './styles.module.css';\n\ntype Props = {\n    onLinkClick: () => void;\n};\nconst Index: React.FC<Props> = ({ onLinkClick }) => {\n    const { events } = useSelector((state: RootReducer) => state.search.data.popularEvents);\n    const { isLoading } = useSelector((state: RootReducer) => state.search.ui.popularEvents);\n\n    return (\n        <section>\n            <div className={styles.title}>Популярные запросы</div>\n            {isLoading && <PopularResultSkeleton />}\n            <ul className={styles.events}>\n                {events.map((actualEvent, i) => {\n                    if (!actualEvent) {\n                        return null;\n                    }\n\n                    const { id, title } = actualEvent.eventPreview;\n\n                    return (\n                        <li key={i} className={styles.event}>\n                            <Link onClick={onLinkClick} className={styles.link} to={getEventUrl(id)}>\n                                {title}\n                            </Link>\n                        </li>\n                    );\n                })}\n            </ul>\n        </section>\n    );\n};\n\nexport default Index;\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { throttle } from 'throttle-debounce';\n\nimport { loadPopularEvents, loadSearchResults, resetResults } from '../../redux/slices/search';\n\nimport BackwardButton from '../../components/BackwardButton';\n\nimport SuggestInput from './Input';\nimport SearchResult from './SearchResult';\nimport PopularResult from './PopularResult';\n\nimport styles from './styles.module.css';\n\nconst INPUT_THROTTLE = 500;\n\nconst SearchScreen: React.FC = () => {\n    const [hasQuery, setHasQuery] = useState(false);\n    const dispatch = useDispatch();\n\n    useEffect(() => {\n        dispatch(loadPopularEvents());\n    }, [dispatch]);\n\n    const onInputChange = useMemo(() => {\n        return throttle(INPUT_THROTTLE, (text: string) => {\n            text = text.trim();\n\n            setHasQuery(Boolean(text));\n\n            if (!text) {\n                dispatch(resetResults());\n                return;\n            }\n\n            dispatch(loadSearchResults(text));\n        });\n    }, [dispatch]);\n\n    const onSearchClose = useCallback(() => {\n        dispatch(resetResults());\n    }, [dispatch]);\n\n    return (\n        <>\n            <div className={styles.header}>\n                <BackwardButton fill={'black'} />\n                <SuggestInput onChange={onInputChange} />\n            </div>\n            <div className={styles.content}>\n                {hasQuery ? (\n                    <SearchResult onItemClick={onSearchClose} />\n                ) : (\n                    <PopularResult onLinkClick={onSearchClose} />\n                )}\n            </div>\n        </>\n    );\n};\n\nexport default SearchScreen;\n","import React from 'react';\nimport { NavLink } from 'react-router-dom';\n\nimport { getRubricUrl } from '../../lib/url-builder';\n\nimport { MenuTag } from '../../lib/api/fragments/city';\n\nimport styles from './style.module.css';\n\ntype MenuItemProps = {\n    text: string;\n    to: string;\n    onItemClick: () => void;\n};\nconst MenuItem: React.FC<MenuItemProps> = props => {\n    const { text, to, onItemClick } = props;\n    return (\n        <li className={styles.item}>\n            <NavLink\n                exact\n                onClick={onItemClick}\n                className={styles.link}\n                activeClassName={styles['active-item']}\n                to={to}\n            >\n                {text}\n            </NavLink>\n        </li>\n    );\n};\n\nexport type MenuListProps = {\n    tags: MenuTag[];\n    onItemClick: () => void;\n};\nconst MenuList: React.FC<MenuListProps> = props => {\n    return (\n        <ul className={styles.list}>\n            <MenuItem to=\"/\" text=\"Главная\" onItemClick={props.onItemClick} />\n            {props.tags.map(tag => (\n                <MenuItem key={tag.code} to={getRubricUrl(tag.code)} text={tag.name} onItemClick={props.onItemClick} />\n            ))}\n        </ul>\n    );\n};\n\nexport default MenuList;\n","import React from 'react';\n\nimport { useSelector } from 'react-redux';\n\nimport { RootReducer } from '../../redux';\n\nimport Image from '../Image';\nimport styles from './styles.module.css';\n\nconst AuthBox: React.FC = () => {\n    const user = useSelector((state: RootReducer) => state.user.currentUser);\n    const username = user.name || 'Войти';\n\n    return (\n        <>\n            <div className={styles.container}>\n                <div className={styles.avatar}>\n                    {user.img ? (\n                        <Image\n                            className={styles['avatar-image']}\n                            alt={username}\n                            src={user.img.src}\n                            src2x={user.img.src2x}\n                        />\n                    ) : (\n                        <span className={[styles['avatar-image'], styles.stub].join(' ')} />\n                    )}\n                </div>\n                <div className={styles.username}>{username}</div>\n            </div>\n        </>\n    );\n};\n\nexport default AuthBox;\n","import React, { useCallback } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { RootReducer } from '../../redux';\n\nimport styles from './styles.module.css';\n\nconst MenuGeoLabel: React.FC<{\n    setCityModalVisibleCallback: (visible: boolean) => void;\n}> = ({ setCityModalVisibleCallback }) => {\n    const currentCity = useSelector((state: RootReducer) => state.city.currentCity);\n    const onCitySelectLabelClickHandle = useCallback(() => {\n        setCityModalVisibleCallback(true);\n    }, [setCityModalVisibleCallback]);\n\n    return (\n        <div className={styles.wrapper}>\n            <div className={styles.select} onClick={onCitySelectLabelClickHandle}>\n                {currentCity ? currentCity.name : 'Выбрать город'}\n            </div>\n        </div>\n    );\n};\n\nexport default MenuGeoLabel;\n","import React, { MouseEvent, useCallback, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport MenuList from '../MenuNavigation';\nimport AuthBox from '../AuthBox';\nimport MenuGeoLabel from '../MenuGeoLabel';\n\nimport { RootReducer } from '../../redux';\nimport { setVisible as setMenuVisible } from '../../redux/slices/menu';\n\nimport styles from './style.module.css';\n\nconst MenuModal: React.FC<{\n    setCityModalVisibleCallback: (visible: boolean) => void;\n}> = ({ setCityModalVisibleCallback }) => {\n    const dispatch = useDispatch();\n\n    const { visible, items } = useSelector((state: RootReducer) => state.menu);\n    const [wasClosed, setWasClosed] = useState<boolean>(false);\n    const className = [\n        styles['menu-modal'],\n        visible || wasClosed ? styles[`menu-modal-visible_${visible ? 'yes' : 'no'}`] : '',\n    ].join(' ');\n\n    const onClose = useCallback(() => {\n        setWasClosed(true);\n        setCityModalVisibleCallback(false);\n        dispatch(setMenuVisible(false));\n    }, [dispatch, setWasClosed, setCityModalVisibleCallback]);\n\n    const noop = useCallback((e: MouseEvent<HTMLImageElement>) => {\n        e.stopPropagation();\n    }, []);\n\n    return (\n        <div className={className} onClick={onClose}>\n            <div className={styles['menu-modal-content']} onClick={noop}>\n                <AuthBox />\n                <MenuGeoLabel setCityModalVisibleCallback={setCityModalVisibleCallback} />\n                <MenuList tags={items} onItemClick={onClose} />\n            </div>\n        </div>\n    );\n};\n\nexport default MenuModal;\n","import React from 'react';\n\nimport styles from './styles.module.css';\n\nexport type Props = JSX.IntrinsicElements['input'] & {\n    label?: string;\n};\nconst Checkbox: React.FC<Props> = ({ className, label, ...props }) => {\n    const cls = [styles.checkbox, className].filter(Boolean).join(' ');\n\n    return (\n        <label className={styles.label}>\n            <input type=\"checkbox\" className={cls} {...props} />\n            {label}\n        </label>\n    );\n};\n\nexport default Checkbox;\n","import React, { ChangeEvent } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { RootReducer } from '../../redux';\n\nimport Checkbox from '../Checkbox';\nimport ActionButton from '../ActionButton';\nimport { City } from '../CityModal';\n\nimport styles from './styles.module.css';\n\ntype CityChangeProps = {\n    visible: boolean;\n    wasClosed: boolean;\n    useGeolocation: boolean;\n    openCityModal: () => void;\n    onSaveClick: () => void;\n    onGeolocationChanged: (event: ChangeEvent<HTMLInputElement>) => void;\n    selectedCity: City;\n};\n\nconst CityChange: React.FC<CityChangeProps> = ({\n    visible,\n    openCityModal,\n    wasClosed,\n    onSaveClick,\n    useGeolocation,\n    onGeolocationChanged,\n    selectedCity,\n}) => {\n    const isFetchingLocation = useSelector((state: RootReducer) => state.city.isFetchingLocation);\n\n    const className = [\n        styles.wrapper,\n        visible || wasClosed ? styles[`wrapper-visible_${visible ? 'yes' : 'no'}`] : '',\n        isFetchingLocation && styles.wrapper_loading,\n    ].join(' ');\n\n    return (\n        <div className={className}>\n            <div className={styles.title}>Выбрать город</div>\n            <div className={styles['auto-select-box']}>\n                <Checkbox checked={useGeolocation} onChange={onGeolocationChanged} label={'Определять автоматически'} />\n            </div>\n            <div className={styles.selected}>\n                <div className={styles['selected-city-label']}>Город</div>\n                <div className={styles['selected-city-name']} onClick={openCityModal}>\n                    {selectedCity.name}\n                </div>\n            </div>\n            <ActionButton className={styles.button} onClick={onSaveClick}>\n                Сохранить\n            </ActionButton>\n        </div>\n    );\n};\n\nexport default CityChange;\n","import React, { ChangeEvent, useCallback, useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { RootReducer } from '../../redux';\nimport { loadCityList } from '../../redux/slices/city-list';\n\nimport { City } from '../CityModal';\nimport TextInput from '../TextInput';\n\nimport styles from './styles.module.css';\n\ntype CitySelectProps = {\n    visible: boolean;\n    wasClosed: boolean;\n    onCitySelect: (city: City) => void;\n};\n\ntype CitySelectContentProps = {\n    isLoading: boolean;\n    items: City[];\n    onCityClick: CitySelectProps['onCitySelect'];\n};\n\ntype CityOptionProps = {\n    city: City;\n    onCityClick: CitySelectContentProps['onCityClick'];\n};\n\nconst CityOption: React.FC<CityOptionProps> = props => {\n    const { city, onCityClick } = props;\n\n    const onCitySelectHandler = useCallback(() => {\n        onCityClick(city);\n    }, [onCityClick, city]);\n\n    return (\n        <li className={styles['city-item']} onClick={onCitySelectHandler}>\n            {city.name}\n        </li>\n    );\n};\n\nconst CitySelectContent: React.FC<CitySelectContentProps> = props => {\n    const { isLoading, items, onCityClick } = props;\n\n    if (isLoading) {\n        return <>loading...</>;\n    }\n\n    return (\n        <ul className={styles['city-list']}>\n            {items.map(city => {\n                if (!city) {\n                    return null;\n                }\n\n                return <CityOption key={city.geoid} city={city} onCityClick={onCityClick} />;\n            })}\n        </ul>\n    );\n};\n\nconst CitySelect: React.FC<CitySelectProps> = ({ visible, onCitySelect, wasClosed }) => {\n    const dispatch = useDispatch();\n    const { items, isLoading } = useSelector((state: RootReducer) => state.cityList);\n    const [suggestedItems, setItems] = useState(items);\n\n    const className = [\n        styles.wrapper,\n        visible || wasClosed ? styles[`wrapper-visible_${visible ? 'yes' : 'no'}`] : '',\n    ].join(' ');\n\n    useEffect(() => {\n        if (!items.length) {\n            dispatch(loadCityList());\n        } else {\n            setItems(items);\n        }\n    }, [dispatch, items]);\n\n    const onSuggestChangeHandler = useCallback(\n        (e: ChangeEvent<HTMLInputElement>) => {\n            const value = e.target.value.toLowerCase();\n\n            if (!value.trim()) {\n                setItems(items);\n            } else {\n                setItems(items.filter(({ name }) => name.toLowerCase().indexOf(value) !== -1));\n            }\n        },\n        [items]\n    );\n\n    return (\n        <div className={className}>\n            <TextInput className={styles.input} placeholder=\"Введите название\" onChange={onSuggestChangeHandler} />\n            <CitySelectContent isLoading={isLoading} items={suggestedItems} onCityClick={onCitySelect} />\n        </div>\n    );\n};\n\nexport default CitySelect;\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useClickAway } from 'react-use';\n\nimport { RootReducer } from '../../redux';\nimport { setCity as saveCity, toggleGeolocation, loadCityInfo, City as stateCity } from '../../redux/slices/city';\nimport { usePrevious } from '../../hooks/usePrevious';\n\nimport CityChange from '../CityChange';\nimport CitySelect from '../CitySelect';\n\nimport styles from './styles.module.css';\n\nexport type City = stateCity['currentCity'];\n\nconst CityModal: React.FC<{\n    visible: boolean;\n    setCityModalVisibleCallback: (visible: boolean) => void;\n}> = ({ visible: isModalVisible, setCityModalVisibleCallback: setModalVisible }) => {\n    const contentRef = React.createRef<HTMLDivElement>();\n    const dispatch = useDispatch();\n    const history = useHistory();\n\n    const currentCity = useSelector((state: RootReducer) => state.city.currentCity);\n    const useGeolocation = useSelector((state: RootReducer) => state.city.useGeolocation);\n\n    const previousCity = usePrevious<City>(currentCity);\n\n    const [selectedCity, selectCity] = useState<City>(currentCity);\n\n    const [wasClosed, setWasClosed] = useState<boolean>(false);\n    const [wasClosedModalChange, setWasClosedModalChange] = useState<boolean>(false);\n    const [wasClosedModalSelect, setWasClosedModalSelect] = useState<boolean>(false);\n    const [visibleModalChange, setVisibleModalChange] = useState<boolean>(false);\n    const [visibleModalSelect, setVisibleModalSelect] = useState<boolean>(false);\n\n    const className = [\n        styles['city-modal'],\n        isModalVisible || wasClosed ? styles[`city-modal-visible_${isModalVisible ? 'yes' : 'no'}`] : '',\n    ].join(' ');\n\n    useEffect(() => {\n        setVisibleModalChange(isModalVisible);\n    }, [setVisibleModalChange, isModalVisible]);\n\n    useEffect(() => {\n        selectCity(currentCity);\n\n        if (previousCity && previousCity.name !== currentCity.name) {\n            console.warn('Go to `/` route');\n\n            history.replace('/');\n        }\n    }, [selectCity, currentCity, previousCity, history]);\n\n    const onGeolocationChanged = useCallback(\n        e => {\n            const isChecked = e.target.checked;\n\n            dispatch(toggleGeolocation(isChecked));\n        },\n        [dispatch]\n    );\n\n    const onClose = useCallback(() => {\n        if (selectedCity.name !== currentCity.name) {\n            selectCity(currentCity);\n        }\n\n        setWasClosed(true);\n        setVisibleModalSelect(false);\n        setVisibleModalChange(false);\n        setModalVisible(false);\n    }, [\n        selectedCity,\n        currentCity,\n        selectCity,\n        setWasClosed,\n        setVisibleModalSelect,\n        setVisibleModalChange,\n        setModalVisible,\n    ]);\n\n    const onSaveClick = useCallback(() => {\n        setWasClosed(true);\n        setVisibleModalChange(false);\n        setModalVisible(false);\n\n        dispatch(saveCity(selectedCity));\n\n        if (selectedCity.name !== currentCity.name) {\n            dispatch(loadCityInfo());\n        }\n    }, [setVisibleModalChange, setModalVisible, dispatch, selectedCity, currentCity]);\n\n    const onCitySelect = useCallback(\n        (city: City) => {\n            selectCity(city);\n            setWasClosedModalSelect(true);\n            setVisibleModalSelect(false);\n            setVisibleModalChange(true);\n\n            dispatch(toggleGeolocation(false));\n        },\n        [dispatch, selectCity, setWasClosedModalSelect, setVisibleModalSelect, setVisibleModalChange]\n    );\n\n    const openCityModal = useCallback(() => {\n        setWasClosedModalChange(true);\n        setVisibleModalSelect(true);\n        setVisibleModalChange(false);\n    }, [setWasClosedModalChange, setVisibleModalSelect, setVisibleModalChange]);\n\n    useClickAway(contentRef, onClose);\n\n    return (\n        <div className={className}>\n            {isModalVisible && (\n                <div ref={contentRef}>\n                    <CityChange\n                        visible={visibleModalChange}\n                        openCityModal={openCityModal}\n                        onGeolocationChanged={onGeolocationChanged}\n                        useGeolocation={useGeolocation}\n                        wasClosed={wasClosedModalChange}\n                        selectedCity={selectedCity}\n                        onSaveClick={onSaveClick}\n                    />\n                    <CitySelect\n                        visible={visibleModalSelect}\n                        onCitySelect={onCitySelect}\n                        wasClosed={wasClosedModalSelect}\n                    />\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default CityModal;\n","import { useRef, useEffect } from 'react';\n\nexport function usePrevious<T>(value: T) {\n    const previousValue = useRef<T>();\n\n    useEffect(() => {\n        previousValue.current = value;\n    }, [value]);\n\n    return previousValue.current;\n}\n","import React, { memo, useCallback, useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport MainScreen from './screens/MainScreen';\nimport EventScreen from './screens/EventScreen';\nimport RubricScreen from './screens/RubricScreen';\nimport SelectionScreen from './screens/SelectionScreen';\nimport SearchScreen from './screens/SearchScreen';\n\nimport MenuModal from './components/MenuModal';\nimport CityModal from './components/CityModal';\n\nimport { loadCityInfo } from './redux/slices/city';\nimport { loadUserInfo } from './redux/slices/user';\n\nimport { createStackNavigator } from './components/StackNavigator';\nimport { isIOS } from './lib/is-ios';\n\nconst Navigator = createStackNavigator(\n    [\n        {\n            path: '/',\n            exact: true,\n            component: memo(() => <MainScreen />),\n        },\n        {\n            path: '/event/:id',\n            exact: true,\n            component: memo(({ params: { id } }) => <EventScreen id={id} />),\n        },\n        {\n            path: '/events/:code',\n            exact: true,\n            component: memo(({ params: { code } }) => <RubricScreen code={code} />),\n        },\n        {\n            path: '/selection/:code',\n            exact: true,\n            component: memo(({ params: { code } }) => <SelectionScreen code={code} />),\n        },\n        {\n            path: '/search',\n            exact: true,\n            component: memo(() => <SearchScreen />),\n        },\n        {\n            path: '*',\n            component: memo(() => <div>Страница не найдена</div>),\n        },\n    ],\n    {\n        // Сохраняем в истории максимум 10 экранов\n        maxDepth: 10,\n        transitions: true,\n    }\n);\n\nconst App: React.FC = () => {\n    const dispatch = useDispatch();\n\n    const [cityModalVisible, setCityModalVisible] = useState<boolean>(false);\n\n    const setCityModalVisibleCallback = useCallback(\n        (visible: boolean) => {\n            setCityModalVisible(visible);\n        },\n        [setCityModalVisible]\n    );\n\n    useEffect(() => {\n        dispatch(loadCityInfo());\n    }, [dispatch]);\n\n    useEffect(() => {\n        dispatch(loadUserInfo());\n    }, [dispatch]);\n\n    useEffect(() => {\n        if (isIOS()) {\n            document.body.style.overflow = 'auto';\n        }\n    }, []);\n\n    return (\n        <>\n            <Navigator />\n\n            <MenuModal setCityModalVisibleCallback={setCityModalVisibleCallback} />\n            <CityModal setCityModalVisibleCallback={setCityModalVisibleCallback} visible={cityModalVisible} />\n        </>\n    );\n};\n\nexport default App;\n","import React, { useEffect, useState } from 'react';\n\nimport App from './App';\n\nconst polyfillPromises: Promise<void>[] = [];\n\nif (!('IntersectionObserver' in window)) {\n    // @ts-ignore\n    polyfillPromises.push(import('intersection-observer'));\n}\nif (!('fetch' in window)) {\n    // @ts-ignore\n    polyfillPromises.push(import('whatwg-fetch'));\n}\n\nconst PolyfillApp: React.FC = () => {\n    const [canRender, setCanRender] = useState(Boolean(!polyfillPromises.length));\n\n    useEffect(() => {\n        if (polyfillPromises.length) {\n            Promise.all(polyfillPromises).then(() => setCanRender(true));\n        }\n    }, []);\n\n    return <>{canRender && <App />}</>;\n};\n\nexport default PolyfillApp;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { HashRouter } from 'react-router-dom';\nimport { PersistGate } from 'redux-persist/integration/react';\n\nimport store, { persistor } from './redux';\nimport App from './PolyfillApp';\n\nimport './index.css';\n\nReactDOM.render(\n    <Provider store={store}>\n        <PersistGate loading={null} persistor={persistor}>\n            <HashRouter>\n                <App />\n            </HashRouter>\n        </PersistGate>\n    </Provider>,\n    document.getElementById('root')\n);\n"],"sourceRoot":""}