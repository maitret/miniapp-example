{"version":3,"sources":["redux/helpers/persist.ts","components/Skeletons/index.tsx","lib/api/request.ts","lib/api/index.ts","redux/slices/user.ts","screens/EventScreen/Skeleton/styles.module.css","redux/slices/event.ts","lib/metrika/index.ts","components/PageHeader/styles.module.css","lib/url-builder.ts","lib/push-notification.ts","lib/payment.ts","lib/metrika/js-api.ts","redux/slices/order.ts","lib/lazy.ts","lib/account-manager.ts","components/StackNavigator/Screen/styles.module.css","screens/OrdersScreen/Order/Skeleton/styles.module.css","components/MenuModal/style.module.css","components/CityChange/styles.module.css","redux/slices/menu.ts","components/EventCard/style.module.css","components/EventsList/Skeleton/index.tsx","lib/is-ios.ts","components/PageHeader/index.tsx","components/MenuNavigation/style.module.css","redux/actions.ts","screens/EventScreen/components/EventsFeed/Skeleton/styles.module.css","components/StackNavigator/hooks.ts","redux/slices/selections.ts","components/StackNavigator/context.ts","components/EventCard/Skeleton/styles.module.css","components/CitySelect/styles.module.css","components/ClearButton/index.tsx","components/EventsList/constants.ts","components/EventCardVertical/Skeleton/styles.module.css","components/Image/styles.module.css","screens/SearchScreen/PopularResult/styles.module.css","components/Image/index.tsx","components/EventCard/Skeleton/index.tsx","components/StackNavigator/Screen/index.tsx","components/StackNavigator/StackNavigator.tsx","components/StackNavigator/index.tsx","redux/slices/actual-events.ts","redux/slices/rubric-events.ts","redux/slices/selection-events.ts","redux/slices/recommended-events.ts","components/TextInput/index.tsx","lib/geolocation.ts","components/BackwardButton/index.tsx","components/BackwardButton/styles.module.css","screens/MainScreen/Skeleton/styles.module.css","components/AuthBox/styles.module.css","lib/metrika/ecommerce.ts","components/Skeletons/styles.module.css","components/DateFilter/Skeleton/styles.module.css","components/SelectionList/Skeleton/styles.module.css","screens/SelectionScreen/Skeleton/styles.module.css","components/EventsList/style.module.css","components/PriceLabel/styles.module.css","screens/SearchScreen/SearchResult/styles.module.css","screens/SearchScreen/PopularResult/Skeleton/styles.module.css","screens/SearchScreen/styles.module.css","components/LoginButton/styles.module.css","components/MenuGeoLabel/styles.module.css","components/Checkbox/styles.module.css","components/ActionButton/styles.module.css","components/CityModal/styles.module.css","hooks/useMetrikaHit.ts","redux/slices/date-filter.ts","lib/date.ts","hooks/useInfiniteScroll.ts","hooks/useVisible.ts","components/EventsList/index.tsx","hooks/usePaginatedList.ts","components/EventCard/index.tsx","components/PriceLabel/index.tsx","components/TicketPrice/index.tsx","components/ActionButton/index.tsx","components/EventCardMain/Skeleton/index.tsx","components/SelectionList/Skeleton/index.tsx","lib/price.ts","components/EventCardVertical/Skeleton/index.tsx","screens/EventScreen/components/EventsFeed/Skeleton/index.tsx","screens/EventScreen/components/RecommendedEvents/Skeleton/index.tsx","components/ClearButton/styles.module.css","components/EventsList/Skeleton/styles.module.css","components/EventCardMain/Skeleton/styles.module.css","components/TextInput/styles.module.css","screens/SearchScreen/Input/styles.module.css","screens/SearchScreen/SearchResult/Skeleton/styles.module.css","redux/slices/city.ts","redux/slices/city-list.ts","redux/slices/search.ts","redux/index.ts","components/DateFilter/Skeleton/index.tsx","screens/MainScreen/Skeleton/index.tsx","screens/MainScreen/index.tsx","screens/EventScreen/Skeleton/index.tsx","screens/EventScreen/index.tsx","screens/SelectionScreen/Skeleton/index.tsx","screens/RubricScreen/index.tsx","screens/SelectionScreen/index.tsx","screens/SearchScreen/Input/index.tsx","screens/SearchScreen/SearchResult/Skeleton/index.tsx","screens/SearchScreen/SearchResult/index.tsx","hooks/useThrottleLoading.ts","screens/SearchScreen/PopularResult/Skeleton/index.tsx","screens/SearchScreen/PopularResult/index.tsx","screens/SearchScreen/index.tsx","screens/OrdersScreen/Order/Skeleton/index.tsx","screens/OrdersScreen/Skeleton/index.tsx","screens/OrdersScreen/index.tsx","components/MenuNavigation/index.tsx","components/LoginButton/index.tsx","components/AuthBox/index.tsx","components/MenuGeoLabel/index.tsx","components/MenuModal/index.tsx","components/Checkbox/index.tsx","components/CityChange/index.tsx","components/CitySelect/index.tsx","components/CityModal/index.tsx","hooks/usePrevious.ts","App.tsx","hooks/useWatchAuth.ts","PolyfillApp.tsx","index.tsx"],"names":["createPersistKeyByFilter","filter","JSON","stringify","Object","keys","sort","restoreFilterFromPersistKey","key","parse","stateReconcilerByDate","inboundState","today","Date","setHours","nowTime","getTime","reduce","result","inboundResult","inboundKey","date","keyTime","getPersistConfig","options","storage","createIdbStorage","name","storeName","serialize","deserialize","version","migrate","persistedState","currentVersion","migratedState","_persist","undefined","Promise","resolve","timeout","getTransformUIPersistance","defaultUIState","createTransform","state","Rect","className","width","height","mix","styles","rect","style","Text","size","text","classNames","Boolean","join","defaultRetryOptions","retryCount","retryDelay","queryParams","params","URLSearchParams","entries","forEach","value","Array","isArray","valueItem","append","toString","fetchRetry","url","init","retryOptions","attempt","Math","max","fetch","err","setTimeout","reject","request","response","ok","json","get","host","path","query","post","method","headers","MOSCOW","geoid","longitude","latitude","API_HOST","process","PAYMENT_API_HOST","fetchEvent","id","fetchRubricEvents","tag","fetchActualEvents","fetchSelections","fetchCityInfo","citiesWithDistance","fetchCityList","cities","map","city","distance","getDistanceBetweenPoints","minDistance","Infinity","cityInfo","nearestCity","eventsMenu","fetchSelectionEvents","code","fetchSuggest","signal","fetchRecommendedEvents","createOrder","orderData","jwtToken","Authorization","body","saveUserInfo","orderUserInfo","fetchOrdersHistory","initialState","currentUser","authorizedScopes","user","createSlice","reducers","authenticated","action","payload","token","psuid","loggedOutPsuid","authorized","scopes","logout","extraReducers","builder","addCase","cleanup","actions","isAuthenticatedSelector","isAuthorizedSelector","uid","userSelector","SCOPES","YandexAuthScope","Avatar","Info","Email","authenticate","afterLogin","dispatch","getState","psuidInfo","identify","console","error","message","alert","authorize","userInfo","tokenInfo","authorizeScopes","includes","login","fetchOrders","checkUser","oldPsuid","getCurrentUserId","persistConfig","persistReducer","reducer","module","exports","data","ui","slice","fetchStart","event","schedule","updatedAt","isLoading","isUpdating","fetchSuccess","scheduleInfo","now","fetchError","setEvents","events","eventPageSelector","loadEvent","transforms","MetrikaGoals","initialOptions","defer","clickmap","trackLinks","trackHash","accurateTrackBounce","ecommerce","initMetrika","window","dataLayer","ym","hit","reachGoal","getMainPageUrl","getEventUrl","getRubricUrl","encodeURIComponent","getSelectionUrl","getSearchUrl","getOrdersUrl","getTransactionPushToken","paymentToken","yandex","app","push","getPushTokenForTransaction","PaymentError","reportGoalReached","goal","ErrorsMap","Cancelled","Shown","orderInfo","cost","yandexMethodData","supportedMethods","userEmail","email","details","total","label","amount","currency","PaymentRequest","Error","NotSupported","canMakePayment","show","complete","mappedError","orders","order","orderCreationStart","isCheckoutInProgress","isOrderCreationInProgress","orderCreationSuccess","activeOrder","orderCreationEnd","paymentStart","isPaymentInProgress","paymentEnd","checkoutEnd","paymentInProgressSelector","checkoutInProgressSelector","orderCreationInProgressSelector","ordersSelector","orderEventIdsSelector","createSelector","payments","from","Set","ordersLoadingSelector","orderEventIds","orderUi","eventsUi","isEventLoading","some","onOrderCreated","retry","currentUserId","metrikaParams","order_id","createOrderAPI","eventId","price","price_without_discount","OrderInitiated","status","buyTicket","logProductAdd","processNativePayment","pushToken","fetchPushToken","saveUserInfoAPI","paymentId","catch","OrderCompleted","logProductPurchase","OrderError","lazyDeferred","importCallback","lazy","all","then","CLIENT_ID","auth","rawData","menu","visible","items","activeItem","setItems","setVisible","EventsListSkeleton","itemsGap","DEFAULT_ITEMS_GAP","count","card","Card","gridGap","fill","_","index","isIOS","test","navigator","platform","userAgent","maxTouchPoints","MSStream","Logo","to","logo","SuggestIcon","setMods","mods","memo","props","hasMenu","hasLogo","backward","history","useHistory","useDispatch","onSearchClick","useCallback","onMenuClick","setMenuVisible","onClick","createAction","useBackward","onBackward","useContext","StackNavigatorContext","useMemo","bind","useScreenVisible","isVisible","useScreenRef","ref","length","selections","selection","title","image","eventPreview","selectionsSelector","persistKey","currentCity","dateFilter","selectionsUISelector","loadSelections","stateReconciler","createContext","createRef","ClearButton","children","cls","clear","Image","color","bgColor","isLoaded","setLoaded","useState","onLoad","src","stubClassNames","stub","containerClassNames","container","srcSet","src2x","alt","backgroundColor","EventCardSkeleton","right","description","Screen","transitions","screen","hidden","useRef","context","Provider","component","location","enter","screenEnter","enterActive","screenEnterActive","exit","screenExit","exitActive","screenExitActive","transitionCallbacks","onEnter","node","previousElementSibling","classList","add","offset","onExit","remove","transitionTimeouts","StackNavigator","screens","maxDepth","stack","setStack","useLocation","iOS","callback","useEffect","useLocationChange","scrollTo","isBackward","isReplace","match","item","matchPath","pathname","newStackItem","newStack","splice","warn","fallback","goBack","replace","TransitionGroup","CSSTransition","createStackNavigator","scrollRestoration","actualEventsSelector","actualEvents","actualEventsUISelector","loadActualEvents","prefetchItems","paging","hasMoreItems","isLoadingMore","fetchMoreStart","fetchMoreSuccess","fetchMoreError","rubricEventsSelector","rubricEvents","rubricEventsUISelector","loadRubricEvents","limit","loadMoreRubricEvents","selectionsFetchSuccess","eventsKey","selectionEventsSelector","selectionEvents","selectionEventsUISelector","loadSelectionEvents","loadMoreSelectionEvents","top","concert","cinema","theatre","recommendedEventsSelector","recommendedEvents","recommendedEventsUISelector","loadRecommendedEvents","TextInput","forwardRef","type","input","GEOLOCATIONS_OPTIONS","maximumAge","getCurrentPosition","geolocation","position","coords","deg2rad","deg","PI","lat1","lon1","lat2","lon2","tmp","sin","cos","asin","sqrt","BackwardIcon","Backward","getProductFromEvent","tickets","min","category","getEventCurrency","toUpperCase","logProductView","currencyCode","detail","products","orderId","purchase","actionField","useMetrikaHit","href","dateToString","period","setDate","format","parseDate","useInfiniteScroll","threshold","loadMore","hasMore","needLoadMore","optionsRef","useLayoutEffect","current","observer","IntersectionObserver","entry","isIntersecting","observe","disconnect","useVisible","rootMargin","EventsListLoadable","loadMoreRef","pageSize","setLimit","wrappedLoadMore","usePaginatedList","list","EventsListItems","skeleton","actualEvent","onItemClick","EventsList","argument","ticket","eventListCard","eventListCard2x","preview","annotation","PriceLabel","space","TicketPrice","exact","getCurrencySymbol","ActionButton","disabled","formInvalid","invalid","EventCardMainSkeleton","SelectionListSkeleton","block","currencySymbol","rub","usd","EventCardVerticalSkeleton","EventsFeedSkeleton","feed","RecommendedEventsSkeleton","useGeolocation","isFetchingLocation","setCity","setGeolocation","locationFetchStart","locationFetchSuccess","locationFetchFailed","loadCityInfoByLocation","showError","setMenuItems","loadCityInfo","cityState","toggleGeolocation","isActive","cityList","setLoading","setCityListResult","loadCityList","blacklist","results","groups","popularEvents","search","fetchPopularStart","fetchPopularSuccess","fetchPopularError","searchStart","searchSuccess","group","documents","doc","document","minPrice","object","tags","contentRating","userRating","placesTotal","transformSearchDocumentToList","searchError","resetResults","loadPopularEvents","activeRequest","loadSearchResults","abort","AbortController","suggest","toLowerCase","trim","filterGroupsByText","rest","PERSIST_ACTIONS","PERSIST_CONTSTANS","rootReducer","combineReducers","eventReducer","actualEventsReducer","rubricEventsReducer","selectionsReducer","selectionEventsReducer","cityReducer","cityListReducer","searchReducer","menuReducer","dateFilterReducer","recommendedReducer","userReducer","orderReducer","store","configureStore","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","persistor","persistStore","DateFilterSkeleton","MainScreenSkeleton","content","Component","MainScreen","useSelector","PageHeader","EventSkeleton","button","gallery","recommended","EventScreen","SelectionScreenSkeleton","RubricScreen","SelectionScreen","SuggestInput","inputRef","setValue","onChange","e","target","focus","defaultValue","placeholder","SearchResultSkeleton","SearchResult","isThrottleLoading","time","setThrottleLoading","newTimerId","clearTimeout","useThrottleLoading","EventCard","notFound","PopularResultSkeleton","showTitle","Index","onLinkClick","i","link","SearchScreen","hasQuery","setHasQuery","onInputChange","throttle","onSearchClose","header","BackwardButton","PopularResult","OrderSkeleton","short","OrdersScreenSkeleton","OrdersScreen","eventIds","MenuItem","activeClassName","MenuList","isAuthenticated","LoginButton","onLoginClick","avatarImage","avatarImage2x","AuthBox","isAuthorized","display_name","username","MenuGeoLabel","setCityModalVisibleCallback","onCitySelectLabelClickHandle","wrapper","select","MenuModal","onClose","onModalContentClick","stopPropagation","onLogoutClick","modal","profile","footer","Checkbox","checkbox","CityChange","openCityModal","wasClosed","onSaveClick","onGeolocationChanged","selectedCity","wrapper_loading","checked","selected","CityOption","onCityClick","onCitySelectHandler","CitySelectContent","CitySelect","onCitySelect","suggestedItems","onSuggestChangeHandler","indexOf","CityModal","isModalVisible","setModalVisible","contentRef","previousCity","previousValue","usePrevious","selectCity","setWasClosed","wasClosedModalChange","setWasClosedModalChange","wasClosedModalSelect","setWasClosedModalSelect","visibleModalChange","setVisibleModalChange","visibleModalSelect","setVisibleModalSelect","isChecked","saveCity","useClickAway","Navigator","App","cityModalVisible","setCityModalVisible","overflow","onVisibilityChange","visibilityState","addEventListener","removeEventListener","useWatchAuth","polyfillPromises","PolyfillApp","canRender","setCanRender","ReactDOM","render","loading","getElementById"],"mappings":"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","file":"static/js/main.4002b3d2.chunk.js","sourcesContent":["import { PersistConfig, createTransform } from 'redux-persist';\nimport { StateReconciler } from 'redux-persist/es/types';\nimport { parse } from 'date-fns';\n// @ts-ignore\nimport createIdbStorage from '@piotr-cz/redux-persist-idb-storage/src';\n\nexport type Filter = {\n    [key: string]: string | number;\n};\nexport function createPersistKeyByFilter(filter: Filter) {\n    return JSON.stringify(filter, Object.keys(filter).sort());\n}\n\nexport function restoreFilterFromPersistKey<T>(key: keyof T): Filter {\n    return JSON.parse(key as string);\n}\n\ntype State = { [key: string]: Record<string, unknown> };\n\nexport function stateReconcilerByDate<T extends State>(inboundState: T): T {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const nowTime = today.getTime();\n\n    return Object.keys(inboundState)\n        .filter(key => key !== '_persist')\n        .reduce<T>((result, key: keyof T) => {\n            result[key] = Object.keys(inboundState[key]).reduce((inboundResult, inboundKey: keyof T[keyof T]) => {\n                const { date } = restoreFilterFromPersistKey(inboundKey);\n\n                // Если фильтра по дате нет, то данные не зависят от времени\n                if (!date) {\n                    inboundResult[inboundKey] = inboundState[key][inboundKey];\n                    return inboundResult;\n                }\n\n                const keyTime = parse(date).getTime();\n\n                // Оставляем только актуальные данные\n                if (nowTime <= keyTime) {\n                    inboundResult[inboundKey] = inboundState[key][inboundKey];\n                }\n\n                return inboundResult;\n            }, {} as T[keyof T]);\n\n            return result;\n        }, {} as T);\n}\n\ntype PersistOptions<S> = Omit<PersistConfig<S>, 'key' | 'storage'> & {\n    stateReconciler?: StateReconciler<S>;\n};\nexport function getPersistConfig<S>(key: string, options?: PersistOptions<S>): PersistConfig<S> {\n    return {\n        ...options,\n        storage: createIdbStorage({\n            name: 'miniapp-example',\n            storeName: 'redux-persist',\n        }),\n        key,\n        serialize: false,\n        // @ts-ignore\n        deserialize: false,\n        version: 6,\n        migrate: (persistedState, currentVersion) => {\n            // Достаем версию сохраненных в кэше данных.\n            const persistedVersion = persistedState && persistedState._persist.version;\n            // Если версия сохраненных данных совпадает с текущей версией обрабатываемых данных,\n            // оставляем данные неизменными, иначе - сбрасываем данные.\n            const migratedState = persistedVersion === currentVersion ? persistedState : undefined;\n\n            return Promise.resolve(migratedState);\n        },\n        timeout: 10000, // 10 секунд может быть полезно для low-end устройств\n    };\n}\n\nexport function getTransformUIPersistance<T>(defaultUIState: T) {\n    return createTransform((state: State[keyof State], key) => {\n        if (key === 'ui') {\n            return defaultUIState;\n        }\n\n        return state;\n    });\n}\n","import React from 'react';\n\nimport styles from './styles.module.css';\n\ntype RectProps = {\n    className?: string;\n    width?: number | string;\n    height?: number | string;\n    borderRadius?: number;\n};\n\nexport const Rect: React.FC<RectProps> = ({ className, width, height }) => {\n    return <div className={mix(styles.rect, className)} style={{ width, height }} />;\n};\n\ntype TextProps = {\n    className?: string;\n    width?: number | string;\n    size?: number;\n};\n\nexport const Text: React.FC<TextProps> = ({ className, width, size }) => {\n    return <div className={mix(styles.text, className)} style={{ width, height: size }} />;\n};\n\nfunction mix(...classNames: Array<string | null | undefined>) {\n    return classNames.filter(Boolean).join(' ');\n}\n","type QueryParams = {\n    [key: string]: string | number | string[] | undefined;\n};\n\ntype RetryOptions = {\n    retryCount: number;\n    retryDelay: number;\n};\n\nconst defaultRetryOptions: RetryOptions = {\n    retryCount: 2,\n    retryDelay: 2000,\n};\n\nfunction queryParams(params?: QueryParams) {\n    if (!params) {\n        return '';\n    }\n\n    const result = new URLSearchParams();\n\n    Object.entries(params).forEach(([key, value]) => {\n        if (typeof value === 'undefined') {\n            return;\n        }\n\n        if (Array.isArray(value)) {\n            return value.forEach(valueItem => result.append(key, valueItem));\n        }\n\n        result.append(key, value.toString());\n    });\n\n    return result.toString();\n}\n\nasync function fetchRetry(url: string, init?: RequestInit, retryOptions: RetryOptions = defaultRetryOptions) {\n    const { retryCount, retryDelay } = retryOptions;\n\n    for (let attempt = 0; attempt <= Math.max(retryCount, 0); attempt++) {\n        try {\n            return await fetch(url, init);\n        } catch (err) {\n            if (attempt === retryCount) {\n                throw err;\n            }\n\n            if (retryDelay) {\n                await new Promise(resolve => setTimeout(resolve, retryDelay));\n            }\n        }\n    }\n\n    return Promise.reject('Unable to fetch. Check retryOptions values');\n}\n\nasync function request<T extends object>(url: string, options?: RequestInit): Promise<T> {\n    const response = await fetchRetry(url, options);\n\n    if (response.ok) {\n        return response.json();\n    }\n\n    return Promise.reject(response);\n}\n\nexport async function get<T extends object>(\n    host: string,\n    path: string,\n    query?: QueryParams,\n    options?: RequestInit\n): Promise<T> {\n    return request(`${host}${path}${queryParams(query) ? `?${queryParams(query)}` : ''}`, options);\n}\n\nexport async function post<T extends object>(host: string, path: string, options: RequestInit): Promise<T> {\n    return request(`${host}${path}`, {\n        ...options,\n        method: 'POST',\n        headers: {\n            ...options.headers,\n            'Content-Type': 'application/json',\n        },\n    });\n}\n","import { getDistanceBetweenPoints } from '../geolocation';\nimport { get, post } from './request';\nimport {\n    RubricEventsResponse,\n    ActualEventsResponse,\n    EventResponse,\n    SelectionsResponse,\n    SelectionEventsResponse,\n    CityInfoResponse,\n    CityListResponse,\n    SuggestResponse,\n    RecommendedEventsResponse,\n    CreateOrderResponse,\n    OrderResponse,\n    UserInfo,\n} from './types';\nimport { City } from './fragments/city';\n\nexport const MOSCOW = {\n    name: 'Москва',\n    geoid: 213,\n    longitude: 37.611347,\n    latitude: 55.760241,\n} as const;\n\ntype DateFilter = {\n    date: string;\n    period: number;\n};\n\nexport type GetEventsOptions = {\n    geoid: number;\n    offset?: number;\n    limit?: number;\n} & Partial<DateFilter>;\n\ntype GetCityInfoOptions = {\n    longitude: number;\n    latitude: number;\n};\n\nexport type GetSelectionsOptions = DateFilter & { geoid: number };\n\nconst API_HOST = process.env.REACT_APP_API_HOST ?? '';\nconst PAYMENT_API_HOST = process.env.REACT_APP_PAYMENT_API_HOST ?? '';\n\nexport function fetchEvent(id: string) {\n    return get<EventResponse>(API_HOST, `/api/event/${id}.json`);\n}\n\nexport function fetchRubricEvents(tag: string, options?: GetEventsOptions) {\n    return get<RubricEventsResponse>(API_HOST, `/api/rubric-events/${tag}.json`, options);\n}\n\nexport function fetchActualEvents(options?: GetEventsOptions) {\n    return get<ActualEventsResponse>(API_HOST, '/api/actual-events.json', options);\n}\n\nexport function fetchSelections(options?: GetSelectionsOptions) {\n    return get<SelectionsResponse>(API_HOST, '/api/selections.json', options);\n}\n\nexport async function fetchCityInfo(options: GetCityInfoOptions): Promise<CityInfoResponse> {\n    const cityList = await fetchCityList();\n\n    const citiesWithDistance = cityList.cities.map(city => {\n        const distance = getDistanceBetweenPoints(options.latitude, options.longitude, city.latitude, city.longitude);\n\n        return {\n            ...city,\n            distance,\n        };\n    });\n\n    let minDistance = Infinity;\n\n    const nearestCity: City = citiesWithDistance.reduce<City>(\n        (nearestCity, city) => {\n            if (city.distance < minDistance) {\n                minDistance = city.distance;\n\n                delete city.distance;\n\n                return city;\n            }\n\n            return nearestCity;\n        },\n        {\n            ...MOSCOW,\n            eventsMenu: [],\n        }\n    );\n\n    return {\n        cityInfo: nearestCity,\n    };\n}\n\nexport function fetchCityList() {\n    return get<CityListResponse>(API_HOST, '/api/city-list.json');\n}\n\nexport function fetchSelectionEvents(code: string, options?: GetEventsOptions) {\n    return get<SelectionEventsResponse>(API_HOST, `/api/selection-events/${code}.json`, options);\n}\n\nexport function fetchSuggest(text: string, geoid: number, signal: AbortSignal) {\n    return get<SuggestResponse>(API_HOST, '/api/suggest.json', { text, geoid }, { signal });\n}\n\nexport function fetchRecommendedEvents(options?: GetEventsOptions) {\n    return get<RecommendedEventsResponse>(API_HOST, '/api/recommended-events.json', options);\n}\n\nexport type OrderData = {\n    eventId: string;\n    amount: number;\n};\nexport function createOrder(orderData: OrderData, jwtToken: string) {\n    return post<CreateOrderResponse>(PAYMENT_API_HOST, '/payment', {\n        headers: {\n            Authorization: jwtToken,\n        },\n        body: JSON.stringify(orderData),\n    });\n}\n\nexport type OrderUserInfo = {\n    userInfo: UserInfo;\n    paymentId: number;\n    pushToken?: string;\n};\nexport function saveUserInfo(orderUserInfo: OrderUserInfo, jwtToken: string) {\n    return post(PAYMENT_API_HOST, '/payment/user-info', {\n        headers: {\n            Authorization: jwtToken,\n        },\n        body: JSON.stringify(orderUserInfo),\n    });\n}\n\nexport function fetchOrdersHistory(jwtToken: string) {\n    return get<OrderResponse[]>(PAYMENT_API_HOST, '/payments', undefined, {\n        headers: {\n            Authorization: jwtToken,\n        },\n    });\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { authorizeScopes, getCurrentUserId, identify, UserInfo, YandexAuthScope } from '../../lib/account-manager';\n\nimport { AppThunk, RootState } from '../index';\nimport { cleanup } from '../actions';\nimport { getPersistConfig } from '../helpers/persist';\n\nimport { fetchOrders } from './order';\n\nexport type User = {\n    jwtToken?: string;\n    psuid?: string;\n    currentUser: UserInfo;\n    authorizedScopes: YandexAuthScope[];\n    loggedOutPsuid?: string;\n};\n\nconst initialState: User = {\n    currentUser: {},\n    authorizedScopes: [],\n};\n\nconst user = createSlice({\n    name: 'user',\n    initialState,\n    reducers: {\n        authenticated(state, action: PayloadAction<{ psuid: string; token: string }>) {\n            state.jwtToken = action.payload.token;\n            state.psuid = action.payload.psuid;\n\n            delete state.loggedOutPsuid;\n        },\n        authorized(state, action: PayloadAction<{ user: UserInfo; scopes: YandexAuthScope[] }>) {\n            state.currentUser = action.payload.user;\n            state.authorizedScopes = action.payload.scopes;\n        },\n        logout(state) {\n            return {\n                ...initialState,\n                loggedOutPsuid: state.psuid,\n            };\n        },\n    },\n    extraReducers: builder => {\n        builder.addCase(cleanup, () => initialState);\n    },\n});\n\nexport const { authenticated, authorized, logout } = user.actions;\n\nexport const isAuthenticatedSelector = (state: RootState) => Boolean(state.user.psuid);\nexport const isAuthorizedSelector = (state: RootState) => Boolean(state.user.currentUser.uid);\nexport const userSelector = (state: RootState) => state.user.currentUser;\n\nconst SCOPES = [YandexAuthScope.Avatar, YandexAuthScope.Info, YandexAuthScope.Email];\n\nexport const authenticate = (afterLogin?: () => void): AppThunk => async(dispatch, getState) => {\n    try {\n        const {\n            user: { psuid },\n        } = getState();\n        const psuidInfo = await identify();\n\n        if (psuid && psuid !== psuidInfo.payload.psuid) {\n            dispatch(cleanup());\n        }\n\n        dispatch(authenticated({ token: psuidInfo.jwtToken, psuid: psuidInfo.payload.psuid }));\n\n        afterLogin?.();\n    } catch (err) {\n        console.error(err);\n        if (err.message !== 'user not logged') {\n            alert('Не удалось войти. Попробуйте ещё раз');\n        }\n    }\n};\n\nexport const authorize = (): AppThunk => async dispatch => {\n    try {\n        const {\n            userInfo,\n            tokenInfo: { authorizedScopes },\n        } = await authorizeScopes(SCOPES);\n\n        dispatch(authorized({ user: userInfo.payload, scopes: authorizedScopes }));\n    } catch (err) {\n        console.error(err);\n        if (!['authorization denied', 'authorization cancelled'].includes(err.message)) {\n            alert('Не удалось получить информацию о пользователе');\n        }\n    }\n};\n\nexport const login = (): AppThunk => async dispatch => {\n    await dispatch(\n        authenticate(() => {\n            dispatch(fetchOrders());\n        })\n    );\n};\n\nexport const checkUser = (): AppThunk => async(dispatch, getState) => {\n    const oldPsuid = getState().user.psuid;\n\n    try {\n        const user = await getCurrentUserId();\n        const isUserChanged = oldPsuid && user?.payload.psuid !== oldPsuid;\n\n        if (isUserChanged) {\n            dispatch(cleanup());\n        }\n\n        if (!user) {\n            return;\n        }\n\n        const psuid = user.payload.psuid;\n\n        // Если пользователь разлогинился, то не логиним его автоматически\n        if (psuid === getState().user.loggedOutPsuid) {\n            return;\n        }\n\n        dispatch(authenticated({ token: user.jwtToken, psuid }));\n        dispatch(fetchOrders());\n    } catch (err) {\n        console.error(err);\n\n        if (oldPsuid) {\n            dispatch(cleanup());\n        }\n    }\n};\n\nconst persistConfig = getPersistConfig<User>('user');\nexport default persistReducer(persistConfig, user.reducer);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"image\":\"styles_image__Xibal\",\"button-wrapper\":\"styles_button-wrapper__1xmRh\",\"button\":\"styles_button__3ugFI\",\"date-1\":\"styles_date-1__1KrEV\",\"date-2\":\"styles_date-2__u1uuX\",\"map\":\"styles_map__1GZMr\",\"place-1\":\"styles_place-1__2BRJQ\",\"place-2\":\"styles_place-2__1cKpq\",\"gallery\":\"styles_gallery__33Vja\",\"gallery-header\":\"styles_gallery-header__2mb0M\",\"gallery-content\":\"styles_gallery-content__3RMTY\",\"gallery-card\":\"styles_gallery-card__1qkm9\",\"description\":\"styles_description__hdSqE\",\"description-line-1\":\"styles_description-line-1__26Xb3\",\"description-line-2\":\"styles_description-line-2__20hRv\",\"description-line-3\":\"styles_description-line-3__1VXVh\",\"description-line-4\":\"styles_description-line-4__2BYM0\",\"description-line-5\":\"styles_description-line-5__3aCps\",\"recommended\":\"styles_recommended__3JCFj\"};","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { fetchEvent } from '../../lib/api';\nimport { EventResponse } from '../../lib/api/types';\nimport { getPersistConfig, getTransformUIPersistance } from '../helpers/persist';\nimport { AppThunk, RootState } from '..';\n\nexport type Event = EventResponse['event'];\nexport type ScheduleInfo = EventResponse['scheduleInfo'];\n\nexport type EventPage = {\n    event: Event | null;\n    schedule: ScheduleInfo | null;\n    updatedAt: number;\n};\nexport type EventPageState = {\n    data: { [id: string]: EventPage };\n    ui: { [id: string]: { isLoading: boolean; isUpdating: boolean } };\n};\n\nconst initialState: EventPageState = {\n    data: {},\n    ui: {},\n};\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'event',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ id: string }>) {\n            const { id } = action.payload;\n\n            if (!state.data[id]) {\n                state.data[id] = {\n                    event: null,\n                    schedule: null,\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[id]) {\n                state.ui[id] = {\n                    isLoading: false,\n                    isUpdating: false,\n                };\n            }\n\n            if (!state.data[id].event) {\n                state.ui[id].isLoading = true;\n            } else {\n                state.ui[id].isUpdating = true;\n            }\n        },\n        fetchSuccess(state, action: PayloadAction<{ id: string; event: EventResponse }>) {\n            const { id, event } = action.payload;\n\n            state.data[id].event = event.event;\n            state.data[id].schedule = event.scheduleInfo;\n            state.data[id].updatedAt = Date.now();\n            state.ui[id].isLoading = false;\n            state.ui[id].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ id: string; error: Error }>) {\n            const { id } = action.payload;\n\n            state.ui[id].isLoading = false;\n            state.ui[id].isUpdating = false;\n        },\n        setEvents(state, action: PayloadAction<{ events: EventResponse[] }>) {\n            const { events } = action.payload;\n\n            events.forEach(event => {\n                if (!event) {\n                    return;\n                }\n\n                const { id } = event.event;\n\n                if (!state.data[id]) {\n                    state.data[id] = {\n                        event: null,\n                        schedule: null,\n                        updatedAt: 0,\n                    };\n                }\n                if (!state.ui[id]) {\n                    state.ui[id] = {\n                        isLoading: false,\n                        isUpdating: false,\n                    };\n                }\n\n                state.data[id].event = event.event;\n                state.data[id].schedule = event.scheduleInfo;\n                state.data[id].updatedAt = Date.now();\n            });\n        },\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError, setEvents } = slice.actions;\n\nexport const eventPageSelector = (id: string) => (state: RootState) => state.event.data[id] ?? {};\n\nexport const loadEvent = (id: string): AppThunk => async(dispatch, getState) => {\n    const event = getState().event.data[id];\n\n    if (event && event.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ id }));\n\n    try {\n        const event = await fetchEvent(id);\n        dispatch(fetchSuccess({ id, event }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ id, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<EventPageState>('events', {\n    transforms: [getTransformUIPersistance<EventPageState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","/* eslint-disable camelcase */\nimport { YMetrikaInitParams, YMetrikaVisitParams } from './types';\n\nconst METRIKA_COUNTER_ID = 62405404;\n\nexport const initialOptions: YMetrikaInitParams = {\n    defer: true,\n    clickmap: true,\n    trackLinks: true,\n    trackHash: true,\n    accurateTrackBounce: true,\n    ecommerce: 'dataLayer'\n};\n\nexport enum MetrikaGoals {\n    OrderInitiated = 'order_initiated',\n    OrderCompleted = 'order_completed',\n    OrderError = 'order_error',\n}\n\nexport type MetrikaOrderParams = {\n    order_id: number;\n    price: number;\n    price_without_discount: number;\n}\n\nexport function initMetrika() {\n    window.dataLayer = window.dataLayer ?? [];\n    window.ym?.(METRIKA_COUNTER_ID, 'init', initialOptions);\n}\n\nexport function hit(url: string, options?: { params?: YMetrikaVisitParams }) {\n    window.ym?.(METRIKA_COUNTER_ID, 'hit', url, options);\n}\n\nexport function reachGoal(name: MetrikaGoals, params: MetrikaOrderParams) {\n    window.ym?.(METRIKA_COUNTER_ID, 'reachGoal', name, params);\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"page-header\":\"styles_page-header__3SRj-\",\"page-header_clear\":\"styles_page-header_clear__1-0qG\",\"menu-button\":\"styles_menu-button__27a1S\",\"backward-button\":\"styles_backward-button__1gLVd\",\"burger-menu-icon\":\"styles_burger-menu-icon__30H4q\",\"logo\":\"styles_logo__3HQmN\",\"text\":\"styles_text__2t8C3\",\"suggest-button\":\"styles_suggest-button__jwrxc\",\"suggest-icon\":\"styles_suggest-icon__YMWw5\",\"icon-white\":\"styles_icon-white__3C4HZ\",\"icon-black\":\"styles_icon-black__3s7hW\"};","type QueryParams = Record<string, string>;\n\nexport function getMainPageUrl() {\n    return '/';\n}\n\nexport function getEventUrl(id: string) {\n    return `/event/${id}`;\n}\n\nexport function getEventGalleryUrl(id: string, query: QueryParams) {\n    const params = query ? `?${new URLSearchParams(query)}` : '';\n\n    return `/event/${id}/gallery${params}`;\n}\n\nexport function getRubricUrl(code: string) {\n    return `/events/${encodeURIComponent(code)}`;\n}\n\nexport function getSelectionUrl(code: string) {\n    return `/selection/${encodeURIComponent(code)}`;\n}\n\nexport function getSearchUrl() {\n    return '/search';\n}\n\nexport function getOrdersUrl() {\n    return '/orders';\n}\n","export type YandexTransactionPushToken = {\n    jwtToken: string;\n    pushToken: string;\n};\n\nexport async function getTransactionPushToken(paymentToken: string) {\n    return window.yandex.app.push.getPushTokenForTransaction(paymentToken);\n}\n","import { UserInfo } from './account-manager';\nimport { CreateOrderResponse } from './api/types';\n\ninterface YandexPaymentMethodData extends PaymentMethodData {\n    supportedMethods: 'yandex',\n    data: {\n        userEmail?: string;\n        paymentToken: string;\n    };\n}\n\nexport enum PaymentError {\n    NotSupported = 'not_supported',\n    Cancelled = 'cancelled',\n    Shown = 'shown'\n}\n\nconst ErrorsMap: Record<string, PaymentError> = {\n    '[NOT_STARTED]: ': PaymentError.Cancelled,\n    'Already shown': PaymentError.Shown,\n};\n\nexport async function processNativePayment(orderInfo: CreateOrderResponse, user: UserInfo) {\n    const { paymentToken, cost, id } = orderInfo;\n\n    const yandexMethodData: YandexPaymentMethodData = {\n        supportedMethods: 'yandex',\n        data: {\n            userEmail: user.email,\n            paymentToken: paymentToken\n        }\n    };\n\n    const details: PaymentDetailsInit = {\n        id: id.toString(),\n        total: {\n            label: 'Покупка билета',\n            amount: {\n                currency: 'RUB',\n                value: cost.toString()\n            }\n        }\n    };\n\n    if (!window.PaymentRequest) {\n        throw new Error(PaymentError.NotSupported);\n    }\n\n    try {\n        const request = new PaymentRequest([yandexMethodData], details);\n        const canMakePayment = await request.canMakePayment();\n\n        if (!canMakePayment) {\n            throw new Error(PaymentError.NotSupported);\n        }\n\n        const response = await request.show();\n        await response.complete('success');\n    } catch (err) {\n        const message = err.message as string;\n        const mappedError = ErrorsMap[message];\n\n        throw mappedError ? new Error(mappedError) : err;\n    }\n}\n","import { MetrikaGoals, MetrikaOrderParams } from './index';\n\nexport async function reportGoalReached(goal: MetrikaGoals, params: MetrikaOrderParams) {\n    try {\n        await window.yandex.app.reportGoalReached(goal, params);\n    } catch (err) {\n        console.error(err);\n    }\n}\n","import { createSelector, createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { AppThunk, RootState } from '../index';\nimport { cleanup } from '../actions';\nimport { getPersistConfig, getTransformUIPersistance } from '../helpers/persist';\nimport { getCurrentUserId } from '../../lib/account-manager';\nimport { getTransactionPushToken, YandexTransactionPushToken } from '../../lib/push-notification';\nimport { createOrder as createOrderAPI, saveUserInfo as saveUserInfoAPI, fetchOrdersHistory } from '../../lib/api';\nimport { Event } from '../../lib/api/fragments/event';\nimport { CreateOrderResponse, OrderResponse, UserInfo } from '../../lib/api/types';\nimport { MetrikaGoals, MetrikaOrderParams, reachGoal } from '../../lib/metrika';\nimport { logProductAdd, logProductPurchase } from '../../lib/metrika/ecommerce';\nimport { reportGoalReached } from '../../lib/metrika/js-api';\nimport { PaymentError, processNativePayment } from '../../lib/payment';\nimport { authenticate } from './user';\n\nexport type Order = {\n    data: {\n        activeOrder?: CreateOrderResponse;\n        orders: OrderResponse[];\n    };\n    ui: {\n        isLoading?: boolean;\n        isOrderCreationInProgress?: boolean;\n        isPaymentInProgress?: boolean;\n        isCheckoutInProgress?: boolean;\n    };\n};\n\nconst initialState: Order = {\n    data: {\n        orders: [],\n    },\n    ui: {},\n};\n\nconst order = createSlice({\n    name: 'order',\n    initialState,\n    reducers: {\n        fetchStart(state) {\n            state.ui.isLoading = true;\n        },\n        fetchSuccess(state, action: PayloadAction<OrderResponse[]>) {\n            state.ui.isLoading = false;\n            state.data.orders = action.payload;\n        },\n        fetchError(state) {\n            state.ui.isLoading = false;\n        },\n        orderCreationStart(state) {\n            state.ui.isCheckoutInProgress = true;\n            state.ui.isOrderCreationInProgress = true;\n        },\n        orderCreationSuccess(state, action: PayloadAction<CreateOrderResponse>) {\n            state.data.activeOrder = action.payload;\n            state.ui.isOrderCreationInProgress = false;\n        },\n        orderCreationEnd(state) {\n            state.ui.isOrderCreationInProgress = false;\n        },\n        paymentStart(state) {\n            state.ui.isPaymentInProgress = true;\n        },\n        paymentEnd(state) {\n            state.ui.isPaymentInProgress = false;\n        },\n        checkoutEnd(state) {\n            state.ui.isCheckoutInProgress = false;\n            delete state.data.activeOrder;\n        },\n    },\n    extraReducers: builder => {\n        builder.addCase(cleanup, () => initialState);\n    },\n});\n\nexport const {\n    fetchStart,\n    fetchSuccess,\n    fetchError,\n    paymentStart,\n    paymentEnd,\n    checkoutEnd,\n    orderCreationStart,\n    orderCreationSuccess,\n    orderCreationEnd,\n} = order.actions;\n\nexport const paymentInProgressSelector = (state: RootState) => Boolean(state.order.ui.isPaymentInProgress);\nexport const checkoutInProgressSelector = (state: RootState) => Boolean(state.order.ui.isCheckoutInProgress);\nexport const orderCreationInProgressSelector = (state: RootState) => Boolean(state.order.ui.isOrderCreationInProgress);\nexport const ordersSelector = (state: RootState) => state.order.data.orders;\n\nexport const orderEventIdsSelector = createSelector(ordersSelector, payments =>\n    Array.from(new Set(payments.map(order => order.event.id)))\n);\n\nexport const ordersLoadingSelector = createSelector(\n    orderEventIdsSelector,\n    (state: RootState) => state.order.ui,\n    (state: RootState) => state.event.ui,\n    (orderEventIds, orderUi, eventsUi) => {\n        const isEventLoading = orderEventIds.some(event => eventsUi[event]?.isLoading);\n\n        return orderUi.isLoading || isEventLoading;\n    }\n);\n\nexport const fetchOrders = (): AppThunk => async(dispatch, getState) => {\n    const { jwtToken } = getState().user;\n\n    if (!jwtToken) {\n        return;\n    }\n\n    dispatch(fetchStart());\n\n    try {\n        const orders = await fetchOrdersHistory(jwtToken);\n        dispatch(fetchSuccess(orders));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError());\n    }\n};\n\nexport const createOrder = (\n    event: Event,\n    onOrderCreated: () => void = () => {},\n    retry: boolean = true\n): AppThunk => async(dispatch, getState) => {\n    const { jwtToken, psuid } = getState().user;\n\n    dispatch(orderCreationStart());\n\n    try {\n        const currentUserId = await getCurrentUserId();\n\n        if (!jwtToken || !psuid || !currentUserId) {\n            await dispatch(authenticate(() => dispatch(createOrder(event, onOrderCreated))));\n\n            return dispatch(orderCreationEnd());\n        }\n    } catch (err) {\n        console.error(err);\n\n        alert('Не удалось получить информацию о текущем пользователе');\n\n        return dispatch(orderCreationEnd());\n    }\n\n    let response: CreateOrderResponse;\n\n    try {\n        response = await createOrderAPI(\n            {\n                eventId: event.id,\n                amount: 1,\n            },\n            jwtToken\n        );\n\n        const metrikaParams = {\n            order_id: response.id,\n            price: response.cost,\n            price_without_discount: response.cost,\n        };\n\n        reachGoal(MetrikaGoals.OrderInitiated, metrikaParams);\n        await reportGoalReached(MetrikaGoals.OrderInitiated, metrikaParams);\n\n        dispatch(orderCreationSuccess(response));\n\n        onOrderCreated();\n    } catch (err) {\n        dispatch(orderCreationEnd());\n\n        if (err.status === 401 && retry) {\n            return dispatch(authenticate(() => dispatch(createOrder(event, onOrderCreated, false))));\n        }\n    }\n};\n\nexport const buyTicket = (event: Event, userInfo: UserInfo): AppThunk => async(\n    dispatch,\n    getState\n) => {\n    const { currentUser, jwtToken, psuid } = getState().user;\n    const { activeOrder } = getState().order.data;\n\n    dispatch(paymentStart());\n\n    try {\n        const currentUserId = await getCurrentUserId();\n\n        if (!jwtToken || !psuid || !currentUserId) {\n            await dispatch(authenticate(() => dispatch(buyTicket(event, userInfo))));\n\n            return dispatch(paymentEnd());\n        }\n    } catch (err) {\n        console.error(err);\n\n        alert('Не удалось получить информацию о текущем пользователе');\n\n        return dispatch(paymentEnd());\n    }\n\n    if (orderCreationInProgressSelector(getState())) {\n        throw new Error('Payment is not available. Order creating now');\n    }\n\n    // Если нет активного заказа, сначала создаем его\n    if (!activeOrder) {\n        return dispatch(createOrder(event, () => buyTicket(event, userInfo)));\n    }\n\n    logProductAdd(event);\n\n    const metrikaParams: MetrikaOrderParams = {\n        order_id: activeOrder.id,\n        price: activeOrder.cost,\n        price_without_discount: activeOrder.cost,\n    };\n\n    try {\n        await processNativePayment(activeOrder, currentUser);\n\n        const { pushToken } = (await fetchPushToken(activeOrder.paymentToken)) ?? {};\n        saveUserInfoAPI({ userInfo, paymentId: activeOrder.id, pushToken }, jwtToken)\n            .catch((error: Error) => console.error(error));\n\n        reachGoal(MetrikaGoals.OrderCompleted, metrikaParams);\n        logProductPurchase(event, activeOrder.id);\n        await reportGoalReached(MetrikaGoals.OrderCompleted, metrikaParams);\n\n        dispatch(checkoutEnd());\n    } catch (err) {\n        console.error(err);\n\n        reachGoal(MetrikaGoals.OrderError, metrikaParams);\n\n        switch (err.message) {\n            case PaymentError.Shown:\n            case PaymentError.Cancelled:\n                return;\n            case PaymentError.NotSupported:\n                return alert('Платежи не поддерживаются в текущей версии браузера');\n            default:\n                alert('Произошла ошибка при покупке билета. Попробуйте ещё раз');\n        }\n    } finally {\n        dispatch(paymentEnd());\n        dispatch(fetchOrders());\n    }\n};\n\nasync function fetchPushToken(paymentToken: string) {\n    let pushToken: YandexTransactionPushToken | null = null;\n\n    try {\n        pushToken = await getTransactionPushToken(paymentToken);\n    } catch (error) {\n        console.error(error);\n    }\n\n    return pushToken;\n}\n\nconst persistConfig = getPersistConfig<Order>('order', {\n    transforms: [getTransformUIPersistance<Order['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, order.reducer);\n","import { lazy } from 'react';\n\ntype LazyDeferred = typeof lazy;\n\n// Минимальное время перед импортом, чтобы дать отрисоваться скелетону\nconst LAZY_DEFFERED_SLEEP = 50;\n// Минимальное время импорта компонента\nconst LAZY_DEFFERED_DELAY = 500;\n\nexport const lazyDeferred: LazyDeferred = importCallback => {\n    type LazyImportType = ReturnType<typeof importCallback>;\n\n    return lazy(() =>\n        Promise.all<LazyImportType, void>([\n            new Promise<LazyImportType>(resolve => setTimeout(() => resolve(importCallback()), LAZY_DEFFERED_SLEEP)),\n            new Promise<void>(resolve => setTimeout(resolve, LAZY_DEFFERED_DELAY)),\n        ]).then(([module]) => module)\n    );\n};\n","const CLIENT_ID = '9e445c9aacec4266bf265302facb8293';\n\nexport type UserInfo = {\n    uid?: number;\n    login?: string;\n    avatar_id?: string; //eslint-disable-line camelcase\n    email?: string;\n    name?: string;\n    display_name?: string; //eslint-disable-line camelcase\n}\n\nexport type PSUIDPayload = {\n    psuid: string;\n}\n\nexport type JWTPayload = {\n    iss: string;\n    iat: number;\n    jti: string;\n    exp: number;\n}\n\nexport type YandexAuthPayload = JWTPayload & PSUIDPayload & UserInfo;\n\nexport type YandexAuthUserInfo = {\n    jwtToken: string;\n    payload: YandexAuthPayload;\n}\n\nexport type YandexAuthPSUIDInfo = {\n    jwtToken: string;\n    payload: JWTPayload & PSUIDPayload;\n}\n\nexport enum YandexAuthScope {\n    Avatar = 'login:avatar',\n    Info = 'login:info',\n    Email = 'login:email',\n}\n\nexport type YandexAuthInfo = {\n    tokenInfo: {\n        authToken: string;\n        authorizedScopes: YandexAuthScope[];\n    };\n    userInfo: YandexAuthUserInfo;\n}\n\nexport type YandexAuthApiInfo = {\n    tokenInfo: {\n        authToken: string;\n        authorizedScopes: DOMStringList;\n    };\n    userInfo: YandexAuthUserInfo;\n}\n\nexport async function identify(): Promise<YandexAuthPSUIDInfo> {\n    return window.yandex.app.auth.identify(CLIENT_ID);\n}\n\nexport async function getCurrentUserId(): Promise<YandexAuthPSUIDInfo | null> {\n    return window.yandex.app.auth.getCurrentUserId(CLIENT_ID);\n}\n\nexport async function authorizeScopes(scopes?: YandexAuthScope[]): Promise<YandexAuthInfo> {\n    const rawData = await window.yandex.app.auth.authorize(CLIENT_ID, scopes);\n\n    return {\n        ...rawData,\n        tokenInfo: {\n            ...rawData.tokenInfo,\n            authorizedScopes: Array.from(rawData.tokenInfo.authorizedScopes) as YandexAuthScope[]\n        }\n    };\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"screen\":\"styles_screen__3Xc2f\",\"hidden\":\"styles_hidden__319gL\",\"screenEnter\":\"styles_screenEnter__1cDTX\",\"screenEnterActive\":\"styles_screenEnterActive__3Aipd\",\"screenExit\":\"styles_screenExit__16_m_\",\"screenExitActive\":\"styles_screenExitActive__9q_ED\",\"offset\":\"styles_offset__3ZkO6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__2fC7e\",\"image\":\"styles_image__2rNd-\",\"content\":\"styles_content__3r_Ib\",\"right\":\"styles_right__39u8P\",\"short\":\"styles_short__5IaPF\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"modal\":\"style_modal__ArKGM\",\"content\":\"style_content__36rzf\",\"hidden\":\"style_hidden__153Qs\",\"visible\":\"style_visible__2ITxB\",\"body\":\"style_body__3TOLT\",\"profile\":\"style_profile__4Kle_\",\"psuid\":\"style_psuid__32HpM\",\"logout\":\"style_logout__1unjr\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"styles_wrapper__1LBcn\",\"wrapper_loading\":\"styles_wrapper_loading__3wiy0\",\"wrapper-visible_yes\":\"styles_wrapper-visible_yes__1gZE6\",\"slideUp\":\"styles_slideUp__ugjBN\",\"wrapper-visible_no\":\"styles_wrapper-visible_no__3CTrI\",\"slideDown\":\"styles_slideDown__1-rC7\",\"title\":\"styles_title__2H0i0\",\"auto-select-box\":\"styles_auto-select-box__1KSTl\",\"selected\":\"styles_selected__3i7jO\",\"selected-city-label\":\"styles_selected-city-label__107bE\",\"selected-city-name\":\"styles_selected-city-name__3y9wk\",\"button\":\"styles_button__32WSn\"};","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { getPersistConfig } from '../helpers/persist';\n\nimport { MenuTag } from '../../lib/api/fragments/city';\n\nexport type Menu = {\n    visible: boolean;\n    items: Array<MenuTag>;\n    activeItem: MenuTag['code'];\n};\n\nconst initialState: Menu = {\n    visible: false,\n    items: [],\n    activeItem: '',\n};\n\nconst menu = createSlice({\n    name: 'menu',\n    initialState,\n    reducers: {\n        setItems(state, action: PayloadAction<MenuTag[]>) {\n            state.items = action.payload;\n        },\n        setVisible(state, action: PayloadAction<boolean>) {\n            state.visible = action.payload;\n        },\n    },\n});\n\nexport const { setItems, setVisible } = menu.actions;\n\nconst persistConfig = getPersistConfig<Menu>('menu');\nexport default persistReducer(persistConfig, menu.reducer);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"style_card__2T-VX\",\"title\":\"style_title__RuqCf\",\"annotation\":\"style_annotation__n8doS\",\"image-wrapper\":\"style_image-wrapper__3JJK-\",\"image-overlay\":\"style_image-overlay__29ffx\",\"image\":\"style_image__Lux1b\",\"preview\":\"style_preview__3loTl\"};","import React, { ComponentType } from 'react';\n\nimport { DEFAULT_ITEMS_GAP } from '../constants';\n\nimport styles from './styles.module.css';\n\ntype Props = {\n    count: number;\n    card: ComponentType;\n    itemsGap?: number;\n};\n\nconst EventsListSkeleton: React.FC<Props> = ({ itemsGap = DEFAULT_ITEMS_GAP, count, card: Card }) => (\n    <div className={styles.events} style={{ gridGap: `${itemsGap}px` }}>\n        {Array(count)\n            .fill(0)\n            .map((_, index) => (\n                <Card key={index} />\n            ))}\n    </div>\n);\n\nexport default EventsListSkeleton;\n","export const isIOS = (): boolean =>\n    (/iPad|iPhone|iPod/.test(navigator.platform) ||\n        /iPad|iPhone|iPod/.test(navigator.userAgent) ||\n        (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&\n    !window.MSStream;\n","import React, { memo, useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useHistory, Link } from 'react-router-dom';\n\nimport { setVisible as setMenuVisible } from '../../redux/slices/menu';\nimport { getMainPageUrl, getSearchUrl } from '../../lib/url-builder';\n\nimport BackwardButton from '../BackwardButton';\nimport ClearButton from '../ClearButton';\n\nimport styles from './styles.module.css';\n\nconst Logo: React.FC = () => (\n    <Link to={getMainPageUrl()} className={styles.logo}>\n        MiniApp Example\n    </Link>\n);\n\ntype IconProps = {\n    fill?: 'white' | 'black';\n};\n\nconst SuggestIcon: React.FC<IconProps> = ({ fill = 'black' }) => {\n    const className = [styles['suggest-icon'], styles[`icon-${fill}`]].join(' ');\n\n    return <span className={className} />;\n};\n\nfunction setMods(className: string, mods?: string) {\n    if (!mods) {\n        return styles[className];\n    }\n\n    return `${styles[className]} ${styles[`${className}_${mods}`]}`;\n}\n\nexport type Props = {\n    hasMenu?: boolean;\n    hasLogo?: boolean;\n    backward?: 'white' | 'black' | '';\n    mods?: 'clear' | '';\n    text?: string;\n};\n\nconst PageHeader: React.FC<Props> = props => {\n    const { hasMenu, hasLogo, backward, mods, text } = props;\n\n    const history = useHistory();\n    const dispatch = useDispatch();\n\n    const onSearchClick = useCallback(() => {\n        history.push(getSearchUrl());\n    }, [history]);\n\n    const onMenuClick = useCallback(() => {\n        dispatch(setMenuVisible(true));\n    }, [dispatch]);\n\n    return (\n        <header className={setMods('page-header', mods)}>\n            {Boolean(backward) && <BackwardButton className={styles['backward-button']} fill={backward || 'black'} />}\n            {Boolean(hasMenu) && (\n                <ClearButton className={styles['menu-button']} onClick={onMenuClick}>\n                    <span className={styles['burger-menu-icon']} />\n                </ClearButton>\n            )}\n            {hasLogo && <Logo />}\n            {text && <span className={styles.text}>{text}</span>}\n            <ClearButton className={styles['suggest-button']} onClick={onSearchClick}>\n                <SuggestIcon fill={mods ? 'white' : 'black'} />\n            </ClearButton>\n        </header>\n    );\n};\n\nexport default memo(PageHeader);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"list\":\"style_list__1E8sL\",\"item\":\"style_item__2Gtnq\",\"orders-text\":\"style_orders-text__2Hcw-\",\"link\":\"style_link__5kR7b\",\"active-item\":\"style_active-item__1n702\"};","import { createAction } from '@reduxjs/toolkit';\n\nexport const cleanup = createAction('cleanup');\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"feed\":\"styles_feed__RntQS\",\"title\":\"styles_title__2JRen\",\"events\":\"styles_events___mJxb\",\"item\":\"styles_item__2O9gA\"};","import { useContext, useMemo } from 'react';\n\nimport { StackNavigatorContext } from './context';\nimport { BackwardProps } from './StackNavigator';\n\nexport function useBackward(params?: BackwardProps) {\n    const onBackward = useContext(StackNavigatorContext).onBackward;\n\n    return useMemo(() => onBackward.bind(null, params), [onBackward, params]);\n}\n\nexport function useScreenVisible() {\n    return useContext(StackNavigatorContext).isVisible;\n}\n\nexport function useScreenRef() {\n    return useContext(StackNavigatorContext).ref;\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { fetchSelections } from '../../lib/api';\nimport { SelectionsResponse } from '../../lib/api/types';\nimport { EventPreview } from '../../lib/api/fragments/event-preview';\n\nimport {\n    createPersistKeyByFilter,\n    stateReconcilerByDate,\n    getPersistConfig,\n    getTransformUIPersistance,\n} from '../helpers/persist';\nimport { AppThunk, RootState } from '../index';\nimport { DateFilter } from './date-filter';\n\nexport type SelectionsState = {\n    data: {\n        [key: string]: {\n            items: Selection[];\n            updatedAt: number;\n        };\n    };\n    ui: {\n        [key: string]: {\n            isLoading: boolean;\n            isUpdating: boolean;\n        };\n    };\n};\n\nexport type Selection = {\n    code: string;\n    title: string;\n    count: number;\n    image: EventPreview['image'];\n};\n\nconst initialState: SelectionsState = {\n    data: {},\n    ui: {},\n};\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'selections',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = {\n                    items: [],\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = {\n                    isLoading: false,\n                    isUpdating: false,\n                };\n            }\n\n            if (!state.data[key].items.length) {\n                state.ui[key].isLoading = true;\n            } else {\n                state.ui[key].isUpdating = true;\n            }\n        },\n        fetchSuccess(state, action: PayloadAction<{ key: string; items: SelectionsResponse['selections'] }>) {\n            const { key, items } = action.payload;\n\n            const selections: Selection[] = [];\n\n            for (const selection of items) {\n                if (!selection) {\n                    continue;\n                }\n\n                selections.push({\n                    code: selection.code,\n                    title: selection.title,\n                    count: selection.count,\n                    image:\n                        selection.events &&\n                        selection.events[0] &&\n                        selection.events[0].eventPreview &&\n                        selection.events[0].eventPreview.image,\n                });\n            }\n\n            state.data[key].items = selections;\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError } = slice.actions;\n\nexport const selectionsSelector = (state: RootState) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.selections.data[persistKey];\n};\n\nexport const selectionsUISelector = (state: RootState) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.selections.ui[persistKey];\n};\n\nexport const loadSelections = (dateFilter: DateFilter, geoid: number): AppThunk => async(dispatch, getState) => {\n    const key = createPersistKeyByFilter({ geoid, ...dateFilter });\n    const selections = getState().selections.data[key];\n\n    if (selections && selections.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ key: key }));\n\n    try {\n        const data = await fetchSelections({ ...dateFilter, geoid });\n        dispatch(fetchSuccess({ key, items: data.selections }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ key: key, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<SelectionsState>('selections', {\n    stateReconciler: stateReconcilerByDate,\n    transforms: [getTransformUIPersistance<SelectionsState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","import { createRef, createContext, RefObject } from 'react';\n\ntype StackNavigatorContextType = {\n    onBackward: () => void;\n    isVisible: boolean;\n    ref: RefObject<HTMLDivElement>;\n};\n\nexport const StackNavigatorContext = createContext<StackNavigatorContextType>({\n    onBackward: () => {},\n    isVisible: false,\n    ref: createRef(),\n});\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__2krq5\",\"image\":\"styles_image__3rHyi\",\"right\":\"styles_right__3yAG9\",\"title\":\"styles_title__1qP6K\",\"description\":\"styles_description__2Ze_3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"styles_input__ldYiA\",\"wrapper\":\"styles_wrapper__1qFlf\",\"wrapper-visible_yes\":\"styles_wrapper-visible_yes__3Xlii\",\"slideUp\":\"styles_slideUp__2GPyJ\",\"wrapper-visible_no\":\"styles_wrapper-visible_no__2Kq0Z\",\"slideDown\":\"styles_slideDown__3yIqZ\",\"city-list\":\"styles_city-list__2FmDB\",\"city-item\":\"styles_city-item__TNmcc\"};","import React from 'react';\n\nimport styles from './styles.module.css';\n\nexport type Props = {\n    className?: string;\n    onClick: () => void;\n};\nconst ClearButton: React.FC<Props> = ({ className, children, onClick }) => {\n    const cls = [styles.clear, className].filter(Boolean).join(' ');\n    return (\n        <button className={cls} onClick={onClick}>\n            {children}\n        </button>\n    );\n};\n\nexport default ClearButton;\n","export const DEFAULT_ITEMS_GAP = 18;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__eFyRm\",\"image\":\"styles_image__1XdLR\",\"title\":\"styles_title__2aX7M\",\"description\":\"styles_description__hf2zy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__2ZLnU\",\"image\":\"styles_image__1OXdh\",\"stub\":\"styles_stub__2rGlh\",\"stub-hidden\":\"styles_stub-hidden__wNOO_\",\"fadeIn\":\"styles_fadeIn__Wb4n6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"styles_title__1IJnF\",\"events\":\"styles_events__3m_nB\",\"event\":\"styles_event__15ocv\",\"link\":\"styles_link__OwBgq\"};","import React, { useCallback, useState } from 'react';\n\nimport { MediaImageSize } from '../../lib/api/fragments/image-size';\n\nimport styles from './styles.module.css';\n\nconst emptyImage = 'data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=';\n\nexport type ImageProps = {\n    className?: string;\n    src?: MediaImageSize | null;\n    src2x?: MediaImageSize | null;\n    bgColor?: string | null;\n    alt?: string;\n};\n\nconst Image: React.FC<ImageProps> = props => {\n    const color = props.bgColor || '#555';\n    const [isLoaded, setLoaded] = useState(false);\n\n    const onLoad = useCallback(() => {\n        if (props.src) {\n            setLoaded(true);\n        }\n    }, [setLoaded, props.src]);\n    const stubClassNames = [styles.stub, isLoaded && styles['stub-hidden']].filter(Boolean).join(' ');\n    const containerClassNames = [props.className, styles.container].filter(Boolean).join(' ');\n\n    return (\n        <div className={containerClassNames}>\n            <img\n                className={styles.image}\n                onLoad={onLoad}\n                src={props.src ? props.src.url : emptyImage}\n                srcSet={props.src2x ? `${props.src2x.url} 2x` : undefined}\n                alt={props.alt}\n            />\n            <div className={stubClassNames} style={{ backgroundColor: color }} />\n        </div>\n    );\n};\n\nexport default Image;\n","import React from 'react';\n\nimport { Rect, Text } from '../../Skeletons';\n\nimport styles from './styles.module.css';\n\nconst EventCardSkeleton: React.FC = () => {\n    return (\n        <div className={styles.card}>\n            <Rect className={styles.image} />\n            <div className={styles.right}>\n                <Text className={styles.title} />\n                <Text className={styles.description} />\n            </div>\n        </div>\n    );\n};\n\nexport default EventCardSkeleton;\n","import React, { useMemo, useRef } from 'react';\n\nimport { StackNavigatorContext } from '../context';\nimport { Location, Params, ScreenComponent } from '../index';\n\nimport { isIOS } from '../../../lib/is-ios';\nimport styles from './styles.module.css';\n\nexport type ScreenType = {\n    id: string;\n    params: Params;\n    component: ScreenComponent;\n    location: Location;\n};\n\ntype Props = {\n    isVisible: boolean;\n    onBackward: () => void;\n    screen: ScreenType;\n    transitions?: boolean;\n};\n\nconst Screen: React.FC<Props> = ({ isVisible, transitions, screen, onBackward }) => {\n    const className = isIOS() ? '' : [styles.screen, !isVisible && !transitions && styles.hidden].filter(Boolean).join(' ');\n    const ref = useRef<HTMLDivElement>(null);\n\n    const context = useMemo(() => {\n        return {\n            onBackward,\n            isVisible,\n            ref,\n        };\n    }, [onBackward, isVisible, ref]);\n\n    return (\n        <StackNavigatorContext.Provider value={context}>\n            <div className={className} ref={ref}>\n                <screen.component params={screen.params} location={screen.location} />\n            </div>\n        </StackNavigatorContext.Provider>\n    );\n};\n\nexport default Screen;\n","import React, { useState, useEffect, useCallback } from 'react';\nimport { useLocation, matchPath, useHistory } from 'react-router-dom';\nimport { TransitionGroup, CSSTransition } from 'react-transition-group';\n\nimport { isIOS } from '../../lib/is-ios';\nimport Screen, { ScreenType } from './Screen';\nimport styles from './Screen/styles.module.css';\nimport { Screens, Params, ScreenConfig } from './index';\n\nconst classNames = {\n    enter: styles.screenEnter,\n    enterActive: styles.screenEnterActive,\n    exit: styles.screenExit,\n    exitActive: styles.screenExitActive,\n};\nconst transitionCallbacks = {\n    onEnter: (node: HTMLElement) => {\n        if (node.previousElementSibling) {\n            node.previousElementSibling.classList.add(styles.offset);\n        }\n    },\n\n    onExit: (node: HTMLElement) => {\n        if (node.previousElementSibling) {\n            node.previousElementSibling.classList.remove(styles.offset);\n        }\n    },\n};\nconst transitionTimeouts = {\n    enter: 600, // Сама анимация 300ms + поправка на медленные девайсы\n    exit: 500, // Сама анимация 250ms + поправка на медленные девайсы\n};\n\ntype ScreenStack = Array<ScreenType>;\n\ntype Props = {\n    screens: Screens;\n    maxDepth?: number;\n    transitions?: boolean;\n};\n\nexport type BackwardProps = { fallback?: string };\n\nconst StackNavigator: React.FC<Props> = ({ screens, maxDepth = 10, transitions = false }) => {\n    const [stack, setStack] = useState<ScreenStack>([]);\n    const location = useLocation();\n    const history = useHistory();\n    const iOS = isIOS();\n\n    useLocationChange(() => {\n        if (iOS) {\n            window.scrollTo(0, 0);\n        }\n\n        const isBackward = history.action === 'POP';\n        const isReplace = history.action === 'REPLACE';\n\n        // Если навигация «назад» и в стеке есть отрисованный предыдущий экран, то просто удаляем последний экран\n        if (isBackward && stack.length > 1) {\n            setStack(stack.slice(0, -1));\n            return;\n        }\n\n        let screen: ScreenConfig | null = null;\n        let match: ReturnType<typeof matchPath> = null;\n\n        for (const item of screens) {\n            match = matchPath(location.pathname, item);\n\n            if (match) {\n                screen = item;\n                break;\n            }\n        }\n\n        if (!screen || !match) {\n            console.warn('No screen matched for route', location.pathname);\n            return;\n        }\n\n        const newStackItem: ScreenStack[0] = {\n            id: location.key || Date.now().toString(),\n            component: screen.component,\n            params: match.params as Params,\n            location: { ...location },\n        };\n\n        // Если навигация «назад», то просто заменяем единственный экран в стеке\n        if (isBackward && stack.length === 1) {\n            setStack([newStackItem]);\n            return;\n        }\n\n        // Если делается замена текущего урла, то просто перерисовываем текущий экран\n        if (isReplace) {\n            if (screen.component === stack[stack.length - 1].component) {\n                const newStack = [...stack];\n\n                newStack[stack.length - 1] = {\n                    ...newStack[stack.length - 1],\n                    params: newStackItem.params,\n                    location: newStackItem.location,\n                };\n\n                setStack(newStack);\n            } else {\n                setStack([...stack.slice(0, -1), newStackItem]);\n            }\n            return;\n        }\n\n        // Навигация «вперед», добавляем новый экран в стек\n        const newStack = [...stack, newStackItem];\n\n        // При достижении лимита количенства одновременно отрисованных экранов начинаем удалять старые экраны\n        if (newStack.length > maxDepth) {\n            newStack.splice(0, stack.length - maxDepth + 1);\n        }\n\n        setStack(newStack);\n    });\n\n    const onBackward = useCallback(\n        ({ fallback }: BackwardProps = {}) => {\n            if (iOS) {\n                window.scrollTo(0, 0);\n            }\n\n            if (history.length > 1) {\n                history.goBack();\n            } else if (fallback) {\n                history.replace(fallback);\n            }\n        },\n        [history, iOS]\n    );\n\n    if (transitions && !iOS) {\n        return (\n            <TransitionGroup component={null}>\n                {stack.map((screen, index) => {\n                    return (\n                        <CSSTransition\n                            key={screen.id}\n                            timeout={transitionTimeouts}\n                            classNames={classNames}\n                            enter={stack.length !== 1}\n                            exit={stack.length !== 1}\n                            onEnter={transitionCallbacks.onEnter}\n                            onExit={transitionCallbacks.onExit}\n                        >\n                            <Screen\n                                key={screen.id}\n                                isVisible={index === stack.length - 1}\n                                transitions\n                                onBackward={onBackward}\n                                screen={screen}\n                            />\n                        </CSSTransition>\n                    );\n                })}\n            </TransitionGroup>\n        );\n    }\n\n    if (iOS) {\n        const screen = stack[stack.length - 1];\n\n        return screen ? <Screen isVisible onBackward={onBackward} screen={screen} /> : null;\n    }\n\n    return (\n        <>\n            {stack.map((screen, index) => {\n                return (\n                    <Screen\n                        key={screen.id}\n                        isVisible={index === stack.length - 1}\n                        onBackward={onBackward}\n                        screen={screen}\n                    />\n                );\n            })}\n        </>\n    );\n};\n\n// Хак с useEffect, который вызывается только при изменении Location\n// Позволяет обойти линтинг зависимостией в хуке useEffect\nfunction useLocationChange(callback: () => void) {\n    const location = useLocation();\n\n    useEffect(callback, [location]);\n}\n\nexport default StackNavigator;\n","import React from 'react';\nimport { RouteProps, useLocation } from 'react-router-dom';\n\nimport { isIOS } from '../../lib/is-ios';\nimport StackNavigator from './StackNavigator';\n\nexport { useBackward, useScreenRef, useScreenVisible } from './hooks';\n\nexport type Params = Record<string, string>;\nexport type Location = ReturnType<typeof useLocation>;\n\nexport type ScreenProps = {\n    params: Params;\n    location: Location;\n};\n\nexport type ScreenComponent = React.FC<ScreenProps>;\n\nexport type ScreenConfig = RouteProps & {\n    component: ScreenComponent;\n};\n\nexport type Screens = ScreenConfig[];\nexport type Options = {\n    maxDepth?: number;\n    transitions?: boolean;\n};\n\nexport function createStackNavigator(screens: Screens, options: Options = {}) {\n    if (isIOS() && 'scrollRestoration' in window.history) {\n        window.history.scrollRestoration = 'manual';\n    }\n\n    return () => <StackNavigator screens={screens} maxDepth={options.maxDepth} transitions={options.transitions} />;\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { ActualEvent } from '../../lib/api/fragments/actual-event';\n\nimport { fetchActualEvents } from '../../lib/api';\nimport {\n    createPersistKeyByFilter,\n    stateReconcilerByDate,\n    getPersistConfig,\n    getTransformUIPersistance,\n} from '../helpers/persist';\nimport { setEvents } from './event';\nimport { DateFilter } from './date-filter';\nimport { AppThunk, RootState } from '..';\n\nexport type ActualEventsListState = {\n    data: {\n        [key: string]: {\n            items: Array<ActualEvent | null>;\n            updatedAt: number;\n        };\n    };\n    ui: {\n        [key: string]: {\n            isLoading: boolean;\n            isUpdating: boolean;\n        };\n    };\n};\n\nconst initialState: ActualEventsListState = {\n    data: {},\n    ui: {},\n};\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'actual-events',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = {\n                    items: [],\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = {\n                    isLoading: false,\n                    isUpdating: false,\n                };\n            }\n\n            if (!state.data[key].items.length) {\n                state.ui[key].isLoading = true;\n            } else {\n                state.ui[key].isUpdating = true;\n            }\n        },\n        fetchSuccess(state, action: PayloadAction<{ key: string; items: Array<ActualEvent | null> }>) {\n            const { key, items } = action.payload;\n\n            state.data[key].items = items;\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError } = slice.actions;\n\nexport const actualEventsSelector = (state: RootState) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.actualEvents.data[persistKey];\n};\n\nexport const actualEventsUISelector = (state: RootState) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.actualEvents.ui[persistKey];\n};\n\nexport const loadActualEvents = (dateFilter: DateFilter, geoid: number): AppThunk => async(dispatch, getState) => {\n    const key = createPersistKeyByFilter({ geoid, ...dateFilter });\n    const events = getState().actualEvents.data[key];\n\n    if (events && events.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ key }));\n\n    try {\n        const { events } = await fetchActualEvents({ ...dateFilter, geoid });\n\n        if (events.prefetchItems) {\n            dispatch(setEvents({ events: events.prefetchItems }));\n            delete events.prefetchItems;\n        }\n\n        dispatch(fetchSuccess({ key, items: events.items }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ key, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<ActualEventsListState>('actual-events', {\n    stateReconciler: stateReconcilerByDate,\n    transforms: [getTransformUIPersistance<ActualEventsListState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { ActualEvents } from '../../lib/api/fragments/actual-events';\n\nimport { fetchRubricEvents } from '../../lib/api';\nimport {\n    createPersistKeyByFilter,\n    stateReconcilerByDate,\n    getPersistConfig,\n    getTransformUIPersistance,\n} from '../helpers/persist';\n\nimport { AppThunk, RootState } from '../index';\nimport { setEvents } from './event';\nimport { DateFilter } from './date-filter';\n\nexport type RubricEventsState = {\n    data: {\n        [key: string]: {\n            title: string;\n            events: ActualEvents;\n            hasMoreItems: boolean;\n            updatedAt: number;\n        };\n    };\n    ui: {\n        [key: string]: {\n            isLoading: boolean;\n            isLoadingMore: boolean;\n            isUpdating: boolean;\n        };\n    };\n};\n\nconst initialState: RubricEventsState = {\n    data: {},\n    ui: {},\n};\n\nconst loadMoreLimit = 10;\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'rubric-events',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = {\n                    title: '',\n                    events: {\n                        items: [],\n                        paging: { offset: 0, total: 0 },\n                    },\n                    hasMoreItems: false,\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = {\n                    isLoading: false,\n                    isLoadingMore: false,\n                    isUpdating: false,\n                };\n            }\n\n            if (!state.data[key].events.items.length) {\n                state.ui[key].isLoading = true;\n            } else {\n                state.ui[key].isUpdating = true;\n            }\n        },\n        fetchSuccess(state, action: PayloadAction<{ key: string; events: ActualEvents; title: string }>) {\n            const { key, events, title } = action.payload;\n\n            state.data[key].title = title;\n            state.data[key].events = events;\n            state.data[key].hasMoreItems = Boolean(events.paging.total > events.paging.offset + loadMoreLimit);\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchMoreStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoadingMore = true;\n        },\n        fetchMoreSuccess(state, action: PayloadAction<{ key: string; events: ActualEvents }>) {\n            const { key, events } = action.payload;\n\n            state.data[key].events.items.push(...events.items);\n            state.data[key].events.paging = events.paging;\n            state.data[key].hasMoreItems = Boolean(events.paging.total > events.paging.offset + loadMoreLimit);\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoadingMore = false;\n        },\n        fetchMoreError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoadingMore = false;\n        },\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError, fetchMoreStart, fetchMoreSuccess, fetchMoreError } = slice.actions;\n\nexport const rubricEventsSelector = (code: string) => (state: RootState) => {\n    const persistKey = createPersistKeyByFilter({\n        code,\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.rubricEvents.data[persistKey];\n};\n\nexport const rubricEventsUISelector = (code: string) => (state: RootState) => {\n    const persistKey = createPersistKeyByFilter({\n        code,\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.rubricEvents.ui[persistKey];\n};\n\nexport const loadRubricEvents = (code: string, dateFilter?: DateFilter): AppThunk => async(dispatch, getState) => {\n    const { geoid } = getState().city.currentCity;\n    const key = createPersistKeyByFilter({ geoid, code, ...dateFilter });\n    const events = getState().rubricEvents.data[key];\n\n    if (events && events.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ key }));\n\n    try {\n        const { title, events } = await fetchRubricEvents(code, {\n            geoid,\n            offset: 0,\n            limit: loadMoreLimit,\n            ...dateFilter,\n        });\n\n        if (events.prefetchItems) {\n            dispatch(setEvents({ events: events.prefetchItems }));\n            delete events.prefetchItems;\n        }\n\n        dispatch(fetchSuccess({ key, title, events }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ key, error: err }));\n    }\n};\n\nexport const loadMoreRubricEvents = (code: string, dateFilter?: DateFilter): AppThunk => async(dispatch, getState) => {\n    const { geoid } = getState().city.currentCity;\n    const key = createPersistKeyByFilter({ geoid, code, ...dateFilter });\n\n    dispatch(fetchMoreStart({ key }));\n\n    try {\n        const { offset } = getState().rubricEvents.data[key].events.paging;\n        const { events } = await fetchRubricEvents(code, {\n            geoid,\n            offset: offset + loadMoreLimit,\n            limit: loadMoreLimit,\n            ...dateFilter,\n        });\n\n        if (events.prefetchItems) {\n            dispatch(setEvents({ events: events.prefetchItems }));\n            delete events.prefetchItems;\n        }\n\n        dispatch(fetchMoreSuccess({ key, events }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchMoreError({ key, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<RubricEventsState>('rubric-events', {\n    stateReconciler: stateReconcilerByDate,\n    transforms: [getTransformUIPersistance<RubricEventsState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { fetchSelectionEvents } from '../../lib/api';\nimport { SelectionsResponse } from '../../lib/api/types';\nimport { ActualEvents } from '../../lib/api/fragments/actual-events';\n\nimport {\n    createPersistKeyByFilter,\n    restoreFilterFromPersistKey,\n    stateReconcilerByDate,\n    getPersistConfig,\n    getTransformUIPersistance,\n} from '../helpers/persist';\n\nimport { AppThunk, RootState } from '../index';\nimport { setEvents } from './event';\nimport { DateFilter } from './date-filter';\nimport { fetchSuccess as selectionsFetchSuccess } from './selections';\n\nexport type SelectionEventsState = {\n    data: {\n        [key: string]: {\n            title: string;\n            events: ActualEvents;\n            hasMoreItems: boolean;\n\n            updatedAt: number;\n        };\n    };\n    ui: { [key: string]: { isLoading: boolean; isLoadingMore: boolean; isUpdating: boolean } };\n};\n\nconst initialState: SelectionEventsState = {\n    data: {},\n    ui: {},\n};\n\nconst loadMoreLimit = 10;\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'selection-events',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = {\n                    title: '',\n                    events: {\n                        items: [],\n                        paging: { offset: 0, total: 0 },\n                    },\n                    hasMoreItems: false,\n\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = {\n                    isLoading: false,\n                    isLoadingMore: false,\n                    isUpdating: false,\n                };\n            }\n\n            if (!state.data[key].events.items.length) {\n                state.ui[key].isLoading = true;\n            } else {\n                state.ui[key].isUpdating = true;\n            }\n        },\n        fetchSuccess(state, action: PayloadAction<{ key: string; events: ActualEvents; title: string }>) {\n            const { key, events, title } = action.payload;\n\n            state.data[key].title = title;\n            state.data[key].events = events;\n            state.data[key].hasMoreItems = Boolean(events.paging.total > events.paging.offset + loadMoreLimit);\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchMoreStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = {\n                    title: '',\n                    events: {\n                        items: [],\n                        paging: { offset: 0, total: 0 },\n                    },\n                    hasMoreItems: false,\n\n                    updatedAt: 0,\n                };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = {\n                    isLoading: false,\n                    isLoadingMore: false,\n                    isUpdating: false,\n                };\n            }\n\n            state.ui[key].isLoadingMore = true;\n        },\n        fetchMoreSuccess(state, action: PayloadAction<{ key: string; events: ActualEvents }>) {\n            const { key, events } = action.payload;\n\n            state.data[key].events.items.push(...events.items);\n            state.data[key].events.paging = events.paging;\n            state.data[key].hasMoreItems = Boolean(events.paging.total > events.paging.offset + loadMoreLimit);\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoadingMore = false;\n        },\n        fetchMoreError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoadingMore = false;\n        },\n    },\n    extraReducers: builder => {\n        // Предзаполнение списка событий для всех подборок, загруженных на главной странице\n        builder.addCase(\n            selectionsFetchSuccess,\n            (state, action: PayloadAction<{ key: string; items: SelectionsResponse['selections'] }>) => {\n                const { key, items } = action.payload;\n                const filter = restoreFilterFromPersistKey(key);\n\n                for (const selection of items) {\n                    if (!selection) {\n                        continue;\n                    }\n\n                    const eventsKey = createPersistKeyByFilter({ code: selection.code, ...filter });\n                    const events = {\n                        items: selection.events,\n                        paging: { offset: 0, total: selection.count },\n                    };\n\n                    if (!state.data[eventsKey]) {\n                        state.data[eventsKey] = {\n                            title: selection.title,\n                            events,\n                            hasMoreItems: Boolean(selection.count > loadMoreLimit),\n                            // При переходе в подборку нужно обновить заголовок, поэтому считаем что данные не загружены\n                            updatedAt: 0,\n                        };\n                        state.ui[eventsKey] = {\n                            isLoading: false,\n                            isLoadingMore: false,\n                            isUpdating: false,\n                        };\n                    } else {\n                        state.data[eventsKey].events = events;\n                        state.data[eventsKey].hasMoreItems = Boolean(selection.count > loadMoreLimit);\n                        state.data[eventsKey].updatedAt = Date.now();\n                    }\n                }\n            }\n        );\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError, fetchMoreStart, fetchMoreSuccess, fetchMoreError } = slice.actions;\n\nexport const selectionEventsSelector = (code: string) => (state: RootState) => {\n    const persistKey = createPersistKeyByFilter({\n        code,\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.selectionEvents.data[persistKey];\n};\n\nexport const selectionEventsUISelector = (code: string) => (state: RootState) => {\n    const persistKey = createPersistKeyByFilter({\n        code,\n        geoid: state.city.currentCity.geoid,\n        ...state.dateFilter,\n    });\n\n    return state.selectionEvents.ui[persistKey];\n};\n\nexport const loadSelectionEvents = (code: string, dateFilter?: DateFilter): AppThunk => async(dispatch, getState) => {\n    const { geoid } = getState().city.currentCity;\n    const key = createPersistKeyByFilter({ geoid, code, ...dateFilter });\n    const events = getState().selectionEvents.data[key];\n\n    if (events && events.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ key }));\n\n    try {\n        const { title, events } = await fetchSelectionEvents(code, {\n            geoid,\n            offset: 0,\n            limit: loadMoreLimit,\n            ...dateFilter,\n        });\n\n        if (events.prefetchItems) {\n            dispatch(setEvents({ events: events.prefetchItems }));\n            delete events.prefetchItems;\n        }\n\n        dispatch(fetchSuccess({ key, title, events }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ key, error: err }));\n    }\n};\n\nexport const loadMoreSelectionEvents = (code: string, dateFilter?: DateFilter): AppThunk => async(\n    dispatch,\n    getState\n) => {\n    const { geoid } = getState().city.currentCity;\n    const key = createPersistKeyByFilter({ geoid, code, ...dateFilter });\n\n    dispatch(fetchMoreStart({ key }));\n\n    try {\n        const { offset } = getState().selectionEvents.data[key].events.paging;\n        const { events } = await fetchSelectionEvents(code, {\n            geoid,\n            offset: offset + loadMoreLimit,\n            limit: loadMoreLimit,\n            ...dateFilter,\n        });\n\n        if (events.prefetchItems) {\n            dispatch(setEvents({ events: events.prefetchItems }));\n            delete events.prefetchItems;\n        }\n\n        dispatch(fetchMoreSuccess({ key, events }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchMoreError({ key, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<SelectionEventsState>('selection-events', {\n    stateReconciler: stateReconcilerByDate,\n    transforms: [getTransformUIPersistance<SelectionEventsState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { ActualEvents } from '../../lib/api/fragments/actual-events';\n\nimport { fetchRecommendedEvents } from '../../lib/api';\nimport {\n    createPersistKeyByFilter,\n    stateReconcilerByDate,\n    getPersistConfig,\n    getTransformUIPersistance,\n} from '../helpers/persist';\nimport { setEvents } from './event';\nimport { AppThunk, RootState } from '..';\n\nexport type RecommendedEvents = {\n    top?: ActualEvents;\n    concert?: ActualEvents;\n    cinema?: ActualEvents;\n    theatre?: ActualEvents;\n    updatedAt: number;\n};\nexport type RecommendedEventsState = {\n    data: { [key: string]: RecommendedEvents };\n    ui: { [key: string]: { isLoading: boolean; isUpdating: boolean } };\n};\n\nconst initialState: RecommendedEventsState = {\n    data: {},\n    ui: {},\n};\nconst updateInterval = 300 * 1000;\n\nconst slice = createSlice({\n    name: 'recommended-events',\n    initialState,\n    reducers: {\n        fetchStart(state, action: PayloadAction<{ key: string }>) {\n            const { key } = action.payload;\n\n            if (!state.data[key]) {\n                state.data[key] = { updatedAt: 0 };\n            }\n            if (!state.ui[key]) {\n                state.ui[key] = { isLoading: false, isUpdating: false };\n            }\n\n            if (!state.data[key].updatedAt) {\n                state.ui[key].isLoading = true;\n            } else {\n                state.ui[key].isUpdating = true;\n            }\n        },\n        fetchSuccess(\n            state,\n            action: PayloadAction<{\n                key: string;\n                data: Pick<RecommendedEvents, 'top' | 'concert' | 'cinema' | 'theatre'>;\n            }>\n        ) {\n            const { key, data } = action.payload;\n\n            state.data[key].top = data.top;\n            state.data[key].concert = data.concert;\n            state.data[key].cinema = data.cinema;\n            state.data[key].theatre = data.theatre;\n            state.data[key].updatedAt = Date.now();\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n        fetchError(state, action: PayloadAction<{ key: string; error: Error }>) {\n            const { key } = action.payload;\n\n            state.ui[key].isLoading = false;\n            state.ui[key].isUpdating = false;\n        },\n    },\n});\n\nexport const { fetchStart, fetchSuccess, fetchError } = slice.actions;\n\nexport const recommendedEventsSelector = (state: RootState) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n    });\n\n    return state.recommendedEvents.data[persistKey];\n};\n\nexport const recommendedEventsUISelector = (state: RootState) => {\n    const persistKey = createPersistKeyByFilter({\n        geoid: state.city.currentCity.geoid,\n    });\n\n    return state.recommendedEvents.ui[persistKey];\n};\n\nexport const loadRecommendedEvents = (): AppThunk => async(dispatch, getState) => {\n    const { geoid } = getState().city.currentCity;\n    const key = createPersistKeyByFilter({ geoid });\n    const events = getState().recommendedEvents.data[key];\n\n    if (events && events.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchStart({ key }));\n\n    try {\n        const data = await fetchRecommendedEvents({ geoid });\n\n        dispatch(\n            setEvents({\n                events: [\n                    ...(data.top?.prefetchItems || []),\n                    ...(data.cinema?.prefetchItems || []),\n                    ...(data.concert?.prefetchItems || []),\n                    ...(data.theatre?.prefetchItems || []),\n                ],\n            })\n        );\n\n        if (data.top?.prefetchItems) delete data.top.prefetchItems;\n        if (data.cinema?.prefetchItems) delete data.cinema.prefetchItems;\n        if (data.concert?.prefetchItems) delete data.concert.prefetchItems;\n        if (data.theatre?.prefetchItems) delete data.theatre.prefetchItems;\n\n        dispatch(fetchSuccess({ key, data }));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchError({ key, error: err }));\n    }\n};\n\nconst persistConfig = getPersistConfig<RecommendedEventsState>('recommended-events', {\n    stateReconciler: stateReconcilerByDate,\n    transforms: [getTransformUIPersistance<RecommendedEventsState['ui']>(initialState.ui)],\n});\nexport default persistReducer(persistConfig, slice.reducer);\n","import React, { forwardRef } from 'react';\n\nimport styles from './styles.module.css';\n\ntype Props = JSX.IntrinsicElements['input'];\nconst TextInput = forwardRef<HTMLInputElement, Props>(({ className, type, ...props }, ref) => {\n    const cls = [styles.input, className].filter(Boolean).join(' ');\n\n    return <input ref={ref} type={type || 'text'} className={cls} {...props} />;\n});\n\nexport default TextInput;\n","const GEOLOCATIONS_OPTIONS = {\n    timeout: 10000,\n    maximumAge: 60 * 60 * 1000,\n};\n\nexport async function getCurrentPosition(): Promise<Coordinates> {\n    return new Promise((resolve, reject) => {\n        const resolveCallback = (position: Position) => resolve(position.coords);\n\n        window.navigator.geolocation.getCurrentPosition(resolveCallback, reject, GEOLOCATIONS_OPTIONS);\n    });\n}\n\nfunction deg2rad(deg: number) {\n    return deg * (Math.PI / 180);\n}\n\n// http://en.wikipedia.org/wiki/Haversine_formula\nexport function getDistanceBetweenPoints(lat1: number, lon1: number, lat2: number, lon2: number): number {\n    const R = 6371; // Радиус земли в КМ\n\n    const tmp =\n        Math.sin(deg2rad(lat2 - lat1) / 2) * Math.sin(deg2rad(lat2 - lat1) / 2) +\n        Math.cos(deg2rad(lat1)) *\n            Math.cos(deg2rad(lat2)) *\n            Math.sin(deg2rad(lon2 - lon1) / 2) *\n            Math.sin(deg2rad(lon2 - lon1) / 2);\n\n    return 2 * R * Math.asin(Math.sqrt(tmp));\n}\n","import React from 'react';\n\nimport Button from '../ClearButton';\nimport { useBackward } from '../StackNavigator/hooks';\n\nimport styles from './styles.module.css';\n\ntype Props = {\n    fill?: 'white' | 'black';\n    className?: string;\n};\n\nconst BackwardIcon: React.FC<Props> = ({ fill = 'white' }) => {\n    const classNames = [styles['backward-icon'], styles[`icon-${fill}`]].join(' ');\n\n    return <span className={classNames} />;\n};\n\nconst Backward: React.FC<Props> = props => {\n    const onClick = useBackward();\n\n    return (\n        <Button className={[styles['backward-button'], props.className].filter(Boolean).join(' ')} onClick={onClick}>\n            <BackwardIcon fill={props.fill} />\n        </Button>\n    );\n};\n\nexport default Backward;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"backward-icon\":\"styles_backward-icon__3EK-Q\",\"icon-white\":\"styles_icon-white__30Xrl\",\"icon-black\":\"styles_icon-black__1FNaZ\",\"backward-button\":\"styles_backward-button__d5kZC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"styles_content__2Cnjx\",\"title\":\"styles_title__XAM43\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__2LqZR\",\"image\":\"styles_image__9Aiab\",\"username\":\"styles_username__MPrq4\"};","import { Event } from '../api/fragments/event';\n\nimport { CurrencyCode } from './types';\n\nfunction getProductFromEvent(event: Event) {\n    const price = event.tickets?.[0]?.price?.min;\n\n    return {\n        id: event.id,\n        name: event.title,\n        category: event.type.name,\n        price: price ? price / 100 : undefined\n    };\n}\n\nfunction getEventCurrency(event: Event) {\n    return event.tickets?.[0]?.price?.currency.toUpperCase() as CurrencyCode | undefined;\n}\n\nexport function logProductView(event: Event) {\n    window.dataLayer.push({\n        ecommerce: {\n            currencyCode: getEventCurrency(event),\n            detail: {\n                products: [getProductFromEvent(event)]\n            }\n        }\n    });\n}\n\nexport function logProductAdd(event: Event) {\n    window.dataLayer.push({\n        ecommerce: {\n            currencyCode: getEventCurrency(event),\n            add: {\n                products: [getProductFromEvent(event)]\n            }\n        }\n    });\n}\n\nexport function logProductPurchase(event: Event, orderId: number) {\n    window.dataLayer.push({\n        ecommerce: {\n            currencyCode: getEventCurrency(event),\n            purchase: {\n                actionField: {\n                    id: orderId.toString(),\n                },\n                products: [getProductFromEvent(event)]\n            }\n        }\n    });\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"loading\":\"styles_loading__l2xXc\",\"rect\":\"styles_rect__39Mf0\",\"text\":\"styles_text__O_35F\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"styles_block__fQZVR\",\"filter\":\"styles_filter__2Vym1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"styles_block__10trK\",\"item\":\"styles_item__2uVU7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"styles_content__3nFVw\",\"title\":\"styles_title__2inpl\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"list\":\"style_list__3pVg_\",\"wrapper\":\"style_wrapper__IWliN\",\"button\":\"style_button__2GIxG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"price\":\"styles_price__1D8ax\",\"left\":\"styles_left__3RisO\",\"right\":\"styles_right__3KXqq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"styles_title__3XLML\",\"notFound\":\"styles_notFound__2R52E\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"styles_title__3xg9O\",\"event\":\"styles_event__3FTWc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"styles_header__2L4R0\",\"content\":\"styles_content__1NmrT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"styles_container__2CjIh\",\"button\":\"styles_button__1zNzf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"styles_wrapper__15WSd\",\"select\":\"styles_select__1BaqC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"checkbox\":\"styles_checkbox__3iL51\",\"label\":\"styles_label__3hGrm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"action\":\"styles_action__13iH4\",\"invalid\":\"styles_invalid__1yKSC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"city-modal\":\"styles_city-modal__1AgdR\",\"city-modal-visible_yes\":\"styles_city-modal-visible_yes__3Ub-H\",\"fadeIn\":\"styles_fadeIn__26BAg\",\"city-modal-visible_no\":\"styles_city-modal-visible_no__1NmRJ\",\"fadeOut\":\"styles_fadeOut__1X9f5\"};","import { useEffect } from 'react';\n\nimport { useScreenVisible } from '../components/StackNavigator';\nimport { hit } from '../lib/metrika';\nimport { YMetrikaVisitParams } from '../lib/metrika/types';\n\nexport function useMetrikaHit(params?: YMetrikaVisitParams) {\n    const isVisible = useScreenVisible();\n\n    useEffect(() => {\n        if (isVisible) {\n            hit(window.location.href, { params });\n        }\n    }, [isVisible, params]);\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { dateToString } from '../../lib/date';\n\nexport type DateFilter = {\n    date: string;\n    period: number;\n};\n\nconst initialState: DateFilter = {\n    date: dateToString(new Date()).toString(),\n    period: 1,\n};\n\nconst dateFilter = createSlice({\n    name: 'date-filter',\n    initialState,\n    reducers: {\n        setDate(state, action: PayloadAction<{ date: string; period?: number }>) {\n            state.date = action.payload.date;\n            state.period = action.payload.period || 1;\n        },\n    },\n});\n\nexport const { setDate } = dateFilter.actions;\n\nexport default dateFilter.reducer;\n","import { format, parse } from 'date-fns';\n\nexport const dateToString = (date: Date) => format(date, 'YYYY-MM-DD').toString();\nexport const parseDate = (date: string) => parse(date);\n","import { RefObject, useEffect, useMemo } from 'react';\n\nimport { useVisible } from './useVisible';\n\ntype InfiniteScrollOptions = {\n    ref: RefObject<HTMLElement>;\n    isLoading: boolean;\n    hasMore: boolean;\n    loadMore: () => void;\n    threshold?: number;\n};\n\nexport function useInfiniteScroll({ threshold, ref, isLoading, loadMore, hasMore }: InfiniteScrollOptions) {\n    const options = useMemo<IntersectionObserverInit>(() => {\n        return {\n            rootMargin: `0px 0px ${threshold || 0}px 0px`,\n        };\n    }, [threshold]);\n\n    const needLoadMore = useVisible(ref, options) || false;\n\n    useEffect(() => {\n        if (!hasMore) return;\n        if (isLoading) return;\n\n        if (needLoadMore) {\n            loadMore();\n        }\n    }, [needLoadMore, loadMore, hasMore, isLoading]);\n}\n","import { RefObject, useLayoutEffect, useState, useRef } from 'react';\n\nexport function useVisible(ref: RefObject<HTMLElement>, options?: IntersectionObserverInit) {\n    // Пока не навешан обработчик на элемент, мы точно не можем сказать видим он или нет,\n    // поэтому начальное значение undefined\n    const [isVisible, setVisible] = useState<boolean>();\n    const optionsRef = useRef(options);\n\n    useLayoutEffect(() => {\n        if (!ref.current) {\n            return;\n        }\n\n        if (options !== optionsRef.current && process.env.NODE_ENV === 'development') {\n            optionsRef.current = options;\n\n            console.warn(\n                '[useVisible] Изменились опции для IntersectionObserver. Это может приводить к существенному падению производительности при скролле.'\n            );\n        }\n\n        const observer = new IntersectionObserver(([entry]) => {\n            setVisible(entry.isIntersecting);\n        }, options);\n\n        observer.observe(ref.current);\n\n        return () => {\n            observer.disconnect();\n        };\n    }, [ref, options]);\n\n    return isVisible;\n}\n","import React, { ReactElement, useRef } from 'react';\n\nimport { ActualEvent } from '../../lib/api/fragments/actual-event';\nimport { useInfiniteScroll } from '../../hooks/useInfiniteScroll';\nimport { usePaginatedList } from '../../hooks/usePaginatedList';\n\nimport { DEFAULT_ITEMS_GAP } from './constants';\n\nimport styles from './style.module.css';\n\ntype BaseProps = {\n    items: Array<ActualEvent | null>;\n    component: React.FC<{ event: ActualEvent; onClick?: () => void }>;\n    onItemClick?: () => void;\n    itemsGap?: number;\n};\n\ntype StaticProps = BaseProps & {\n    type?: 'static';\n};\n\ntype LoadableProps = BaseProps & {\n    type: 'loadable';\n    pageSize: number;\n    loadMore: () => void;\n    hasMore: boolean;\n    isLoadingMore: boolean;\n    skeleton: ReactElement;\n};\n\ntype Props = StaticProps | LoadableProps;\n\nconst EventsList: React.FC<Props> = props => {\n    const { itemsGap = DEFAULT_ITEMS_GAP } = props;\n\n    if (props.type === 'loadable') {\n        return <EventsListLoadable {...props} />;\n    }\n\n    return (\n        <div className={styles.list} style={{ gridGap: `${itemsGap}px` }}>\n            <EventsListItems {...props} />\n        </div>\n    );\n};\n\nconst EventsListLoadable: React.FC<LoadableProps> = props => {\n    const { itemsGap = DEFAULT_ITEMS_GAP } = props;\n    const loadMoreRef = useRef<HTMLDivElement | null>(null);\n\n    const [events, hasMore, loadMore] = usePaginatedList({\n        items: props.items,\n        hasMore: props.hasMore,\n        loadMore: props.loadMore,\n        pageSize: props.pageSize,\n    });\n\n    useInfiniteScroll({\n        ref: loadMoreRef,\n        isLoading: props.isLoadingMore,\n        hasMore,\n        loadMore,\n        threshold: 200,\n    });\n\n    return (\n        <div className={styles.list} style={{ gridGap: `${itemsGap}px` }}>\n            <EventsListItems {...props} items={events} />\n            {props.isLoadingMore && props.skeleton}\n            <div ref={loadMoreRef} />\n        </div>\n    );\n};\n\nconst EventsListItems: React.FC<BaseProps> = props => {\n    return (\n        <>\n            {props.items.map((actualEvent, index) => {\n                if (!actualEvent) {\n                    return null;\n                }\n\n                return <props.component key={index} event={actualEvent} onClick={props.onItemClick} />;\n            })}\n        </>\n    );\n};\n\nexport default EventsList;\n","import { useCallback, useMemo, useState } from 'react';\n\ntype PaginatedListOptions<T> = {\n    items: T[];\n    hasMore: boolean;\n    loadMore: () => void;\n    pageSize: number;\n};\n\nexport function usePaginatedList<T>(options: PaginatedListOptions<T>): [T[], boolean, () => void] {\n    const { items, hasMore, loadMore, pageSize } = options;\n\n    const [limit, setLimit] = useState(pageSize);\n    const events = useMemo(() => items.slice(0, limit), [items, limit]);\n\n    const wrappedLoadMore = useCallback(() => {\n        if (items.length > limit) {\n            setLimit(limit + pageSize);\n        } else {\n            loadMore();\n        }\n    }, [loadMore, limit, pageSize, items]);\n\n    const wrappedHasMore = hasMore || limit < items.length;\n\n    return [events, wrappedHasMore, wrappedLoadMore];\n}\n","import React, { memo } from 'react';\nimport { Link } from 'react-router-dom';\n\nimport { getEventUrl } from '../../lib/url-builder';\nimport { ActualEvent } from '../../lib/api/fragments/actual-event';\n\nimport Image from '../Image';\nimport PriceLabel from '../PriceLabel';\n\nimport styles from './style.module.css';\n\nexport type Props = {\n    event: ActualEvent;\n    onClick?: () => void;\n};\n\nconst EventCard: React.FC<Props> = props => {\n    const { id, title, argument, image, tickets } = props.event.eventPreview;\n    const ticket = tickets && tickets[0];\n\n    return (\n        <Link to={getEventUrl(id)} className={styles.card} onClick={props.onClick}>\n            <div className={styles['image-wrapper']}>\n                {image && image.eventListCard ? (\n                    <Image\n                        className={styles.image}\n                        alt={title}\n                        src={image.eventListCard}\n                        src2x={image.eventListCard2x}\n                        bgColor={image.bgColor}\n                    />\n                ) : (\n                    <div className={styles.preview} />\n                )}\n                {ticket && <PriceLabel ticket={ticket} position={'left'} />}\n                {image && <div className={styles['image-overlay']} />}\n            </div>\n            <div className={styles.description}>\n                <div className={styles.title}>{title}</div>\n                <div className={styles.annotation}>{argument}</div>\n            </div>\n        </Link>\n    );\n};\n\nexport default memo(EventCard);\n","import React from 'react';\n\nimport { Ticket } from '../../lib/api/fragments/ticket';\nimport TicketPrice from '../TicketPrice';\n\nimport styles from './styles.module.css';\n\ntype Props = {\n    ticket: Ticket;\n    position?: 'left' | 'right';\n};\n\nconst PriceLabel: React.FC<Props> = props => (\n    <div className={[styles.price, styles[props.position || 'left']].join(' ')}>\n        <TicketPrice ticket={props.ticket} />\n    </div>\n);\n\nexport default PriceLabel;\n","import React from 'react';\n\nimport { Ticket } from '../../lib/api/fragments/ticket';\nimport { getCurrencySymbol } from '../../lib/price';\n\ntype Props = {\n    ticket: Ticket;\n    exact?: boolean;\n};\n\nconst space = '\\u00A0';\n\nconst TicketPrice: React.FC<Props> = ({ ticket, exact }) => {\n    if (!ticket.price || !ticket.price.min) {\n        return null;\n    }\n\n    const text = [\n        exact ? '' : `от${space}`,\n        (ticket.price.min || 0) / 100,\n        space,\n        getCurrencySymbol(ticket.price.currency),\n    ].filter(Boolean).join(space);\n\n    return <>{text}</>;\n};\n\nexport default TicketPrice;\n","import React, { ButtonHTMLAttributes, forwardRef, ReactNode } from 'react';\n\nimport styles from './styles.module.css';\n\nexport type Props = {\n    type?: ButtonHTMLAttributes<HTMLButtonElement>['type'];\n    className?: string;\n    disabled?: boolean;\n    formInvalid?: boolean;\n    onClick?: () => void;\n    children: ReactNode;\n};\nconst ActionButton = forwardRef<HTMLButtonElement, Props>(\n    ({ type, className, disabled, formInvalid, children, onClick }, ref) => {\n        const cls = [styles.action, className, formInvalid && styles.invalid].filter(Boolean).join(' ');\n        return (\n            <button ref={ref} type={type} className={cls} onClick={onClick} disabled={disabled}>\n                {children}\n            </button>\n        );\n    }\n);\n\nexport default ActionButton;\n","import React from 'react';\n\nimport { Rect } from '../../Skeletons';\n\nimport styles from './styles.module.css';\n\nconst EventCardMainSkeleton: React.FC = () => {\n    return <Rect className={styles.card} />;\n};\n\nexport default EventCardMainSkeleton;\n","import React from 'react';\n\nimport { Rect } from '../../Skeletons';\n\nimport styles from './styles.module.css';\n\nconst SelectionListSkeleton: React.FC<{ className?: string }> = ({ className }) => {\n    return (\n        <div className={[styles.block, className].filter(Boolean).join(' ')}>\n            {Array(5)\n                .fill(0)\n                .map((_, index) => (\n                    <Rect key={index} className={styles.item} />\n                ))}\n        </div>\n    );\n};\n\nexport default SelectionListSkeleton;\n","import { Currency } from './api/fragments/ticket';\n\nconst currencySymbol: { [key in Currency]: string } = {\n    rub: '₽',\n    usd: '$',\n};\n\nexport function getCurrencySymbol(currency: Currency) {\n    return currencySymbol[currency];\n}\n","import React from 'react';\n\nimport { Rect, Text } from '../../Skeletons';\n\nimport styles from './styles.module.css';\n\nexport const EventCardVerticalSkeleton: React.FC = () => (\n    <div className={styles.card}>\n        <Rect className={styles.image} />\n        <Text className={styles.title} />\n        <Text className={styles.description} />\n    </div>\n);\n","import React from 'react';\n\nimport { Text } from '../../../../../components/Skeletons';\nimport { EventCardVerticalSkeleton } from '../../../../../components/EventCardVertical/Skeleton';\n\nimport styles from './styles.module.css';\n\nexport const EventsFeedSkeleton: React.FC = () => (\n    <div className={styles.feed}>\n        <Text className={styles.title} />\n        <div className={styles.events}>\n            <div className={styles.item}>\n                <EventCardVerticalSkeleton />\n            </div>\n            <div className={styles.item}>\n                <EventCardVerticalSkeleton />\n            </div>\n            <div className={styles.item}>\n                <EventCardVerticalSkeleton />\n            </div>\n        </div>\n    </div>\n);\n","import React from 'react';\n\nimport { EventsFeedSkeleton } from '../../EventsFeed/Skeleton';\n\nconst RecommendedEventsSkeleton: React.FC = () => {\n    return (\n        <>\n            <EventsFeedSkeleton />\n            <EventsFeedSkeleton />\n            <EventsFeedSkeleton />\n            <EventsFeedSkeleton />\n        </>\n    );\n};\n\nexport default RecommendedEventsSkeleton;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"clear\":\"styles_clear__ZHIHN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"events\":\"styles_events__3RaZ8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"styles_card__1j4tU\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"styles_input__2gjR5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"styles_input__1gPFI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"styles_title__354Bd\"};","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { fetchCityInfo, MOSCOW } from '../../lib/api';\nimport { getCurrentPosition } from '../../lib/geolocation';\nimport { getPersistConfig } from '../helpers/persist';\n\nimport { AppThunk } from '../index';\n\nimport { setItems as setMenuItems } from './menu';\n\nexport type City = {\n    useGeolocation: boolean;\n    isFetchingLocation: boolean;\n    currentCity: {\n        name: string;\n        geoid: number;\n        longitude: number;\n        latitude: number;\n    };\n};\n\nconst initialState: City = {\n    useGeolocation: true,\n    isFetchingLocation: false,\n    currentCity: MOSCOW,\n};\n\nconst city = createSlice({\n    name: 'city',\n    initialState,\n    reducers: {\n        setCity(state, action: PayloadAction<City['currentCity']>) {\n            state.currentCity = action.payload;\n        },\n        setGeolocation(state, action: PayloadAction<boolean>) {\n            state.useGeolocation = action.payload;\n        },\n        locationFetchStart(state) {\n            state.isFetchingLocation = true;\n        },\n        locationFetchSuccess(state) {\n            state.isFetchingLocation = false;\n        },\n        locationFetchFailed(state, action: PayloadAction<boolean>) {\n            state.isFetchingLocation = false;\n            state.useGeolocation = false;\n\n            if (action.payload) {\n                alert('Не удалось получить вашу геолокацию!');\n            }\n        },\n    },\n});\n\nexport const { setCity, setGeolocation, locationFetchStart, locationFetchSuccess, locationFetchFailed } = city.actions;\n\nexport const loadCityInfoByLocation = (showError: boolean): AppThunk => async dispatch => {\n    dispatch(locationFetchStart());\n\n    try {\n        const coords = await getCurrentPosition();\n\n        const options = {\n            longitude: coords.longitude,\n            latitude: coords.latitude,\n        };\n\n        const { cityInfo } = await fetchCityInfo(options);\n\n        dispatch(\n            setCity({\n                name: cityInfo.name,\n                geoid: cityInfo.geoid,\n                longitude: cityInfo.longitude,\n                latitude: cityInfo.latitude,\n            })\n        );\n\n        dispatch(setMenuItems(cityInfo.eventsMenu));\n        dispatch(locationFetchSuccess());\n    } catch (err) {\n        console.error(err);\n        dispatch(locationFetchFailed(showError));\n    }\n};\n\nexport const loadCityInfo = (): AppThunk => async(dispatch, getState) => {\n    const cityState = getState().city;\n\n    try {\n        if (cityState.useGeolocation) {\n            dispatch(loadCityInfoByLocation(false));\n\n            return;\n        }\n\n        const { cityInfo } = await fetchCityInfo({\n            longitude: cityState.currentCity.longitude,\n            latitude: cityState.currentCity.latitude,\n        });\n\n        dispatch(setMenuItems(cityInfo.eventsMenu));\n    } catch (err) {\n        console.error(err);\n    }\n};\n\nexport const toggleGeolocation = (isActive: boolean): AppThunk => async dispatch => {\n    if (isActive) {\n        dispatch(loadCityInfoByLocation(true));\n    }\n\n    dispatch(setGeolocation(isActive));\n};\n\nconst persistConfig = getPersistConfig<City>('city');\nexport default persistReducer(persistConfig, city.reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer } from 'redux-persist';\n\nimport { fetchCityList } from '../../lib/api';\nimport { getPersistConfig } from '../helpers/persist';\n\nimport { City } from '../../lib/api/fragments/city';\nimport { AppThunk } from '../index';\n\nexport type CityListState = {\n    isLoading: boolean;\n    items: City[];\n};\n\nconst initialState: CityListState = {\n    isLoading: false,\n    items: [],\n};\n\nconst cityList = createSlice({\n    name: 'city-list',\n    initialState,\n    reducers: {\n        setLoading(state, action: PayloadAction<boolean>) {\n            state.isLoading = action.payload;\n        },\n        setCityListResult(state, action: PayloadAction<CityListState['items']>) {\n            state.items = action.payload;\n        },\n    },\n});\n\nexport const { setLoading, setCityListResult } = cityList.actions;\n\nexport const loadCityList = (): AppThunk => async dispatch => {\n    dispatch(setLoading(true));\n\n    try {\n        const { cities } = await fetchCityList();\n        dispatch(setCityListResult(cities));\n    } catch (err) {\n        console.error(err);\n    }\n\n    dispatch(setLoading(false));\n};\n\nconst persistConfig = getPersistConfig<CityListState>('city-list', {\n    blacklist: ['isLoading'],\n});\nexport default persistReducer(persistConfig, cityList.reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { persistReducer, createTransform } from 'redux-persist';\n\nimport { fetchActualEvents, fetchSuggest } from '../../lib/api';\n\nimport { Document, Groups } from '../../lib/api/fragments/suggest';\nimport { ActualEvent } from '../../lib/api/fragments/actual-event';\nimport { AppThunk } from '../index';\nimport { getPersistConfig, getTransformUIPersistance } from '../helpers/persist';\n\ntype SearchState = {\n    data: {\n        results: {\n            groups: Array<{\n                code: string;\n                title: string | null;\n                events: ActualEvent[];\n            }>;\n        };\n        popularEvents: {\n            events: Array<ActualEvent | null>;\n\n            updatedAt: number;\n        };\n    };\n    ui: {\n        results: { isLoading: boolean };\n        popularEvents: { isLoading: boolean; isUpdating: boolean };\n    };\n};\n\nconst initialState: SearchState = {\n    data: {\n        results: {\n            groups: [],\n        },\n        popularEvents: {\n            events: [],\n            updatedAt: 0,\n        },\n    },\n    ui: {\n        popularEvents: {\n            isLoading: false,\n            isUpdating: false,\n        },\n        results: { isLoading: false },\n    },\n};\n\nconst updateInterval = 900 * 1000;\n\nconst search = createSlice({\n    name: 'search',\n    initialState,\n    reducers: {\n        fetchPopularStart(state) {\n            if (state.data.popularEvents.events.length > 0) {\n                state.ui.popularEvents.isUpdating = true;\n            } else {\n                state.ui.popularEvents.isLoading = true;\n            }\n        },\n        fetchPopularSuccess(state, action: PayloadAction<SearchState['data']['popularEvents']['events']>) {\n            state.data.popularEvents.events = action.payload;\n            state.data.popularEvents.updatedAt = Date.now();\n            state.ui.popularEvents.isLoading = false;\n            state.ui.popularEvents.isUpdating = false;\n        },\n        fetchPopularError(state) {\n            state.ui.popularEvents.isLoading = false;\n            state.ui.popularEvents.isUpdating = false;\n        },\n        searchStart(state) {\n            state.ui.results.isLoading = true;\n            state.data.results.groups = [];\n        },\n        searchSuccess(state, action: PayloadAction<Groups[]>) {\n            state.ui.results.isLoading = false;\n            state.data.results.groups = action.payload.map(group => {\n                return {\n                    code: group.code,\n                    title: group.title,\n                    events: group.documents.map(doc => transformSearchDocumentToList(doc)),\n                };\n            });\n        },\n        searchError(state) {\n            state.ui.results.isLoading = false;\n        },\n        resetResults(state) {\n            if (state.data.results.groups.length > 0) {\n                state.data.results.groups = [];\n            }\n        },\n    },\n});\n\nexport const {\n    fetchPopularStart,\n    fetchPopularSuccess,\n    fetchPopularError,\n    searchStart,\n    searchSuccess,\n    searchError,\n    resetResults,\n} = search.actions;\n\nexport const loadPopularEvents = (): AppThunk => async(dispatch, getState) => {\n    const events = getState().search.data.popularEvents;\n\n    if (events && events.updatedAt + updateInterval > Date.now()) {\n        return;\n    }\n\n    dispatch(fetchPopularStart());\n\n    try {\n        const { geoid } = getState().city.currentCity;\n        const actualEvents = await fetchActualEvents({ limit: 15, geoid });\n        dispatch(fetchPopularSuccess(actualEvents.events.items));\n    } catch (err) {\n        console.error(err);\n        dispatch(fetchPopularError());\n    }\n};\n\nlet activeRequest: AbortController | null = null;\n\nfunction filterGroupsByText(text: string, groups: Groups[]) {\n    return groups\n        .map<Groups>(group => ({\n            ...group,\n            documents: group.documents.filter(({ object }) =>\n                object.title.toLowerCase().includes(text.trim().toLowerCase())\n            ),\n        }))\n        .filter(group => group.documents.length);\n}\nexport const loadSearchResults = (text: string): AppThunk => async(dispatch, getState) => {\n    if (activeRequest) {\n        activeRequest.abort();\n    }\n\n    activeRequest = new AbortController();\n\n    // Избегаем лишней перерисовки при наборе запроса\n    if (!getState().search.ui.results.isLoading) {\n        dispatch(searchStart());\n    }\n\n    try {\n        const { geoid } = getState().city.currentCity;\n        const {\n            suggest: { groups },\n        } = await fetchSuggest(text, geoid, activeRequest.signal);\n\n        dispatch(searchSuccess(filterGroupsByText(text, groups)));\n\n        activeRequest = null;\n    } catch (err) {\n        if (err.name === 'AbortError') {\n            return;\n        }\n\n        console.error(err);\n        dispatch(searchError());\n    }\n};\n\nconst persistConfig = getPersistConfig<SearchState>('search', {\n    transforms: [\n        createTransform(\n            (inboundState: SearchState[keyof SearchState], key: keyof SearchState): SearchState[keyof SearchState] => {\n                if (key === 'data') {\n                    const { results, ...rest } = inboundState as SearchState['data'];\n\n                    return { ...rest, results: { groups: [] } };\n                }\n\n                return inboundState;\n            }\n        ),\n        getTransformUIPersistance<SearchState['ui']>(initialState.ui),\n    ],\n});\nexport default persistReducer(persistConfig, search.reducer);\n\nexport function transformSearchDocumentToList(document: Document): ActualEvent {\n    const { id, title, argument, image, type, minPrice } = document.object;\n\n    return {\n        eventPreview: {\n            id,\n            title,\n            argument,\n            image,\n            type,\n            tags: [],\n            contentRating: null,\n            tickets: minPrice ?\n                [\n                    {\n                        id: null,\n                        price: { min: minPrice.value, currency: minPrice.currency, max: null },\n                    },\n                ] :\n                [],\n            userRating: null,\n        },\n        scheduleInfo: {\n            placesTotal: null,\n            preview: null,\n        },\n    };\n}\n","import { configureStore, Action, getDefaultMiddleware, combineReducers } from '@reduxjs/toolkit';\nimport { ThunkAction } from 'redux-thunk';\nimport { persistStore } from 'redux-persist';\nimport * as PERSIST_CONTSTANS from 'redux-persist/lib/constants';\n\nimport eventReducer from './slices/event';\nimport actualEventsReducer from './slices/actual-events';\nimport rubricEventsReducer from './slices/rubric-events';\nimport selectionsReducer from './slices/selections';\nimport selectionEventsReducer from './slices/selection-events';\nimport cityReducer from './slices/city';\nimport cityListReducer from './slices/city-list';\nimport searchReducer from './slices/search';\nimport menuReducer from './slices/menu';\nimport dateFilterReducer from './slices/date-filter';\nimport recommendedReducer from './slices/recommended-events';\nimport userReducer from './slices/user';\nimport orderReducer from './slices/order';\n\nconst PERSIST_ACTIONS = [\n    PERSIST_CONTSTANS.FLUSH,\n    PERSIST_CONTSTANS.REHYDRATE,\n    PERSIST_CONTSTANS.PAUSE,\n    PERSIST_CONTSTANS.PERSIST,\n    PERSIST_CONTSTANS.PURGE,\n    PERSIST_CONTSTANS.REGISTER,\n];\nconst rootReducer = combineReducers({\n    event: eventReducer,\n    actualEvents: actualEventsReducer,\n    rubricEvents: rubricEventsReducer,\n    selections: selectionsReducer,\n    selectionEvents: selectionEventsReducer,\n    city: cityReducer,\n    cityList: cityListReducer,\n    search: searchReducer,\n    menu: menuReducer,\n    dateFilter: dateFilterReducer,\n    recommendedEvents: recommendedReducer,\n    user: userReducer,\n    order: orderReducer,\n});\nconst store = configureStore({\n    reducer: rootReducer,\n    middleware: getDefaultMiddleware({\n        serializableCheck: {\n            ignoredActions: PERSIST_ACTIONS,\n        },\n    }),\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\nexport type AppThunk = ThunkAction<void, RootState, null, Action<string>>;\n\nexport const persistor = persistStore(store);\n\nexport default store;\n","import React from 'react';\n\nimport { Rect } from '../../Skeletons';\n\nimport styles from './styles.module.css';\n\nconst DateFilterSkeleton: React.FC = () => (\n    <div className={styles.block}>\n        {Array(2)\n            .fill(0)\n            .map((_, index) => (\n                <Rect key={index} className={styles.filter} />\n            ))}\n    </div>\n);\n\nexport default DateFilterSkeleton;\n","import React from 'react';\n\nimport { Text } from '../../../components/Skeletons';\nimport DateFilterSkeleton from '../../../components/DateFilter/Skeleton';\nimport EventsListSkeleton from '../../../components/EventsList/Skeleton';\nimport EventCardMainSkeleton from '../../../components/EventCardMain/Skeleton';\nimport SelectionListSkeleton from '../../../components/SelectionList/Skeleton';\n\nimport styles from './styles.module.css';\n\nconst MainScreenSkeleton: React.FC = () => (\n    <div>\n        <DateFilterSkeleton />\n        <div className={styles.content}>\n            <Text className={styles.title} />\n            <EventsListSkeleton itemsGap={8} count={5} card={EventCardMainSkeleton} />\n            <Text className={styles.title} />\n            <SelectionListSkeleton />\n        </div>\n    </div>\n);\n\nexport default MainScreenSkeleton;\n","import React, { useEffect, Suspense } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { lazyDeferred } from '../../lib/lazy';\nimport { RootState } from '../../redux';\nimport { loadActualEvents } from '../../redux/slices/actual-events';\nimport { loadSelections } from '../../redux/slices/selections';\n\nimport PageHeader from '../../components/PageHeader';\n\nimport MainScreenSkeleton from './Skeleton';\n\nconst Component = lazyDeferred(() =>\n    import(\n        /* webpackChunkName: \"main-screen\" */\n        './Component'\n    )\n);\n\nconst MainScreen: React.FC = () => {\n    const dispatch = useDispatch();\n    const date = useSelector((state: RootState) => state.dateFilter);\n    const { geoid } = useSelector((state: RootState) => state.city.currentCity);\n\n    useEffect(() => {\n        dispatch(loadActualEvents(date, geoid));\n        dispatch(loadSelections(date, geoid));\n    }, [dispatch, date, geoid]);\n\n    return (\n        <>\n            <PageHeader hasLogo hasMenu />\n            <Suspense fallback={<MainScreenSkeleton />}>\n                <Component />\n            </Suspense>\n        </>\n    );\n};\n\nexport default MainScreen;\n","import React from 'react';\n\nimport { Rect, Text } from '../../../components/Skeletons';\nimport RecommendedEventsSkeleton from '../components/RecommendedEvents/Skeleton';\n\nimport styles from './styles.module.css';\n\nconst EventSkeleton: React.FC = () => (\n    <div className={styles.container}>\n        <div className={styles.image} />\n\n        <div className={styles['button-wrapper']}>\n            <Rect className={styles.button} />\n        </div>\n\n        <Text className={styles['date-1']} />\n        <Text className={styles['date-2']} />\n\n        <Rect className={styles.map} />\n\n        <Text className={styles['place-1']} />\n        <Text className={styles['place-2']} />\n\n        <div className={styles.gallery}>\n            <Text className={styles['gallery-header']} />\n            <div className={styles['gallery-content']}>\n                <Rect className={styles['gallery-card']} />\n                <Rect className={styles['gallery-card']} />\n                <Rect className={styles['gallery-card']} />\n            </div>\n        </div>\n\n        <div className={styles.description}>\n            {Array(5)\n                .fill(0)\n                .map((_, index) => (\n                    <Text key={index} className={styles[`description-line-${index + 1}`]} />\n                ))}\n        </div>\n\n        <div className={styles.recommended}>\n            <RecommendedEventsSkeleton />\n        </div>\n    </div>\n);\nexport default EventSkeleton;\n","import React, { useEffect, Suspense } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport { lazyDeferred } from '../../lib/lazy';\nimport { loadEvent } from '../../redux/slices/event';\nimport { loadRecommendedEvents } from '../../redux/slices/recommended-events';\n\nimport EventSkeleton from './Skeleton';\n\nconst Component = lazyDeferred(() =>\n    import(\n        /* webpackChunkName: \"event-screen\" */\n        './Component'\n    )\n);\n\nconst EventScreen: React.FC<{ id: string }> = ({ id }) => {\n    const dispatch = useDispatch();\n\n    useEffect(() => {\n        dispatch(loadEvent(id));\n        dispatch(loadRecommendedEvents());\n    }, [dispatch, id]);\n\n    return (\n        <>\n            <Suspense fallback={<EventSkeleton />}>\n                <Component id={id} skeleton={<EventSkeleton />} />\n            </Suspense>\n        </>\n    );\n};\n\nexport default EventScreen;\n","import React from 'react';\n\nimport { Text } from '../../../components/Skeletons';\nimport DateFilterSkeleton from '../../../components/DateFilter/Skeleton';\nimport EventsListSkeleton from '../../../components/EventsList/Skeleton';\nimport EventCardSkeleton from '../../../components/EventCard/Skeleton';\n\nimport styles from './styles.module.css';\n\nconst SelectionScreenSkeleton: React.FC = () => (\n    <div>\n        <DateFilterSkeleton />\n        <div className={styles.content}>\n            <Text className={styles.title} />\n            <EventsListSkeleton count={10} card={EventCardSkeleton} />\n        </div>\n    </div>\n);\n\nexport default SelectionScreenSkeleton;\n","import React, { useEffect, Suspense } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { lazyDeferred } from '../../lib/lazy';\nimport { RootState } from '../../redux';\nimport { loadRubricEvents } from '../../redux/slices/rubric-events';\n\nimport PageHeader from '../../components/PageHeader';\nimport SelectionScreenSkeleton from '../SelectionScreen/Skeleton';\n\nconst Component = lazyDeferred(() =>\n    import(\n        /* webpackChunkName: \"rubric-screen\" */\n        './Component'\n    )\n);\n\nconst RubricScreen: React.FC<{ code: string }> = ({ code }) => {\n    const dispatch = useDispatch();\n    const date = useSelector((state: RootState) => state.dateFilter);\n\n    useEffect(() => {\n        dispatch(loadRubricEvents(code, date));\n    }, [dispatch, code, date]);\n\n    return (\n        <>\n            <PageHeader hasLogo hasMenu />\n            <Suspense fallback={<SelectionScreenSkeleton />}>\n                <Component code={code} />\n            </Suspense>\n        </>\n    );\n};\n\nexport default RubricScreen;\n","import React, { useEffect, Suspense } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { lazyDeferred } from '../../lib/lazy';\nimport { RootState } from '../../redux';\nimport { loadSelectionEvents } from '../../redux/slices/selection-events';\n\nimport PageHeader from '../../components/PageHeader';\n\nimport SelectionScreenSkeleton from './Skeleton';\n\nconst Component = lazyDeferred(() =>\n    import(\n        /* webpackChunkName: \"selection-screen\" */\n        './Component'\n    )\n);\n\nconst SelectionScreen: React.FC<{ code: string }> = ({ code }) => {\n    const dispatch = useDispatch();\n    const date = useSelector((state: RootState) => state.dateFilter);\n\n    useEffect(() => {\n        dispatch(loadSelectionEvents(code, date));\n    }, [dispatch, code, date]);\n\n    return (\n        <>\n            <PageHeader hasLogo hasMenu />\n            <Suspense fallback={<SelectionScreenSkeleton />}>\n                <Component code={code} />\n            </Suspense>\n        </>\n    );\n};\n\nexport default SelectionScreen;\n","import React, { ChangeEvent, useCallback, useEffect, useState, useRef } from 'react';\n\nimport TextInput from '../../../components/TextInput';\n\nimport styles from './styles.module.css';\n\nconst SuggestInput: React.FC<{ onChange: (value: string) => void }> = props => {\n    const inputRef = useRef<HTMLInputElement | null>(null);\n    const [value, setValue] = useState('');\n    const onChange = useCallback(\n        (e: ChangeEvent<HTMLInputElement>) => {\n            const { value } = e.target;\n\n            props.onChange(value);\n            setValue(value);\n        },\n        [setValue, props]\n    );\n\n    useEffect(() => {\n        if (inputRef.current) {\n            inputRef.current.focus();\n        }\n    }, [inputRef]);\n\n    return (\n        <TextInput\n            ref={inputRef}\n            className={styles.input}\n            defaultValue={value}\n            placeholder=\"Поиск по событиям\"\n            onChange={onChange}\n        />\n    );\n};\n\nexport default SuggestInput;\n","import React from 'react';\n\nimport { Text } from '../../../../components/Skeletons';\nimport EventsListSkeleton from '../../../../components/EventsList/Skeleton';\nimport EventCardSkeleton from '../../../../components/EventCard/Skeleton';\n\nimport styles from './styles.module.css';\n\nconst SearchResultSkeleton: React.FC = () => (\n    <>\n        {Array(3)\n            .fill(0)\n            .map((_, index) => (\n                <div key={index}>\n                    <Text className={styles.title} />\n\n                    <EventsListSkeleton count={3} card={EventCardSkeleton} />\n                </div>\n            ))}\n    </>\n);\n\nexport default SearchResultSkeleton;\n","import React from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { RootState } from '../../../redux';\n\nimport EventsList from '../../../components/EventsList';\nimport EventCard from '../../../components/EventCard';\nimport { useThrottleLoading } from '../../../hooks/useThrottleLoading';\n\nimport SearchResultSkeleton from './Skeleton';\nimport styles from './styles.module.css';\n\ntype Props = {\n    onItemClick: () => void;\n};\n\nconst SKELETON_THROTTLE_MS = 250;\n\nconst SearchResult: React.FC<Props> = ({ onItemClick }) => {\n    const { groups } = useSelector((state: RootState) => state.search.data.results);\n    const { isLoading } = useSelector((state: RootState) => state.search.ui.results);\n\n    const isThrottleLoading = useThrottleLoading(isLoading, SKELETON_THROTTLE_MS);\n\n    if (isThrottleLoading) {\n        return <SearchResultSkeleton />;\n    }\n\n    if (groups.length === 0 && !isLoading && !isThrottleLoading) {\n        return <div className={styles.notFound}>Ничего не найдено</div>;\n    }\n\n    return (\n        <>\n            {groups.map(({ code, title, events }) => (\n                <section key={code}>\n                    <h2 className={styles.title}>{title}</h2>\n                    <EventsList items={events} component={EventCard} onItemClick={onItemClick} />\n                </section>\n            ))}\n        </>\n    );\n};\n\nexport default SearchResult;\n","import { useEffect, useState } from 'react';\n\nexport function useThrottleLoading(isLoading: boolean, time: number) {\n    const [isThrottleLoading, setThrottleLoading] = useState(false);\n\n    // Задерживаем отрисовку на некоторое время после начала загрузки данных.\n    // Тем самым исключим моргание между заглушкой и рендером основного компонента\n    useEffect(() => {\n        if (isLoading) {\n            const newTimerId = window.setTimeout(() => setThrottleLoading(true), time);\n\n            return () => clearTimeout(newTimerId);\n        }\n\n        setThrottleLoading(false);\n    }, [isLoading, time]);\n\n    return isThrottleLoading;\n}\n","import React from 'react';\n\nimport { Text } from '../../../../components/Skeletons';\n\nimport styles from './styles.module.css';\n\ntype Props = {\n    showTitle?: boolean;\n};\n\nconst PopularResultSkeleton: React.FC<Props> = ({ showTitle }) => (\n    <>\n        {showTitle && <Text className={styles.title} />}\n\n        <div>\n            {Array(15)\n                .fill(0)\n                .map((_, index) => (\n                    <Text className={styles.event} key={index} />\n                ))}\n        </div>\n    </>\n);\n\nexport default PopularResultSkeleton;\n","import React from 'react';\nimport { Link } from 'react-router-dom';\nimport { useSelector } from 'react-redux';\n\nimport { getEventUrl } from '../../../lib/url-builder';\nimport { RootState } from '../../../redux';\n\nimport PopularResultSkeleton from './Skeleton';\n\nimport styles from './styles.module.css';\n\ntype Props = {\n    onLinkClick: () => void;\n};\nconst Index: React.FC<Props> = ({ onLinkClick }) => {\n    const { events } = useSelector((state: RootState) => state.search.data.popularEvents);\n    const { isLoading } = useSelector((state: RootState) => state.search.ui.popularEvents);\n\n    return (\n        <section>\n            <div className={styles.title}>Популярные запросы</div>\n            {isLoading && <PopularResultSkeleton />}\n            <ul className={styles.events}>\n                {events.map((actualEvent, i) => {\n                    if (!actualEvent) {\n                        return null;\n                    }\n\n                    const { id, title } = actualEvent.eventPreview;\n\n                    return (\n                        <li key={i} className={styles.event}>\n                            <Link onClick={onLinkClick} className={styles.link} to={getEventUrl(id)}>\n                                {title}\n                            </Link>\n                        </li>\n                    );\n                })}\n            </ul>\n        </section>\n    );\n};\n\nexport default Index;\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { throttle } from 'throttle-debounce';\n\nimport { loadPopularEvents, loadSearchResults, resetResults } from '../../redux/slices/search';\n\nimport BackwardButton from '../../components/BackwardButton';\nimport { useMetrikaHit } from '../../hooks/useMetrikaHit';\n\nimport SuggestInput from './Input';\nimport SearchResult from './SearchResult';\nimport PopularResult from './PopularResult';\n\nimport styles from './styles.module.css';\n\nconst INPUT_THROTTLE = 500;\n\nconst SearchScreen: React.FC = () => {\n    const [hasQuery, setHasQuery] = useState(false);\n    const dispatch = useDispatch();\n\n    useEffect(() => {\n        dispatch(loadPopularEvents());\n    }, [dispatch]);\n\n    useMetrikaHit();\n\n    const onInputChange = useMemo(() => {\n        return throttle(INPUT_THROTTLE, (text: string) => {\n            text = text.trim();\n\n            setHasQuery(Boolean(text));\n\n            if (!text) {\n                dispatch(resetResults());\n                return;\n            }\n\n            dispatch(loadSearchResults(text));\n        });\n    }, [dispatch]);\n\n    const onSearchClose = useCallback(() => {\n        dispatch(resetResults());\n    }, [dispatch]);\n\n    return (\n        <>\n            <div className={styles.header}>\n                <BackwardButton fill={'black'} />\n                <SuggestInput onChange={onInputChange} />\n            </div>\n            <div className={styles.content}>\n                {hasQuery ? (\n                    <SearchResult onItemClick={onSearchClose} />\n                ) : (\n                    <PopularResult onLinkClick={onSearchClose} />\n                )}\n            </div>\n        </>\n    );\n};\n\nexport default SearchScreen;\n","import React from 'react';\n\nimport { Rect, Text } from '../../../../components/Skeletons';\n\nimport styles from './styles.module.css';\n\nconst OrderSkeleton: React.FC = () => {\n    return (\n        <div className={styles.card}>\n            <Rect className={styles.image} />\n            <div className={styles.content}>\n                <Text size={20} className={styles.text} />\n                <Text size={16} className={styles.short} />\n                <Text size={16} className={styles.short} />\n            </div>\n            <div className={styles.right}>\n                <Text size={20} className={styles.short} />\n                <Text size={16} className={styles.text} />\n            </div>\n        </div>\n    );\n};\n\nexport default OrderSkeleton;\n","import React from 'react';\n\nimport OrderSkeleton from '../Order/Skeleton';\n\nimport EventsListSkeleton from '../../../components/EventsList/Skeleton';\n\nconst OrdersScreenSkeleton: React.FC = () => {\n    return <EventsListSkeleton count={10} card={OrderSkeleton} />;\n};\n\nexport default OrdersScreenSkeleton;\n","import React, { Suspense, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { lazyDeferred } from '../../lib/lazy';\nimport { loadEvent } from '../../redux/slices/event';\nimport { fetchOrders, orderEventIdsSelector } from '../../redux/slices/order';\n\nimport PageHeader from '../../components/PageHeader';\n\nimport OrdersScreenSkeleton from './Skeleton';\n\nconst Component = lazyDeferred(() =>\n    import(\n        /* webpackChunkName: \"orders-screen\" */\n        './Component'\n    )\n);\n\nconst OrdersScreen: React.FC = () => {\n    const dispatch = useDispatch();\n    const eventIds = useSelector(orderEventIdsSelector);\n\n    const skeleton = <OrdersScreenSkeleton />;\n\n    useEffect(() => {\n        dispatch(fetchOrders());\n    }, [dispatch]);\n\n    useEffect(() => {\n        eventIds.forEach(id => {\n            dispatch(loadEvent(id));\n        });\n    }, [eventIds, dispatch]);\n\n    return (\n        <>\n            <PageHeader\n                backward=\"black\"\n                hasLogo={false}\n                hasMenu={false}\n                text=\"Мои заказы\"\n            />\n            <Suspense fallback={skeleton}>\n                <Component skeleton={skeleton} />\n            </Suspense>\n        </>\n    );\n};\n\nexport default OrdersScreen;\n","import React from 'react';\nimport { NavLink } from 'react-router-dom';\nimport { useSelector } from 'react-redux';\n\nimport { getOrdersUrl, getRubricUrl } from '../../lib/url-builder';\n\nimport { MenuTag } from '../../lib/api/fragments/city';\n\nimport { isAuthenticatedSelector } from '../../redux/slices/user';\nimport { ordersSelector } from '../../redux/slices/order';\n\nimport styles from './style.module.css';\n\ntype MenuItemProps = {\n    text: string;\n    to: string;\n    onItemClick: () => void;\n};\nconst MenuItem: React.FC<MenuItemProps> = props => {\n    const { text, to, onItemClick } = props;\n    return (\n        <li className={styles.item}>\n            <NavLink\n                exact\n                onClick={onItemClick}\n                className={styles.link}\n                activeClassName={styles['active-item']}\n                to={to}\n            >\n                {text}\n            </NavLink>\n        </li>\n    );\n};\n\nexport type MenuListProps = {\n    tags: MenuTag[];\n    onItemClick: () => void;\n};\nconst MenuList: React.FC<MenuListProps> = props => {\n    const isAuthenticated = useSelector(isAuthenticatedSelector);\n    const orders = useSelector(ordersSelector);\n\n    return (\n        <ul className={styles.list}>\n            {isAuthenticated && (\n                <li className={styles.item}>\n                    <NavLink\n                        exact\n                        onClick={props.onItemClick}\n                        className={[styles.link, styles['orders-text']].join(' ')}\n                        to={getOrdersUrl()}\n                    >\n                        Мои заказы\n                    </NavLink>\n                    {orders.length > 0 && <span>{orders.length}</span>}\n                </li>\n            )}\n            <MenuItem\n                to=\"/\"\n                text=\"Главная\"\n                onItemClick={props.onItemClick}\n            />\n            {props.tags.map(tag => (\n                <MenuItem\n                    key={tag.code}\n                    to={getRubricUrl(tag.code)}\n                    text={tag.name}\n                    onItemClick={props.onItemClick}\n                />\n            ))}\n        </ul>\n    );\n};\n\nexport default MenuList;\n","import React, { useCallback } from 'react';\n\nimport { useDispatch } from 'react-redux';\n\nimport { login } from '../../redux/slices/user';\n\nimport styles from './styles.module.css';\n\nconst LoginButton: React.FC = () => {\n    const dispatch = useDispatch();\n\n    const onLoginClick = useCallback(() => {\n        dispatch(login());\n    }, [dispatch]);\n\n    return (\n        <div className={styles.container} onClick={onLoginClick}>\n            <button className={styles.button}>Войти</button>\n        </div>\n    );\n};\n\nexport default LoginButton;\n","import React, { useCallback } from 'react';\n\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { MediaImageSize } from '../../lib/api/fragments/image-size';\nimport { RootState } from '../../redux';\nimport { isAuthenticatedSelector, isAuthorizedSelector, authorize } from '../../redux/slices/user';\n\nimport Image from '../Image';\nimport LoginButton from '../LoginButton';\n\nimport styles from './styles.module.css';\n\nconst avatarImage: MediaImageSize = {\n    url: 'https://api.browser.yandex.ru/userinfo/avatar/islands-middle',\n    width: 42,\n    height: 42,\n};\nconst avatarImage2x: MediaImageSize = {\n    url: 'https://api.browser.yandex.ru/userinfo/avatar/islands-retina-middle',\n    width: 84,\n    height: 84,\n};\n\nconst AuthBox: React.FC = () => {\n    const dispatch = useDispatch();\n\n    const { currentUser } = useSelector((state: RootState) => state.user);\n    const isAuthenticated = useSelector(isAuthenticatedSelector);\n    const isAuthorized = useSelector(isAuthorizedSelector);\n\n    const onClick = useCallback(() => {\n        if (!isAuthorized) {\n            dispatch(authorize());\n        }\n    }, [dispatch, isAuthorized]);\n\n    if (!isAuthenticated) {\n        return <LoginButton />;\n    }\n\n    const name = currentUser.display_name || 'Профиль';\n\n    return (\n        <div className={styles.container} onClick={onClick}>\n            <Image className={styles.image} alt={name} src={avatarImage} src2x={avatarImage2x} />\n            <div className={styles.username}>{name}</div>\n        </div>\n    );\n};\n\nexport default AuthBox;\n","import React, { useCallback } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { RootState } from '../../redux';\n\nimport styles from './styles.module.css';\n\nconst MenuGeoLabel: React.FC<{\n    setCityModalVisibleCallback: (visible: boolean) => void;\n}> = ({ setCityModalVisibleCallback }) => {\n    const currentCity = useSelector((state: RootState) => state.city.currentCity);\n    const onCitySelectLabelClickHandle = useCallback(() => {\n        setCityModalVisibleCallback(true);\n    }, [setCityModalVisibleCallback]);\n\n    return (\n        <div className={styles.wrapper}>\n            <div className={styles.select} onClick={onCitySelectLabelClickHandle}>\n                {currentCity ? currentCity.name : 'Выбрать город'}\n            </div>\n        </div>\n    );\n};\n\nexport default MenuGeoLabel;\n","import React, { MouseEvent, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport MenuList from '../MenuNavigation';\nimport AuthBox from '../AuthBox';\nimport MenuGeoLabel from '../MenuGeoLabel';\n\nimport { RootState } from '../../redux';\nimport { setVisible as setMenuVisible } from '../../redux/slices/menu';\nimport { isAuthenticatedSelector, logout } from '../../redux/slices/user';\n\nimport styles from './style.module.css';\n\nconst MenuModal: React.FC<{\n    setCityModalVisibleCallback: (visible: boolean) => void;\n}> = ({ setCityModalVisibleCallback }) => {\n    const dispatch = useDispatch();\n\n    const { visible, items } = useSelector((state: RootState) => state.menu);\n    const isAuthenticated = useSelector(isAuthenticatedSelector);\n    const { psuid } = useSelector((state: RootState) => state.user);\n\n    const onClose = useCallback(() => {\n        setCityModalVisibleCallback(false);\n        dispatch(setMenuVisible(false));\n    }, [dispatch, setCityModalVisibleCallback]);\n\n    const onModalContentClick = useCallback((e: MouseEvent<HTMLImageElement>) => {\n        e.stopPropagation();\n    }, []);\n\n    const onLogoutClick = useCallback(() => {\n        dispatch(logout());\n    }, [dispatch]);\n\n    const className = [styles.modal, visible ? styles.visible : styles.hidden].join(' ');\n\n    return (\n        <div className={className} onClick={onClose}>\n            <div className={styles.content} onClick={onModalContentClick}>\n                <div className={styles.body}>\n                    <div className={styles.profile}>\n                        <AuthBox />\n                    </div>\n\n                    <MenuGeoLabel setCityModalVisibleCallback={setCityModalVisibleCallback} />\n                    <MenuList tags={items} onItemClick={onClose} />\n                </div>\n\n                {isAuthenticated && (\n                    <div className={styles.footer}>\n                        <p className={styles.psuid}>PSUID: {psuid}</p>\n                        <div className={styles.logout} onClick={onLogoutClick}>\n                            Выйти\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default MenuModal;\n","import React from 'react';\n\nimport styles from './styles.module.css';\n\nexport type Props = JSX.IntrinsicElements['input'] & {\n    label?: string;\n};\nconst Checkbox: React.FC<Props> = ({ className, label, ...props }) => {\n    const cls = [styles.checkbox, className].filter(Boolean).join(' ');\n\n    return (\n        <label className={styles.label}>\n            <input type=\"checkbox\" className={cls} {...props} />\n            {label}\n        </label>\n    );\n};\n\nexport default Checkbox;\n","import React, { ChangeEvent } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { RootState } from '../../redux';\n\nimport Checkbox from '../Checkbox';\nimport ActionButton from '../ActionButton';\nimport { City } from '../CityModal';\n\nimport styles from './styles.module.css';\n\ntype CityChangeProps = {\n    visible: boolean;\n    wasClosed: boolean;\n    useGeolocation: boolean;\n    openCityModal: () => void;\n    onSaveClick: () => void;\n    onGeolocationChanged: (event: ChangeEvent<HTMLInputElement>) => void;\n    selectedCity: City;\n};\n\nconst CityChange: React.FC<CityChangeProps> = ({\n    visible,\n    openCityModal,\n    wasClosed,\n    onSaveClick,\n    useGeolocation,\n    onGeolocationChanged,\n    selectedCity,\n}) => {\n    const isFetchingLocation = useSelector((state: RootState) => state.city.isFetchingLocation);\n\n    const className = [\n        styles.wrapper,\n        visible || wasClosed ? styles[`wrapper-visible_${visible ? 'yes' : 'no'}`] : '',\n        isFetchingLocation && styles.wrapper_loading,\n    ].join(' ');\n\n    return (\n        <div className={className}>\n            <div className={styles.title}>Выбрать город</div>\n            <div className={styles['auto-select-box']}>\n                <Checkbox checked={useGeolocation} onChange={onGeolocationChanged} label={'Определять автоматически'} />\n            </div>\n            <div className={styles.selected}>\n                <div className={styles['selected-city-label']}>Город</div>\n                <div className={styles['selected-city-name']} onClick={openCityModal}>\n                    {selectedCity.name}\n                </div>\n            </div>\n            <ActionButton className={styles.button} onClick={onSaveClick}>\n                Сохранить\n            </ActionButton>\n        </div>\n    );\n};\n\nexport default CityChange;\n","import React, { ChangeEvent, useCallback, useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { RootState } from '../../redux';\nimport { loadCityList } from '../../redux/slices/city-list';\n\nimport { City } from '../CityModal';\nimport TextInput from '../TextInput';\n\nimport styles from './styles.module.css';\n\ntype CitySelectProps = {\n    visible: boolean;\n    wasClosed: boolean;\n    onCitySelect: (city: City) => void;\n};\n\ntype CitySelectContentProps = {\n    isLoading: boolean;\n    items: City[];\n    onCityClick: CitySelectProps['onCitySelect'];\n};\n\ntype CityOptionProps = {\n    city: City;\n    onCityClick: CitySelectContentProps['onCityClick'];\n};\n\nconst CityOption: React.FC<CityOptionProps> = props => {\n    const { city, onCityClick } = props;\n\n    const onCitySelectHandler = useCallback(() => {\n        onCityClick(city);\n    }, [onCityClick, city]);\n\n    return (\n        <li className={styles['city-item']} onClick={onCitySelectHandler}>\n            {city.name}\n        </li>\n    );\n};\n\nconst CitySelectContent: React.FC<CitySelectContentProps> = props => {\n    const { isLoading, items, onCityClick } = props;\n\n    if (isLoading) {\n        return <>loading...</>;\n    }\n\n    return (\n        <ul className={styles['city-list']}>\n            {items.map(city => {\n                if (!city) {\n                    return null;\n                }\n\n                return <CityOption key={city.geoid} city={city} onCityClick={onCityClick} />;\n            })}\n        </ul>\n    );\n};\n\nconst CitySelect: React.FC<CitySelectProps> = ({ visible, onCitySelect, wasClosed }) => {\n    const dispatch = useDispatch();\n    const { items, isLoading } = useSelector((state: RootState) => state.cityList);\n    const [suggestedItems, setItems] = useState(items);\n\n    const className = [\n        styles.wrapper,\n        visible || wasClosed ? styles[`wrapper-visible_${visible ? 'yes' : 'no'}`] : '',\n    ].join(' ');\n\n    useEffect(() => {\n        if (!items.length) {\n            dispatch(loadCityList());\n        } else {\n            setItems(items);\n        }\n    }, [dispatch, items]);\n\n    const onSuggestChangeHandler = useCallback(\n        (e: ChangeEvent<HTMLInputElement>) => {\n            const value = e.target.value.toLowerCase();\n\n            if (!value.trim()) {\n                setItems(items);\n            } else {\n                setItems(items.filter(({ name }) => name.toLowerCase().indexOf(value) !== -1));\n            }\n        },\n        [items]\n    );\n\n    return (\n        <div className={className}>\n            <TextInput className={styles.input} placeholder=\"Введите название\" onChange={onSuggestChangeHandler} />\n            <CitySelectContent isLoading={isLoading} items={suggestedItems} onCityClick={onCitySelect} />\n        </div>\n    );\n};\n\nexport default CitySelect;\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useClickAway } from 'react-use';\n\nimport { RootState } from '../../redux';\nimport { setCity as saveCity, toggleGeolocation, loadCityInfo, City as stateCity } from '../../redux/slices/city';\nimport { usePrevious } from '../../hooks/usePrevious';\n\nimport CityChange from '../CityChange';\nimport CitySelect from '../CitySelect';\n\nimport styles from './styles.module.css';\n\nexport type City = stateCity['currentCity'];\n\nconst CityModal: React.FC<{\n    visible: boolean;\n    setCityModalVisibleCallback: (visible: boolean) => void;\n}> = ({ visible: isModalVisible, setCityModalVisibleCallback: setModalVisible }) => {\n    const contentRef = useRef<HTMLDivElement>(null);\n    const dispatch = useDispatch();\n    const history = useHistory();\n\n    const currentCity = useSelector((state: RootState) => state.city.currentCity);\n    const useGeolocation = useSelector((state: RootState) => state.city.useGeolocation);\n\n    const previousCity = usePrevious<City>(currentCity);\n\n    const [selectedCity, selectCity] = useState<City>(currentCity);\n\n    const [wasClosed, setWasClosed] = useState<boolean>(false);\n    const [wasClosedModalChange, setWasClosedModalChange] = useState<boolean>(false);\n    const [wasClosedModalSelect, setWasClosedModalSelect] = useState<boolean>(false);\n    const [visibleModalChange, setVisibleModalChange] = useState<boolean>(false);\n    const [visibleModalSelect, setVisibleModalSelect] = useState<boolean>(false);\n\n    const className = [\n        styles['city-modal'],\n        isModalVisible || wasClosed ? styles[`city-modal-visible_${isModalVisible ? 'yes' : 'no'}`] : '',\n    ].join(' ');\n\n    useEffect(() => {\n        setVisibleModalChange(isModalVisible);\n    }, [setVisibleModalChange, isModalVisible]);\n\n    useEffect(() => {\n        selectCity(currentCity);\n\n        if (previousCity && previousCity.name !== currentCity.name) {\n            console.warn('Go to `/` route');\n\n            history.replace('/');\n        }\n    }, [selectCity, currentCity, previousCity, history]);\n\n    const onGeolocationChanged = useCallback(\n        e => {\n            const isChecked = e.target.checked;\n\n            dispatch(toggleGeolocation(isChecked));\n        },\n        [dispatch]\n    );\n\n    const onClose = useCallback(() => {\n        if (selectedCity.name !== currentCity.name) {\n            selectCity(currentCity);\n        }\n\n        setWasClosed(true);\n        setVisibleModalSelect(false);\n        setVisibleModalChange(false);\n        setModalVisible(false);\n    }, [\n        selectedCity,\n        currentCity,\n        selectCity,\n        setWasClosed,\n        setVisibleModalSelect,\n        setVisibleModalChange,\n        setModalVisible,\n    ]);\n\n    const onSaveClick = useCallback(() => {\n        setWasClosed(true);\n        setVisibleModalChange(false);\n        setModalVisible(false);\n\n        dispatch(saveCity(selectedCity));\n\n        if (selectedCity.name !== currentCity.name) {\n            dispatch(loadCityInfo());\n        }\n    }, [setVisibleModalChange, setModalVisible, dispatch, selectedCity, currentCity]);\n\n    const onCitySelect = useCallback(\n        (city: City) => {\n            selectCity(city);\n            setWasClosedModalSelect(true);\n            setVisibleModalSelect(false);\n            setVisibleModalChange(true);\n\n            dispatch(toggleGeolocation(false));\n        },\n        [dispatch, selectCity, setWasClosedModalSelect, setVisibleModalSelect, setVisibleModalChange]\n    );\n\n    const openCityModal = useCallback(() => {\n        setWasClosedModalChange(true);\n        setVisibleModalSelect(true);\n        setVisibleModalChange(false);\n    }, [setWasClosedModalChange, setVisibleModalSelect, setVisibleModalChange]);\n\n    useClickAway(contentRef, onClose);\n\n    return (\n        <div className={className}>\n            {isModalVisible && (\n                <div ref={contentRef}>\n                    <CityChange\n                        visible={visibleModalChange}\n                        openCityModal={openCityModal}\n                        onGeolocationChanged={onGeolocationChanged}\n                        useGeolocation={useGeolocation}\n                        wasClosed={wasClosedModalChange}\n                        selectedCity={selectedCity}\n                        onSaveClick={onSaveClick}\n                    />\n                    <CitySelect\n                        visible={visibleModalSelect}\n                        onCitySelect={onCitySelect}\n                        wasClosed={wasClosedModalSelect}\n                    />\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default CityModal;\n","import { useRef, useEffect } from 'react';\n\nexport function usePrevious<T>(value: T) {\n    const previousValue = useRef<T>();\n\n    useEffect(() => {\n        previousValue.current = value;\n    }, [value]);\n\n    return previousValue.current;\n}\n","import React, { memo, useCallback, useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport { isIOS } from './lib/is-ios';\nimport { useWatchAuth } from './hooks/useWatchAuth';\nimport { loadCityInfo } from './redux/slices/city';\n\nimport MainScreen from './screens/MainScreen';\nimport EventScreen from './screens/EventScreen';\nimport RubricScreen from './screens/RubricScreen';\nimport SelectionScreen from './screens/SelectionScreen';\nimport SearchScreen from './screens/SearchScreen';\nimport OrdersScreen from './screens/OrdersScreen';\n\nimport MenuModal from './components/MenuModal';\nimport CityModal from './components/CityModal';\n\nimport { createStackNavigator } from './components/StackNavigator';\n\nconst Navigator = createStackNavigator(\n    [\n        {\n            path: '/',\n            exact: true,\n            component: memo(() => <MainScreen />),\n        },\n        {\n            path: '/event/:id',\n            exact: true,\n            component: memo(({ params: { id } }) => <EventScreen id={id} />),\n        },\n        {\n            path: '/events/:code',\n            exact: true,\n            component: memo(({ params: { code } }) => <RubricScreen code={code} />),\n        },\n        {\n            path: '/selection/:code',\n            exact: true,\n            component: memo(({ params: { code } }) => <SelectionScreen code={code} />),\n        },\n        {\n            path: '/search',\n            exact: true,\n            component: memo(() => <SearchScreen />),\n        },\n        {\n            path: '/orders',\n            exact: true,\n            component: memo(() => <OrdersScreen />),\n        },\n        {\n            path: '*',\n            component: memo(() => <div>Страница не найдена</div>),\n        },\n    ],\n    {\n        // Сохраняем в истории максимум 10 экранов\n        maxDepth: 10,\n        transitions: true,\n    }\n);\n\nconst App: React.FC = () => {\n    const dispatch = useDispatch();\n\n    const [cityModalVisible, setCityModalVisible] = useState<boolean>(false);\n\n    const setCityModalVisibleCallback = useCallback(\n        (visible: boolean) => {\n            setCityModalVisible(visible);\n        },\n        [setCityModalVisible]\n    );\n\n    useEffect(() => {\n        dispatch(loadCityInfo());\n    }, [dispatch]);\n\n    useEffect(() => {\n        if (isIOS()) {\n            document.body.style.overflow = 'auto';\n        }\n    }, []);\n\n    useWatchAuth();\n\n    return (\n        <>\n            <Navigator />\n\n            <MenuModal setCityModalVisibleCallback={setCityModalVisibleCallback} />\n            <CityModal setCityModalVisibleCallback={setCityModalVisibleCallback} visible={cityModalVisible} />\n        </>\n    );\n};\n\nexport default App;\n","import { useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport { checkUser } from '../redux/slices/user';\n\nexport function useWatchAuth() {\n    const dispatch = useDispatch();\n\n    // Проверяем авторизацию на старте приложения\n    useEffect(() => {\n        dispatch(checkUser());\n    }, [dispatch]);\n\n    // При переключении владок браузера пользователь мог сменить логин, поэтому проверяем авторизацию\n    useEffect(() => {\n        const onVisibilityChange = () => {\n            if (document.visibilityState === 'visible') {\n                dispatch(checkUser());\n            }\n        };\n\n        document.addEventListener('visibilitychange', onVisibilityChange);\n\n        return () => document.removeEventListener('visibilitychange', onVisibilityChange);\n    }, [dispatch]);\n}\n","import React, { useEffect, useState } from 'react';\n\nimport App from './App';\n\nconst polyfillPromises: Promise<void>[] = [];\n\nif (!('IntersectionObserver' in window)) {\n    // @ts-ignore\n    polyfillPromises.push(import('intersection-observer'));\n}\nif (!('fetch' in window)) {\n    // @ts-ignore\n    polyfillPromises.push(import('whatwg-fetch'));\n}\n\nconst PolyfillApp: React.FC = () => {\n    const [canRender, setCanRender] = useState(Boolean(!polyfillPromises.length));\n\n    useEffect(() => {\n        if (polyfillPromises.length) {\n            Promise.all(polyfillPromises).then(() => setCanRender(true));\n        }\n    }, []);\n\n    return <>{canRender && <App />}</>;\n};\n\nexport default PolyfillApp;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { HashRouter } from 'react-router-dom';\nimport { PersistGate } from 'redux-persist/integration/react';\n\nimport { initMetrika } from './lib/metrika';\nimport store, { persistor } from './redux';\nimport App from './PolyfillApp';\n\nimport './index.css';\n\ninitMetrika();\n\nReactDOM.render(\n    <Provider store={store}>\n        <PersistGate loading={null} persistor={persistor}>\n            <HashRouter>\n                <App />\n            </HashRouter>\n        </PersistGate>\n    </Provider>,\n    document.getElementById('root')\n);\n"],"sourceRoot":""}