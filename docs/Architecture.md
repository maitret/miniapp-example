# Архитектура миниаппа

<img src='./architecture.png' width='500'/>

User action — действие пользователя, которое инициирует загрузку приложения. Вызывает навигейт на URL миниаппа.

Процесс загрузки начинается с запроса #1 в NativeCache за шаблоном приложения (AppTemplate). Приложение представляет из себя набор экранов, состоящих из компонентов (UI Blocks), которые могут быть отрисованы в двух состояниях:

- скелет внутренних компонентов (например, пока данные для отрисовки еще запрашиваются);
- компоненты с данными.

Весь JS-код, который реализует бизнес-логику, логику работы блоков и т.д., делится на модули (JS Blocks) и грузится лениво, по требованию.

## Offline

Данные (AppData) хранятся отдельно от приложения в IndexedDB.<br>
Политика кэширования данных целиком на стороне приложения.

## SplashScreen

Время до первого сontentfull-кадра у нас не может быть меньше времени готовности нативного webView, а это далеко не нулевое время. Поэтому мы должны максимально быстро показать пользователю хоть что-нибудь. Для этого нам в всегда нужен шаблон, который должен быть максимально легким: HTML+CSS и никакого JS. Этот шаблон встроен в index.html и скрывается, когда отработал клиентский рендер стартового экрана.

## NativeCache

Политика кеширования:

- Для оптимизации скорости загрузки страниц платформа будет кэшировать всю статику (CSS, JS, HTML);
- Обновление бандла со статикой будет происходить в версионированном виде в фоновом режиме, не влияя на текущий сеанс работы с сервисом.
